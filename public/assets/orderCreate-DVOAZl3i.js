import{_ as qe}from"./PaymentsRow-BDPzain0.js";import{K as we,ac as Re,M as Be,ad as Ee,ae as Ae,N as Le,af as Ne,O as ze,P as Me,Q as He,R as xe,ag as je,S as Ge,B as We,ah as Ye,ai as Ke,aj as Qe,X as Xe,ak as Je,T as Ze,Y as Ve,b as e,al as $e,j as W,r as E,D as et,am as tt,G as at,s as A,a6 as st,an as ot,a0 as Y,F as U,_ as de,ao as Ce,ap as rt,a8 as Z,aq as lt,ar as it,as as nt,at as dt,v as ut,o as S,c as $,e as L,w as s,l as ee,n as te,aa as he,ab as _e,H as c,t as _,a3 as f,V as b,a as n,au as ct,x as mt,y as pt}from"./main-BjHIcQwn.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ae}from"./VForm-Dkljdl0d.js";import{V as se}from"./VDialog-DfJjFr3c.js";import{V as ht,a as N,b as oe,c as re}from"./VSnackbar-CReS-2rj.js";import{V as d,a as g}from"./VRow-DWSK70TO.js";import{a as V,V as C,d as le,b as _t,c as gt}from"./VCard-D8Obo5TD.js";import{V as k}from"./VAvatar-CfLe2Lkl.js";import{b as ge,d as ye,e as yt}from"./VChip-DgzLuilk.js";import{V as vt}from"./VSwitch-L7j3wox-.js";import{m as bt,a as wt,u as xt,V as ve,f as Vt,b as Ct,c as kt,d as y}from"./VTextField-C18O5uFy.js";import{V as Pt}from"./VDataTable-DGGmOViH.js";import{V as ie}from"./VDivider-sPsmVGuB.js";import{f as It}from"./forwardRefs-C-GTDzx5.js";import{I as Ft}from"./VImg-D63P8LKq.js";import{V as Dt}from"./VContainer-DzzgsXKa.js";import{V as ne}from"./VSpacer-CHpoyZL9.js";import"./VOverlay-r19brfx_.js";import"./easing-DY7PVvcf.js";import"./lazy-BXIgU_qh.js";import"./VCheckboxBtn-DJ1HkdoT.js";import"./index-B_xN8mSZ.js";import"./ssrBoot-JbFDLeqW.js";import"./VTable-DLA2QvGU.js";const St=we({color:String,...Re(),...Be(),...Ee(),...Ae(),...Le(),...Ne(),...ze(),...Me(),...He()},"VSheet"),be=xe()({name:"VSheet",props:St(),setup(t,a){let{slots:i}=a;const{themeClasses:m}=je(t),{backgroundColorClasses:o,backgroundColorStyles:l}=Ge(We(t,"color")),{borderClasses:v}=Ye(t),{dimensionStyles:q}=Ke(t),{elevationClasses:R}=Qe(t),{locationStyles:r}=Xe(t),{positionClasses:u}=Je(t),{roundedClasses:h}=Ze(t);return Ve(()=>e(t.tag,{class:["v-sheet",m.value,o.value,v.value,R.value,u.value,h.value,t.class],style:[l.value,q.value,r.value,t.style]},i)),{}}}),Tt=we({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:t=>!isNaN(parseFloat(t))},maxRows:{type:[Number,String],validator:t=>!isNaN(parseFloat(t))},suffix:String,modelModifiers:Object,...bt(),...wt()},"VTextarea"),Ot=xe()({name:"VTextarea",directives:{Intersect:Ft},inheritAttrs:!1,props:Tt(),emits:{"click:control":t=>!0,"mousedown:control":t=>!0,"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,a){let{attrs:i,emit:m,slots:o}=a;const l=$e(t,"modelValue"),{isFocused:v,focus:q,blur:R}=xt(t),r=W(()=>typeof t.counterValue=="function"?t.counterValue(l.value):(l.value||"").toString().length),u=W(()=>{if(i.maxlength)return i.maxlength;if(!(!t.counter||typeof t.counter!="number"&&typeof t.counter!="string"))return t.counter});function h(p,x){var w,I;!t.autofocus||!p||(I=(w=x[0].target)==null?void 0:w.focus)==null||I.call(w)}const B=E(),z=E(),ue=et(""),M=E(),ke=W(()=>t.persistentPlaceholder||v.value||t.active);function K(){var p;M.value!==document.activeElement&&((p=M.value)==null||p.focus()),v.value||q()}function Pe(p){K(),m("click:control",p)}function Ie(p){m("mousedown:control",p)}function Fe(p){p.stopPropagation(),K(),Z(()=>{l.value="",lt(t["onClick:clear"],p)})}function De(p){var w;const x=p.target;if(l.value=x.value,(w=t.modelModifiers)!=null&&w.trim){const I=[x.selectionStart,x.selectionEnd];Z(()=>{x.selectionStart=I[0],x.selectionEnd=I[1]})}}const T=E(),H=E(+t.rows),Q=W(()=>["plain","underlined"].includes(t.variant));tt(()=>{t.autoGrow||(H.value=+t.rows)});function O(){t.autoGrow&&Z(()=>{if(!T.value||!z.value)return;const p=getComputedStyle(T.value),x=getComputedStyle(z.value.$el),w=parseFloat(p.getPropertyValue("--v-field-padding-top"))+parseFloat(p.getPropertyValue("--v-input-padding-top"))+parseFloat(p.getPropertyValue("--v-field-padding-bottom")),I=T.value.scrollHeight,j=parseFloat(p.lineHeight),X=Math.max(parseFloat(t.rows)*j+w,parseFloat(x.getPropertyValue("--v-input-control-height"))),J=parseFloat(t.maxRows)*j+w||1/0,D=nt(I??0,X,J);H.value=Math.floor((D-w)/j),ue.value=it(D)})}at(O),A(l,O),A(()=>t.rows,O),A(()=>t.maxRows,O),A(()=>t.density,O);let F;return A(T,p=>{p?(F=new ResizeObserver(O),F.observe(T.value)):F==null||F.disconnect()}),st(()=>{F==null||F.disconnect()}),Ve(()=>{const p=!!(o.counter||t.counter||t.counterValue),x=!!(p||o.details),[w,I]=ot(i),{modelValue:j,...X}=ve.filterProps(t),J=Vt(t);return e(ve,Y({ref:B,modelValue:l.value,"onUpdate:modelValue":D=>l.value=D,class:["v-textarea v-text-field",{"v-textarea--prefixed":t.prefix,"v-textarea--suffixed":t.suffix,"v-text-field--prefixed":t.prefix,"v-text-field--suffixed":t.suffix,"v-textarea--auto-grow":t.autoGrow,"v-textarea--no-resize":t.noResize||t.autoGrow,"v-input--plain-underlined":Q.value},t.class],style:t.style},w,X,{centerAffix:H.value===1&&!Q.value,focused:v.value}),{...o,default:D=>{let{id:G,isDisabled:ce,isDirty:me,isReadonly:Se,isValid:Te}=D;return e(Ct,Y({ref:z,style:{"--v-textarea-control-height":ue.value},onClick:Pe,onMousedown:Ie,"onClick:clear":Fe,"onClick:prependInner":t["onClick:prependInner"],"onClick:appendInner":t["onClick:appendInner"]},J,{id:G.value,active:ke.value||me.value,centerAffix:H.value===1&&!Q.value,dirty:me.value||t.dirty,disabled:ce.value,focused:v.value,error:Te.value===!1}),{...o,default:Oe=>{let{props:{class:pe,...fe}}=Oe;return e(U,null,[t.prefix&&e("span",{class:"v-text-field__prefix"},[t.prefix]),de(e("textarea",Y({ref:M,class:pe,value:l.value,onInput:De,autofocus:t.autofocus,readonly:Se.value,disabled:ce.value,placeholder:t.placeholder,rows:t.rows,name:t.name,onFocus:K,onBlur:R},fe,I),null),[[Ce("intersect"),{handler:h},null,{once:!0}]]),t.autoGrow&&de(e("textarea",{class:[pe,"v-textarea__sizer"],id:`${fe.id}-sizer`,"onUpdate:modelValue":Ue=>l.value=Ue,ref:T,readonly:!0,"aria-hidden":"true"},null),[[rt,l.value]]),t.suffix&&e("span",{class:"v-text-field__suffix"},[t.suffix])])}})},details:x?D=>{var G;return e(U,null,[(G=o.details)==null?void 0:G.call(o,D),p&&e(U,null,[e("span",null,null),e(kt,{active:t.persistentCounter||v.value,value:r.value,max:u.value},o.counter)])])}:void 0})}),It({},B,z,M)}}),Ut={data(){return{isEditing:!1,editingOrderId:null,keyOrderForm:1,showFooter:!1,validOrder:!1,validCustomer:!1,validPayment:!1,creatingOrder:!1,savingCustomer:!1,savingPayment:!1,customerDialog:!1,paymentDialog:!1,paymentFormDialog:!1,customers:[],products:[],stock:[],sellers:[],order:{customer_id:null,shipping_address:"",subtotal:0,aditional:0,discount_amount:0,total_amount:0,notes:"",items:[],shipping:0,shipping_address_status:!1,seller_id:""},newItem:{product_id:null,quantity:1,unit_price:0,unit_cost_price:0},newCustomer:{name:"",email:"",telephone:"",locality_id:"",address:""},payment:{amount:0,payment_method_id:null,notes:""},createdOrder:null,snackbar:!1,snackbarText:"",snackbarColor:"success",itemHeaders:[{title:"",key:"actions",width:"25px",sortable:!1},{title:"Producto",key:"product_name",width:"300px"},{title:"Cantidad",key:"quantity",width:"80px"},{title:"Precio Unit.",key:"unit_price",width:"150px"},{title:"Total",key:"total_price",width:"150px",align:"end"}],localities:[],keyPayments:0,change:0,totalPaid:0,isAdmibBebidas:!1,saveButtonLabel:"Crear Orden",priceLists:[],selectedPriceList:1}},computed:{...dt({}),selectedCustomer(){return this.customers.find(t=>t.id===this.order.customer_id)},canAddItem(){return this.newItem.product_id&&this.newItem.quantity>0&&this.newItem.unit_price>0},canCreateOrder(){return this.order.customer_id&&this.order.shipping_address&&this.order.items.length>0},pendingAmount(){return this.createdOrder&&this.totalPaid<this.createdOrder.order.total_amount?this.createdOrder.order.total_amount-this.totalPaid:0}},async created(){this.$route.query.edit&&this.$route.query.orderId&&(this.isEditing=!0,this.editingOrderId=this.$route.query.orderId,this.saveButtonLabel="Editar Orden",await this.loadOrderData()),await this.loadData()},methods:{async loadOrderData(){try{this.isAdminBebidas=this.$is(["bebidas-admin"]);const t=await this.$axios.get(`${this.$routes.orders}/${this.editingOrderId}`),a=t.data.data||t.data;a.items&&a.items.length>0&&(this.selectedPriceList=a.items[0].price_list_id),this.$route.meta.title="Editar Orden N° "+a.order_number,document.title=this.$route.meta.title,this.order={customer_id:a.customer.id,shipping_address:a.shipping_address,delivery_date:this.formatDateForInput(a.delivery_date),subtotal:parseFloat(a.subtotal),aditional:parseFloat(a.aditional),discount_amount:parseFloat(a.discount_amount),total_amount:parseFloat(a.total_amount),notes:a.notes,seller_id:a.seller_id,items:a.items.map(i=>({product_id:i.product_id,quantity:parseInt(i.quantity),unit_price:parseFloat(i.unit_price),unit_cost_price:parseFloat(i.unit_cost_price),total_price:parseFloat(i.total_price),total_profit:parseFloat(i.total_profit)})),shipping:a.shipping?1:0},this.$forceUpdate()}catch(t){console.error("Error al cargar datos de la orden:",t),this.showSnackbar("Error al cargar la orden para edición","error")}},formatDateForInput(t){if(!t)return"";const a=new Date(t);return`${a.getDate().toString().padStart(2,"0")}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getFullYear()}`},productTitle(t){const a=this.$store.getters.currentUser;let i=t.name;return a.data.tenant.id==2&&(i=`[${t.code}] ${t.name} `),i},setDate(t){if(t)return;let a=this.getDateTimeTomorrow();this.order.delivery_date=a},updateTotal(t){this.totalPaid=t,this.change=this.totalPaid>this.createdOrder.order.total_amount?this.totalPaid-this.createdOrder.order.total_amount:0},async loadData(){try{this.isAdminBebidas=this.$is(["bebidas-admin"]);const[t,a,i,m,o]=await Promise.all([this.$axios.get(this.$routes.customers),this.$axios.get(this.$routes.products),this.$axios.get(this.$routes.stocks),this.$axios.get(this.$routes.localities),this.$axios.get(this.$routes.priceLists)]);if(this.isAdminBebidas){const v=await this.$axios.get(this.$routes.usersList);this.sellers=v.data.data||v.data}this.customers=t.data.data||t.data,this.products=a.data.data||a.data,this.stock=i.data.data||i.data,this.localities=m.data.data||m.data,this.priceLists=o.data.data||o.data;let l=this.priceLists.find(v=>v.is_default===1);this.selectedPriceList=l.id,(this.$is("bebidas-admin")||this.$is("bebidas-user"))&&(this.order.shipping=1),(this.$is("superadmin")||this.$is("bebidas-admin")||this.$is("petshop-admin"))&&this.order.seller_id==""&&(this.order.seller_id=this.$store.getters.currentUser.data.id),this.setDate(this.order.delivery_date)}catch(t){console.error("Error loading data:",t),this.showSnackbar("Error al cargar los datos","error")}},onCustomerChange(){this.selectedCustomer&&(this.order.shipping_address=this.selectedCustomer.address)},useCustomerAddress(){this.selectedCustomer&&(this.order.shipping_address=this.selectedCustomer.address)},onProductChange(){if(this.newItem.product_id){const t=this.getProductById(this.newItem.product_id);t&&(this.newItem.unit_price=parseFloat(t.display_price||t.sale_price||0),this.newItem.unit_cost_price=parseFloat(t.purchase_price||0))}},onPriceListChange(){this.products=this.products.map(t=>{const a=t.price_lists.find(i=>i.id===this.selectedPriceList);return{...t,sale_price:a?a.pivot.sale_price:0,current_price_list:a||null}}),this.newItem.product_id&&this.onProductChange()},productTitleWithPrice(t){const a=this.$store.getters.currentUser;let i=t.name;const m=t.display_price||t.sale_price;return a.data.tenant.id==2&&(i=`[${t.code}] ${t.name} `),`${i} - $${this.formatNumber(m)}`},getProductById(t){return this.products.find(a=>a.id===t)},getProductStock(t){const a=this.stock.find(i=>i.product_id===t);return a?parseFloat(a.quantity)-parseFloat(a.reserved_quantity):0},showStockWarning(t,a){return a>this.getProductStock(t)},calculateItemTotal(){return this.newItem.quantity*this.newItem.unit_price},addItem(){if(!this.canAddItem)return;this.getProductById(this.newItem.product_id);const t=this.newItem.quantity*this.newItem.unit_price,a=this.newItem.quantity*this.newItem.unit_cost_price;this.order.items.push({product_id:this.newItem.product_id,quantity:this.newItem.quantity,unit_price:this.newItem.unit_price,unit_cost_price:this.newItem.unit_cost_price,total_price:t,total_profit:t-a,price_list_id:this.selectedPriceList}),this.newItem={product_id:null,quantity:1,unit_price:0,unit_cost_price:0},this.calculateTotals()},removeItem(t){this.order.items.splice(t,1),this.calculateTotals()},updateItemTotal(t){const a=this.order.items[t];a.total_price=a.quantity*a.unit_price,a.total_profit=a.total_price-a.quantity*a.unit_cost_price,this.calculateTotals()},calculateTotals(){this.order.subtotal=this.order.items.reduce((t,a)=>t+parseFloat(a.total_price),0),this.order.total_amount=this.order.subtotal+parseFloat(this.order.aditional||0)-parseFloat(this.order.discount_amount||0)},openCustomerDialog(){this.customerDialog=!0},closeCustomerDialog(){this.customerDialog=!1,this.newCustomer={name:"",email:"",phone:"",document:"",address:""}},async saveCustomer(){if(await this.$refs.customerForm.validate()){this.savingCustomer=!0;try{const a=await this.$axios.post(this.$routes.customers,this.newCustomer),i=a.data.data||a.data;this.customers.push(i),this.order.customer_id=i.id,this.order.shipping_address=i.address,this.showSnackbar("Cliente creado exitosamente","success"),this.closeCustomerDialog()}catch(a){console.error("Error saving customer:",a),this.showSnackbar("Error al crear el cliente","error")}finally{this.savingCustomer=!1}}},async updateOrder(){if(await this.$refs.orderForm.validate()){this.creatingOrder=!0;try{const a={...this.order,quantity_products:this.order.items.reduce((m,o)=>m+parseInt(o.quantity),0),total_cost:this.order.items.reduce((m,o)=>m+o.quantity*o.unit_cost_price,0),total_profit:this.order.items.reduce((m,o)=>m+parseFloat(o.total_profit),0)},i=await this.$axios.post(`${this.$routes.orders}-update/${this.editingOrderId}`,a);this.createdOrder=i.data.data||i.data,this.showSnackbar("Orden actualizada exitosamente","success"),this.$router.push({path:"/order-search"})}catch(a){console.error("Error updating order:",a),this.showSnackbar("Error al actualizar la orden","error")}finally{this.creatingOrder=!1}}},async createOrder(){if(this.isEditing){await this.updateOrder();return}if(await this.$refs.orderForm.validate()){this.creatingOrder=!0;try{const a={...this.order,quantity_products:this.order.items.reduce((m,o)=>m+parseInt(o.quantity),0),total_cost:this.order.items.reduce((m,o)=>m+o.quantity*o.unit_cost_price,0),total_profit:this.order.items.reduce((m,o)=>m+parseFloat(o.total_profit),0)},i=await this.$axios.post(this.$routes.orders,a);this.createdOrder=i.data.data||i.data,this.paymentDialog=!0}catch(a){console.error("Error creating order:",a),this.showSnackbar("Error al crear la orden","error")}finally{this.creatingOrder=!1}}},openPaymentForm(){this.paymentDialog=!1,this.paymentFormDialog=!0},closePaymentForm(){this.paymentFormDialog=!1,this.clearForm()},clearForm(){this.order={customer_id:null,shipping_address:"",delivery_date:"",subtotal:0,aditional:0,discount_amount:0,total_amount:0,notes:"",items:[]},this.order.shipping_address="",this.$refs.orderForm.resetValidation(),this.$nextTick(()=>{this.$refs.orderForm.resetValidation()}),this.loadData()},async validatePayments(t){if(t.length<=0)return"Debe incluir al menos una modalidad de pago";const a=new Set;t.reduce((i,m)=>i+parseFloat(m.amount),0);for(const i of t){if(!i.amount||!i.payment_method_id)return"Verifique la informacion de los pagos";if(a.has(i.payment_method_id.id))return"Ha seleccionado mas de una vez el mismo metodo de pago. Metodo de pago: "+i.payment_method_id.name;a.add(i.payment_method_id.id)}return!0},async savePayment(){const t=await this.validatePayments(this.$refs.paymentsRow.payments);if(t!==!0)return this.showSnackbar(t,"error");this.savingPayment=!0;try{const a={order_id:this.createdOrder.order.id,payments:this.$refs.paymentsRow.payments},i=await this.$axios.post(this.$routes.payments,a);console.log(i),i.status==201&&(this.showSnackbar("Pago registrado exitosamente","success"),this.finishOrder())}catch(a){console.error("Error saving payment:",a),this.showSnackbar("Error al registrar el pago","error")}finally{this.savingPayment=!1}},async updateOrderStatus(t){try{await this.$axios.patch(`${this.$routes.orders}/${this.createdOrder.id}/status`,{status:t})}catch(a){console.error("Error updating order status:",a)}},finishOrder(){this.clearForm(),this.paymentDialog=!1,this.paymentFormDialog=!1},formatNumber(t){return new Intl.NumberFormat("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0)},formatCurrency(t){return t?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(t):"$0"},showSnackbar(t,a){this.snackbarText=t,this.snackbarColor=a,this.snackbar=!0},toggleShipping(t){console.log(t.shipping),t.shipping_address_status=!t.shipping_address_status}}},P=t=>(mt("data-v-44edc7bf"),t=t(),pt(),t),qt=P(()=>n("strong",null,"Loc:",-1)),Rt=P(()=>n("strong",null,"Tel:",-1)),Bt={class:"ml-2 text-success font-weight-bold"},Et={class:"text-caption"},At={class:"text-warning pt-6",style:{width:"15px !important"}},Lt={class:"v-card-item"},Nt={class:"v-card-item__content"},zt={class:"v-card-title"},Mt={class:"text-h5"},Ht={style:{"min-height":"280px","max-height":"270px","overflow-y":"auto"}},jt={class:"v-card-item"},Gt={class:"v-card-item__content"},Wt={class:"v-card-title"},Yt={class:"text-h5"},Kt={class:"v-card-item"},Qt={class:"v-card-item__content"},Xt={class:"v-card-title"},Jt={class:"text-h5"},Zt={class:"text-center mb-5"},$t=P(()=>n("h3",{class:"text-h5 font-weight-medium text-success mb-2"}," ¡Orden creada exitosamente! ",-1)),ea=P(()=>n("p",{class:"text-medium-emphasis mb-0"}," ¿Deseas registrar un pago para esta orden? ",-1)),ta={class:"d-flex justify-space-between align-center mb-3"},aa=P(()=>n("span",{class:"text-medium-emphasis"},"Número de Orden:",-1)),sa={class:"font-weight-medium"},oa={class:"d-flex justify-space-between align-center"},ra=P(()=>n("span",{class:"text-medium-emphasis"},"Total:",-1)),la={class:"text-h5 font-weight-medium text-success"},ia={class:"d-flex flex-column gap-2"},na={class:"d-flex justify-space-between"},da=P(()=>n("span",{class:"text-caption text-medium-emphasis"},"Total Orden:",-1)),ua={class:"font-weight-medium"},ca={class:"d-flex justify-space-between"},ma=P(()=>n("span",{class:"text-caption text-medium-emphasis"},"Total Pagado:",-1)),pa={class:"font-weight-medium text-primary"},fa={class:"d-flex justify-space-between"},ha=P(()=>n("span",{class:"text-caption text-medium-emphasis"},"Saldo Pendiente:",-1)),_a={class:"d-flex justify-space-between"},ga=P(()=>n("span",{class:"text-caption text-medium-emphasis"},"Vuelto:",-1)),ya={class:"font-weight-medium text-success"},va={class:"mt-4"};function ba(t,a,i,m,o,l){const v=ut("IconBtn"),q=qe,R=Ce("mask");return S(),$(U,null,[(S(),L(ae,{key:o.keyOrderForm,ref:"orderForm",modelValue:o.validOrder,"onUpdate:modelValue":a[16]||(a[16]=r=>o.validOrder=r)},{default:s(()=>[e(g,null,{default:s(()=>[e(d,{cols:"12",sm:"12",md:"6"},{default:s(()=>[e(V,null,{default:s(()=>[e(C,{class:"mb-0 pb-2"},{default:s(()=>[e(g,{class:"mb-0 pb-0"},{default:s(()=>[t.isAdminBebidas?(S(),L(d,{key:0,cols:"1",md:"1",sm:"1",class:"mb-0 pt-3 d-none d-sm-flex"},{default:s(()=>[e(k,{icon:"ri-user-line",class:"text-error mr-2",variant:"tonal",size:"40"})]),_:1})):ee("",!0),t.isAdminBebidas?(S(),L(d,{key:1,cols:"12",sm:"11",md:"10",class:"mb-0 pt-4 ml-0 pr-0 mr-0"},{default:s(()=>[e(N,{modelValue:o.order.seller_id,"onUpdate:modelValue":a[0]||(a[0]=r=>o.order.seller_id=r),items:o.sellers,"item-title":"name","item-value":"id",label:"Vendedor",rules:[r=>!!r||"Vendedor es requerido"],clearable:"",density:"compact","return-object":""},null,8,["modelValue","items","rules"])]),_:1})):ee("",!0)]),_:1}),e(g,{class:te(["mb-0",t.isAdminBebidas?"pb-0":"py-8"])},{default:s(()=>[e(d,{cols:"1",md:"1",sm:"1",class:"mb-0 pt-0 d-none d-sm-flex"},{default:s(()=>[e(k,{icon:"ri-user-line",class:"text-info mr-2",variant:"tonal",size:"40"})]),_:1}),e(d,{cols:"9",sm:"9",md:"5",class:"mb-0 pt-0 ml-0"},{default:s(()=>[e(N,{modelValue:o.order.customer_id,"onUpdate:modelValue":[a[1]||(a[1]=r=>o.order.customer_id=r),l.onCustomerChange],items:o.customers,"item-title":"address","item-value":"id",label:"Cliente",rules:[r=>!!r||"Cliente es requerido"],clearable:"",density:"compact"},{item:s(({props:r,item:u})=>[e(be,{border:"info md"},{default:s(()=>[e(ge,he(_e(r)),{default:s(()=>[e(ye,{class:"text-caption"},{default:s(()=>{var h;return[qt,c(_((h=u.raw.locality)==null?void 0:h.name)+" - ",1),Rt,c(_(u.raw.telephone),1)]}),_:2},1024)]),_:2},1040)]),_:2},1024)]),_:1},8,["modelValue","items","rules","onUpdate:modelValue"])]),_:1}),e(d,{cols:"auto",class:"mb-0 pt-0"},{default:s(()=>[e(f,{onClick:l.openCustomerDialog,color:t.$cv("principal"),title:"nuevo cliente"},{default:s(()=>[e(b,{icon:"ri-user-add-line",class:""})]),_:1},8,["onClick","color"])]),_:1}),e(d,{cols:"9",sm:"6",md:"4",class:"mb-0 pt-0 ml-0"},{default:s(()=>[e(N,{modelValue:o.selectedPriceList,"onUpdate:modelValue":[a[2]||(a[2]=r=>o.selectedPriceList=r),l.onPriceListChange],items:o.priceLists,"item-title":"name","item-value":"id",label:"Lista de Precios",rules:[r=>!!r||"Lista de precios es requerida"],clearable:"",density:"compact"},null,8,["modelValue","items","rules","onUpdate:modelValue"])]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),e(d,{cols:"12",sm:"12",md:"6"},{default:s(()=>[e(V,null,{default:s(()=>[e(C,{class:"mb-0 pb-2"},{default:s(()=>[e(g,{class:"mb-0 pb-0"},{default:s(()=>[e(d,{cols:"1",md:"1",class:"mb-0 pb-0 pt-2 d-none d-sm-flex"},{default:s(()=>[e(k,{icon:"ri-map-pin-line",class:"text-info mr-2",variant:"tonal"})]),_:1}),e(d,{cols:"1",md:"1",class:"mb-0 pt-5 ml-1"},{default:s(()=>[e(vt,{modelValue:o.order.shipping,"onUpdate:modelValue":a[3]||(a[3]=r=>o.order.shipping=r),"true-value":1,"false-value":0,color:"primary","hide-details":"",title:"Requiere Envío",onClick:a[4]||(a[4]=r=>l.toggleShipping(o.order))},null,8,["modelValue"])]),_:1}),e(d,{cols:"8",sm:"8",md:"8",class:"mb-0 pt-3"},{default:s(()=>[e(y,{modelValue:o.order.shipping_address,"onUpdate:modelValue":a[5]||(a[5]=r=>o.order.shipping_address=r),label:"Dirección de Entrega",rules:[r=>!!r||"Dirección de entrega es requerida"],disabled:!o.order.shipping,density:"compact"},null,8,["modelValue","rules","disabled"])]),_:1}),e(d,{cols:"auto",md:"auto",class:"mb-0"},{default:s(()=>[e(f,{onClick:l.useCustomerAddress,color:t.$cv("principal"),title:"Usar del cliente"},{default:s(()=>[e(b,{icon:"ri-refresh-line",class:"mr-2"})]),_:1},8,["onClick","color"])]),_:1})]),_:1}),e(g,{class:"mb-0 pb-2"},{default:s(()=>[e(d,{cols:"1",md:"1",class:"mb-0 pb-0 pt-0 d-none d-sm-flex"},{default:s(()=>[e(k,{icon:"ri-truck-line",class:"text-info mr-2",variant:"tonal"})]),_:1}),e(d,{cols:"1",md:"1",class:"ml-1"}),e(d,{cols:"8",sm:"8",md:"8",class:"mb-0 pt-0"},{default:s(()=>[de(e(y,{modelValue:o.order.delivery_date,"onUpdate:modelValue":a[6]||(a[6]=r=>o.order.delivery_date=r),label:"Fecha de Entrega",placeholder:"dd/mm/yyyy",clearable:"",onFocus:a[7]||(a[7]=r=>l.setDate(o.order.delivery_date)),disabled:!o.order.shipping,density:"compact"},null,8,["modelValue","disabled"]),[[R,"##/##/####"]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(g,null,{default:s(()=>[e(d,{cols:"12",sm:"12",md:"12"},{default:s(()=>[e(V,null,{default:s(()=>[e(C,{class:"mb-0 pb-3"},{default:s(()=>[e(g,{class:"mb-0 pb-0"},{default:s(()=>[e(d,{class:"mb-0 pb-0 pt-4 d-none d-sm-flex flex-grow-0"},{default:s(()=>[e(k,{icon:"ri-shopping-cart-line",class:"text-info mr-2",variant:"tonal",size:"40"})]),_:1}),e(d,{cols:"8",md:"5",class:"pt-5"},{default:s(()=>[e(N,{modelValue:o.newItem.product_id,"onUpdate:modelValue":[a[8]||(a[8]=r=>o.newItem.product_id=r),l.onProductChange],items:o.products,"item-title":l.productTitleWithPrice,"item-value":"id",label:"Seleccionar Producto",clearable:"",density:"compact"},{item:s(({props:r,item:u})=>[e(be,{border:"info md"},{default:s(()=>[e(ge,he(_e(r)),{default:s(()=>[e(ye,{class:"text-caption"},{default:s(()=>[e(yt,{color:l.getProductStock(u.raw.id)>0?"success":"error"},{default:s(()=>[c("Stock: "+_(l.getProductStock(u.raw.id)),1)]),_:2},1032,["color"]),n("span",Bt," $"+_(l.formatNumber(u.raw.display_price||u.raw.sale_price)),1)]),_:2},1024)]),_:2},1040)]),_:2},1024)]),_:1},8,["modelValue","items","item-title","onUpdate:modelValue"])]),_:1}),e(d,{cols:"4",md:"1",class:"pr-0"},{default:s(()=>[n("div",{class:te([o.newItem.product_id&&l.showStockWarning(o.newItem.product_id,o.newItem.quantity)?"bg-warning-2 rounded-lg":"","px-2 pt-2"])},[e(y,{modelValue:o.newItem.quantity,"onUpdate:modelValue":a[9]||(a[9]=r=>o.newItem.quantity=r),label:"Cant",type:"number",min:"1",rules:[r=>!!r||"Cantidad requerida",r=>r>0||"Debe ser mayor a 0"],density:"compact"},null,8,["modelValue","rules"]),n("div",Et," En stock: "+_(l.getProductStock(o.newItem.product_id)),1)],2)]),_:1}),n("div",At,[o.newItem.product_id&&l.showStockWarning(o.newItem.product_id,o.newItem.quantity)?(S(),L(b,{key:0,icon:"ri-error-warning-fill",title:"Stock Insuficiente"})):ee("",!0)]),e(d,{cols:"6",md:"2",class:"pt-5"},{default:s(()=>[e(y,{modelValue:o.newItem.unit_price,"onUpdate:modelValue":a[10]||(a[10]=r=>o.newItem.unit_price=r),label:"Precio Unitario",type:"number",step:"0.01",prefix:"$",rules:[r=>!!r||"Precio requerido",r=>r>0||"Debe ser mayor a 0"],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"6",md:"2",class:"pt-5"},{default:s(()=>[e(y,{"model-value":l.calculateItemTotal(),label:"Total",prefix:"$",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"])]),_:1}),e(d,{cols:"12",md:"1",class:"pt-5"},{default:s(()=>[e(f,{color:"primary",onClick:l.addItem,disabled:!l.canAddItem,block:""},{default:s(()=>[e(b,{icon:"ri-add-line"})]),_:1},8,["onClick","disabled"])]),_:1})]),_:1}),e(g,{class:"my-0"},{default:s(()=>[e(d,{cols:"12",sm:"12",md:"9"},{default:s(()=>[e(V,null,{default:s(()=>[n("div",Lt,[n("div",Nt,[n("div",zt,[n("h5",Mt,[e(k,{icon:"ri-luggage-cart-line",class:"text-info mr-2",variant:"tonal"}),c("Productos agregados ")])])])]),e(C,null,{default:s(()=>[n("div",Ht,[e(Pt,{headers:o.itemHeaders,items:o.order.items,class:"elevation-1","no-data-text":"No hay productos agregados",density:"compact","items-per-page":1e3},ct({"item.product_name":s(({item:r})=>{var u;return[c(_((u=l.getProductById(r.product_id))==null?void 0:u.name),1)]}),"item.unit_price":s(({item:r,index:u})=>[e(y,{modelValue:r.unit_price,"onUpdate:modelValue":h=>r.unit_price=h,type:"number",step:"0.01",prefix:"$",density:"compact","hide-details":"",onInput:h=>l.updateItemTotal(u),class:"ma-0 pa-0 text-sm"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),"item.quantity":s(({item:r,index:u})=>[e(y,{modelValue:r.quantity,"onUpdate:modelValue":h=>r.quantity=h,type:"number",min:"1",density:"compact","hide-details":"",onInput:h=>l.updateItemTotal(u),style:{width:"80px"}},null,8,["modelValue","onUpdate:modelValue","onInput"])]),"item.total_price":s(({item:r})=>[c(" $"+_(l.formatNumber(r.total_price)),1)]),"item.actions":s(({index:r})=>[e(v,{size:"small",color:"error",onClick:u=>l.removeItem(r)},{default:s(()=>[e(b,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])]),_:2},[o.showFooter?void 0:{name:"bottom",fn:s(()=>[]),key:"0"}]),1032,["headers","items"])])]),_:1})]),_:1})]),_:1}),e(d,{cols:"12",sm:"12",md:"3"},{default:s(()=>[e(V,null,{default:s(()=>[n("div",jt,[n("div",Gt,[n("div",Wt,[n("h5",Yt,[e(k,{icon:"ri-calculator-line",class:"text-info mr-2",variant:"tonal"}),c("Totales ")])])])]),e(C,null,{default:s(()=>[e(g,null,{default:s(()=>[e(d,{cols:"12",md:"12"},{default:s(()=>[e(y,{"model-value":l.formatCurrency(o.order.subtotal),label:"Subtotal",readonly:"",variant:"outlined",density:"compact",class:"custom-bg-gray number-end"},null,8,["model-value"])]),_:1}),e(d,{cols:"12",md:"12"},{default:s(()=>[e(y,{modelValue:o.order.discount_amount,"onUpdate:modelValue":a[11]||(a[11]=r=>o.order.discount_amount=r),label:"Descuento",type:"number",step:"0.01",prefix:"$",onInput:l.calculateTotals,density:"compact",class:"number-end"},null,8,["modelValue","onInput"])]),_:1}),e(d,{cols:"12",md:"12"},{default:s(()=>[e(y,{modelValue:o.order.aditional,"onUpdate:modelValue":a[12]||(a[12]=r=>o.order.aditional=r),label:"Adicional",type:"number",step:"0.01",prefix:"$",onInput:l.calculateTotals,density:"compact",class:"number-end"},null,8,["modelValue","onInput"])]),_:1})]),_:1}),e(ie,{class:"my-4"}),e(g,null,{default:s(()=>[e(d,{cols:"12",md:"12"},{default:s(()=>[e(y,{"model-value":l.formatCurrency(o.order.total_amount),label:"Total Final",readonly:"",variant:"outlined",class:"text-h6 custom-bg-gray number-end",density:"compact"},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(g,null,{default:s(()=>[e(d,{cols:"12",sm:"12",md:"12"},{default:s(()=>[e(V,null,{default:s(()=>[n("div",Kt,[n("div",Qt,[n("div",Xt,[n("h5",Jt,[e(k,{icon:"ri-file-text-line",class:"text-info mr-2",variant:"tonal"}),c("Notas Adicionales ")])])])]),e(C,null,{default:s(()=>[e(Ot,{modelValue:o.order.notes,"onUpdate:modelValue":a[13]||(a[13]=r=>o.order.notes=r),label:"Notas de la orden",rows:"2",style:{height:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(g,null,{default:s(()=>[e(d,{cols:"12",class:"text-center"},{default:s(()=>[e(f,{color:"primary",variant:"outlined",class:"mr-4",onClick:a[14]||(a[14]=r=>t.$router.go(-1))},{default:s(()=>[e(b,{icon:"ri-close-circle-line",class:"mr-2"}),c(" Cancelar ")]),_:1}),e(f,{color:"primary",class:"mr-4",onClick:a[15]||(a[15]=r=>t.$router.push({path:"order-search"}))},{default:s(()=>[e(b,{icon:"ri-shopping-bag-line",class:"mr-2"}),c(" Ordenes ")]),_:1}),e(f,{color:"primary",onClick:l.createOrder,loading:o.creatingOrder,disabled:!l.canCreateOrder},{default:s(()=>[e(b,{icon:"ri-save-line",class:"mr-2"}),c(" "+_(o.saveButtonLabel),1)]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])),e(se,{modelValue:o.customerDialog,"onUpdate:modelValue":a[23]||(a[23]=r=>o.customerDialog=r),"max-width":"600px"},{default:s(()=>[e(V,null,{default:s(()=>[e(oe,{color:"primary"},{default:s(()=>[e(f,{icon:"ri-close-line",color:"white",onClick:l.closeCustomerDialog},null,8,["onClick"]),e(re,null,{default:s(()=>[c("Nuevo Cliente")]),_:1})]),_:1}),e(ae,{ref:"customerForm",modelValue:o.validCustomer,"onUpdate:modelValue":a[22]||(a[22]=r=>o.validCustomer=r)},{default:s(()=>[e(C,null,{default:s(()=>[e(Dt,null,{default:s(()=>[e(g,null,{default:s(()=>[e(d,{cols:"12",sm:"6"},{default:s(()=>[e(y,{modelValue:o.newCustomer.address,"onUpdate:modelValue":a[17]||(a[17]=r=>o.newCustomer.address=r),label:"Dirección",rules:[r=>!!r||"Dirección es requerida"],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",sm:"6"},{default:s(()=>[e(y,{modelValue:o.newCustomer.phone,"onUpdate:modelValue":a[18]||(a[18]=r=>o.newCustomer.phone=r),label:"Teléfono",rules:[r=>!!r||"Teléfono es requerido"],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",sm:"6"},{default:s(()=>[e(y,{modelValue:o.newCustomer.name,"onUpdate:modelValue":a[19]||(a[19]=r=>o.newCustomer.name=r),label:"Nombre",density:"compact"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",sm:"6"},{default:s(()=>[e(N,{modelValue:o.newCustomer.locality_id,"onUpdate:modelValue":a[20]||(a[20]=r=>o.newCustomer.locality_id=r),items:o.localities,"item-title":"name","item-value":"id",label:"Localidad",clearable:"",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(d,{cols:"12",sm:"6"},{default:s(()=>[e(y,{modelValue:o.newCustomer.email,"onUpdate:modelValue":a[21]||(a[21]=r=>o.newCustomer.email=r),label:"Email",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(le,null,{default:s(()=>[e(ne),e(f,{variant:"outlined",color:"primary",onClick:l.closeCustomerDialog},{default:s(()=>[c(" Cancelar ")]),_:1},8,["onClick"]),e(f,{color:"white",class:"bg-primary",onClick:l.saveCustomer,loading:o.savingCustomer},{default:s(()=>[c(" Guardar Cliente ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(se,{modelValue:o.paymentDialog,"onUpdate:modelValue":a[26]||(a[26]=r=>o.paymentDialog=r),"max-width":"580px",persistent:""},{default:s(()=>[e(V,{class:"rounded-lg"},{default:s(()=>[e(oe,{color:"primary",density:"compact"},{default:s(()=>[e(re,{class:"text-white font-weight-medium"},{default:s(()=>[e(f,{icon:"ri-close-line",color:"white",onClick:a[24]||(a[24]=r=>o.paymentDialog=!1)}),c(" Confirmación de Pago ")]),_:1}),e(ne),e(f,{icon:"",variant:"text",color:"white",onClick:a[25]||(a[25]=r=>o.paymentDialog=!1),class:"mr-1"},{default:s(()=>[e(b,null,{default:s(()=>[c("mdi-close")]),_:1})]),_:1})]),_:1}),e(C,{class:"px-4 pt-5 pb-2"},{default:s(()=>[n("div",Zt,[e(k,{color:"success-lighten-5",size:"56",class:"mb-3"},{default:s(()=>[e(b,{icon:"ri-checkbox-circle-fill",color:"success",size:"80"})]),_:1}),$t,ea]),e(V,{flat:"",border:"",class:"mb-4"},{default:s(()=>[e(C,{class:"pa-4"},{default:s(()=>{var r,u,h,B;return[n("div",ta,[aa,n("span",sa," #"+_((u=(r=o.createdOrder)==null?void 0:r.order)==null?void 0:u.order_number),1)]),n("div",oa,[ra,n("span",la,_(l.formatCurrency((B=(h=o.createdOrder)==null?void 0:h.order)==null?void 0:B.total_amount)),1)])]}),_:1})]),_:1})]),_:1}),e(le,{class:"px-4 pb-4 pt-0"},{default:s(()=>[e(g,null,{default:s(()=>[e(d,{cols:"12",md:"12",sm:"12",class:"pt-4 pb-0 my-0"},{default:s(()=>[e(f,{variant:"outlined",color:"primary",onClick:l.finishOrder,block:"",class:"text-capitalize mr-2"},{default:s(()=>[e(b,{icon:"mdi-check",class:"mr-1"}),c(" Finalizar sin pago ")]),_:1},8,["onClick"])]),_:1}),e(d,{cols:"12",md:"12",sm:"12",class:"pt-1 pb-2 my-0"},{default:s(()=>[e(f,{color:"white",onClick:l.openPaymentForm,block:"",class:"bg-primary text-capitalize"},{default:s(()=>[e(b,{icon:"mdi-cash-plus",class:"mr-1"}),c(" Registrar Pago ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(se,{modelValue:o.paymentFormDialog,"onUpdate:modelValue":a[28]||(a[28]=r=>o.paymentFormDialog=r),"max-width":"600px",persistent:""},{default:s(()=>[e(V,{class:"rounded-lg"},{default:s(()=>[e(oe,{color:"primary",density:"compact",class:"ml-0 pl-0"},{default:s(()=>[e(re,{class:"text-h6 font-weight-medium text-white"},{default:s(()=>[e(f,{icon:"ri-close-line",color:"white",onClick:l.closePaymentForm},null,8,["onClick"]),c(" Registrar Pago ")]),_:1}),e(ne),e(f,{icon:"",variant:"text",color:"white",onClick:l.closePaymentForm},{default:s(()=>[e(b,null,{default:s(()=>[c("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),e(ae,{ref:"paymentForm",modelValue:o.validPayment,"onUpdate:modelValue":a[27]||(a[27]=r=>o.validPayment=r)},{default:s(()=>[e(C,{class:"px-4 pt-4 pb-2"},{default:s(()=>[e(V,{flat:"",class:"border",color:"surface"},{default:s(()=>[e(_t,{class:"py-2"},{default:s(()=>[e(gt,{class:"text-subtitle-1 font-weight-medium d-flex align-center"},{default:s(()=>[e(k,{icon:"ri-money-dollar-circle-line",class:"text-primary mr-2",variant:"tonal"}),c(" Resumen de Pagos ")]),_:1})]),_:1}),e(ie),e(C,{class:"px-2 py-3"},{default:s(()=>{var r,u;return[n("div",ia,[n("div",na,[da,n("span",ua,_(l.formatCurrency((u=(r=o.createdOrder)==null?void 0:r.order)==null?void 0:u.total_amount)),1)]),n("div",ca,[ma,n("span",pa,_(l.formatCurrency(o.totalPaid)),1)]),n("div",fa,[ha,n("span",{class:te(["font-weight-medium",l.pendingAmount>0?"text-error":"text-success"])},_(l.formatCurrency(l.pendingAmount)),3)]),e(ie,{class:"my-1"}),n("div",_a,[ga,n("span",ya,_(l.formatCurrency(o.change)),1)])])]}),_:1})]),_:1}),n("div",va,[(S(),L(q,{ref:"paymentsRow",key:o.keyPayments,modulo:"pagos",onUpdateTotal:l.updateTotal},null,8,["onUpdateTotal"]))])]),_:1}),e(le,{class:"px-4 pb-4 pt-2"},{default:s(()=>[e(g,null,{default:s(()=>[e(d,{cols:"12",md:"12",sm:"12",class:"pt-4 pb-0 my-0"},{default:s(()=>[e(f,{variant:"outlined",color:"primary",onClick:l.closePaymentForm,class:"text-capitalize",block:""},{default:s(()=>[c(" Cancelar ")]),_:1},8,["onClick"])]),_:1}),e(d,{cols:"12",md:"12",sm:"12",class:"pt-1 my-0 pb-2"},{default:s(()=>[e(f,{onClick:l.savePayment,loading:o.savingPayment,disabled:!o.validPayment,color:"white",class:"bg-primary text-capitalize",block:""},{default:s(()=>[o.savingPayment?(S(),$(U,{key:1},[c(" Procesando... ")],64)):(S(),$(U,{key:0},[e(b,{icon:"mdi-check-circle-outline",class:"mr-1"}),c(" Confirmar Pago ")],64))]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(ht,{modelValue:o.snackbar,"onUpdate:modelValue":a[30]||(a[30]=r=>o.snackbar=r),color:o.snackbarColor,timeout:4e3},{action:s(({attrs:r})=>[e(f,Y({text:""},r,{onClick:a[29]||(a[29]=u=>o.snackbar=!1)}),{default:s(()=>[c(" Cerrar ")]),_:2},1040)]),default:s(()=>[c(_(o.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])],64)}const Wa=ft(Ut,[["render",ba],["__scopeId","data-v-44edc7bf"]]);export{Wa as default};

import{_ as k}from"./DateRangeField-BKYoIcFJ.js";import{ac as v,e as R,w as t,v as M,o as F,b as e,a as s,V as p,a3 as h,H as c,t as r,a0 as I,x as S,y as T}from"./main-G7GggmvP.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as f,c as y,V as _,d as x,b as B}from"./VCard-BQxw42q_.js";import{V as D}from"./VDataTable-BZeOkjMV.js";import{a as b,V as g}from"./VRow-DH7aR9kf.js";import{a as L,b as z,c as E,V as G}from"./VSnackbar-nnY25wgc.js";import{V as w}from"./VAvatar-B02VXU15.js";import{V as U}from"./VDialog-BHz1YP4b.js";import{V as j}from"./VDivider-BWJONb8H.js";import{V as N}from"./VSpacer-BvA2ByrV.js";import"./VTextField-C2daNm2f.js";import"./index-Dxz9A6E-.js";import"./VImg-Ch7KTabo.js";import"./easing-DY7PVvcf.js";import"./forwardRefs-C-GTDzx5.js";import"./filter-Bl3bQea1.js";import"./VChip-CjnngcFM.js";import"./VOverlay-C0oUUi6-.js";import"./lazy-BCldeQdb.js";import"./ssrBoot-BEVycVPs.js";import"./VCheckboxBtn-CCJ6usBb.js";import"./VTable-zLaNu0tT.js";const H={components:{DateRangeField:k},data(){return{loading:!1,detailLoading:!1,headers:[{title:"Día",key:"date",align:"left",width:"120px"},{title:"Método de Pago",key:"payment_method",align:"left"},{title:"Monto",key:"amount",align:"end"},{title:"Acciones",key:"actions",sortable:!1,align:"center",width:"80px"}],detailHeaders:[{title:"Fecha Pago",key:"payment_date",align:"left",width:"150px"},{title:"ID Orden",key:"order_number",align:"left",width:"100px"},{title:"Cliente",key:"customer",align:"left"},{title:"Monto",key:"amount",align:"end"}],paymentsSummary:{data:[],total:0,current_page:1,last_page:1},paymentDetails:[],selectedPayment:{},paymentMethods:[],selectedPaymentMethod:null,detailDialog:!1,pagination:{page:1,itemsPerPage:10,sortBy:[],sortDesc:[]},dateRange:{start:null,end:null},defaultDateRange:{},snackbar:!1,snackbarText:"",snackbarColor:"success",isInitialLoad:!0}},computed:{...v({userIsAdmin:"isAdmin"})},async created(){this.setDefaultDateRange(),await this.loadPaymentMethods(),await this.fetchData()},methods:{setDefaultDateRange(){const a=new Date,n=new Date;n.setDate(n.getDate()-30),this.defaultDateRange={start:n,end:a},this.isInitialLoad&&(this.dateRange={...this.defaultDateRange})},async loadPaymentMethods(){try{const a=await this.$axios.get(this.$routes.paymentMethods);this.paymentMethods=a.data.data||[]}catch(a){console.error("Error loading payment methods:",a),this.paymentMethods=[]}},async fetchData(){var a,n;this.loading=!0;try{const d={page:this.pagination.page,per_page:this.pagination.itemsPerPage,start_date:(a=this.dateRange)==null?void 0:a.start,end_date:(n=this.dateRange)==null?void 0:n.end,payment_methods:this.selectedPaymentMethod};Object.keys(d).forEach(o=>d[o]===void 0&&delete d[o]);const m=await this.$axios.get(this.$routes.paymentsSummary,{params:d});this.paymentsSummary={data:m.data.data,total:m.data.total,current_page:m.data.current_page,last_page:m.data.last_page},this.isInitialLoad=!1}catch(d){console.error("Error fetching payments summary:",d),this.showSnackbar("Error al cargar el resumen de pagos","error")}finally{this.loading=!1}},resetFilters(){this.dateRange={start:null,end:null},this.selectedPaymentMethod=null,this.pagination.page=1,this.$nextTick(()=>{this.$refs.dateRangeField&&this.$refs.dateRangeField.reset&&this.$refs.dateRangeField.reset()}),this.fetchData()},async showPaymentDetails(a){this.selectedPayment=a,this.detailLoading=!0,this.detailDialog=!0;try{const n={date:a.date,payment_method_id:a.payment_method_id},d=await this.$axios.get(this.$routes.paymentsDetail,{params:n});this.paymentDetails=d.data.data}catch(n){console.error("Error fetching payment details:",n),this.showSnackbar("Error al cargar el detalle de pagos","error")}finally{this.detailLoading=!1}},closeDetailDialog(){this.detailDialog=!1,this.selectedPayment={},this.paymentDetails=[]},handlePaginationChange(a){this.pagination.page=a.page,this.pagination.itemsPerPage=a.itemsPerPage,this.pagination.sortBy=a.sortBy,this.pagination.sortDesc=a.sortDesc,this.fetchData()},calculateTotalAmount(){return this.paymentsSummary.data?this.paymentsSummary.data.reduce((a,n)=>a+(parseFloat(n.amount)||0),0).toFixed(2):0},formatCurrency(a){return a?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(a):"$0"},formatDateGrid(a){if(!a)return"";const[n,d,m]=a.split("-");return`${m}/${d}/${n}`},formatDateTime(a){return a?new Date(a).toLocaleString("es-AR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):""},getPaymentMethodColor(a){return{cash:"success",card:"primary",transfer:"info",digital:"warning",mercadopago:"primary",debit:"info",credit:"warning"}[a]||"secondary"},getPaymentMethodIcon(a){return{cash:"ri-money-dollar-circle-line",card:"ri-bank-card-line",transfer:"ri-exchange-funds-line",digital:"ri-smartphone-line",mercadopago:"ri-smartphone-line",debit:"ri-bank-card-line",credit:"ri-bank-card-line"}[a]||"ri-money-dollar-circle-line"},showSnackbar(a,n){this.snackbarText=a,this.snackbarColor=n,this.snackbar=!0}}},u=a=>(S("data-v-1c03727d"),a=a(),T(),a),O={class:"d-flex flex-column",style:{"min-width":"250px","flex-grow":"1"}},q=u(()=>s("h2",{class:"text-h5 mb-1"},"Resumen de Pagos",-1)),J={class:"text-caption text-medium-emphasis d-flex align-center"},K=u(()=>s("span",{style:{"white-space":"normal"}}," Resumen diario de pagos agrupados por día y método de pago ",-1)),Q={class:"d-flex flex-column"},W={class:"font-weight-medium"},X={class:"d-flex align-center"},Y={class:"text-right text-success"},Z={class:"d-flex justify-center align-center"},$={class:"bg-grey-lighten-4 font-weight-bold",style:{background:"#ccc"}},ee=u(()=>s("td",{class:"text-left"},null,-1)),te=u(()=>s("td",{class:"text-left"},"Total General",-1)),ae={class:"text-right"},se=u(()=>s("td",{class:"text-right"},null,-1)),oe=u(()=>s("span",null,"Resumen del Grupo",-1)),ne={class:"d-flex flex-column"},ie={class:"text-caption text-medium-emphasis"},le={class:"font-weight-medium"},re={class:"d-flex flex-column"},de={class:"text-caption text-medium-emphasis"},ce={class:"font-weight-medium"},me={class:"d-flex flex-column"},pe={class:"text-caption text-medium-emphasis"},ue={class:"font-weight-medium text-success"},he={class:"d-flex flex-column"},ge={class:"font-weight-medium"},fe={class:"font-weight-medium"},_e={class:"d-flex flex-column text-start"},ye={class:"d-block font-weight-medium text-high-emphasis text-truncate"},xe={class:"text-disabled"},De={class:"text-right text-success"};function be(a,n,d,m,o,l){const V=k,P=M("IconBtn");return F(),R(f,null,{default:t(()=>[e(y,{class:"d-flex flex-wrap align-center justify-space-between ga-2"},{default:t(()=>[s("div",O,[q,s("div",J,[e(p,{icon:"ri-information-line",size:"16",class:"mr-1"}),K])])]),_:1}),e(_,{class:"d-flex px-2"},{default:t(()=>[e(D,{headers:o.headers,items:o.paymentsSummary.data||[],class:"text-no-wrap striped-table border-0",loading:o.loading,"items-per-page":o.pagination.itemsPerPage,page:o.pagination.page,"items-length":o.paymentsSummary.total||0,"onUpdate:options":l.handlePaginationChange},{top:t(()=>[e(f,{flat:"",color:"white"},{default:t(()=>[e(_,{class:"mx-0 px-0"},{default:t(()=>[e(b,{dense:"",class:"mx-0 px-0"},{default:t(()=>[e(g,{cols:"12",md:"6",sm:"12",class:"pl-0 pt-0"},{default:t(()=>[e(V,{class:"mt-0",ref:"dateRangeField",modelValue:o.dateRange,"onUpdate:modelValue":n[0]||(n[0]=i=>o.dateRange=i),modelLabel:"Fecha de Pago"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6",sm:"12",class:"pl-0 pt-1"},{default:t(()=>[e(L,{modelValue:o.selectedPaymentMethod,"onUpdate:modelValue":n[1]||(n[1]=i=>o.selectedPaymentMethod=i),items:o.paymentMethods,"item-title":"name","item-value":"id",label:"Método de Pago",clearable:"",class:"mt-0",density:"compact",multiple:"",chips:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(x,{class:"justify-end"},{default:t(()=>[e(h,{variant:"outlined",color:"primary",onClick:l.resetFilters},{default:t(()=>[c(" Reset ")]),_:1},8,["onClick"]),e(h,{variant:"outlined",color:"white",onClick:l.fetchData,loading:o.loading,class:"bg-primary"},{default:t(()=>[c(" Buscar ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),"item.date":t(({item:i})=>[s("div",Q,[s("span",W,r(l.formatDateGrid(i.date)),1)])]),"item.payment_method":t(({item:i})=>[s("div",X,[e(w,{color:l.getPaymentMethodColor(i.payment_method),variant:"tonal",size:"32",class:"mr-2"},{default:t(()=>[e(p,{icon:l.getPaymentMethodIcon(i.payment_method)},null,8,["icon"])]),_:2},1032,["color"]),s("span",null,r(i.payment_method_name),1)])]),"item.amount":t(({item:i})=>[s("div",Y,[s("strong",null,r(l.formatCurrency(i.amount)),1)])]),"item.actions":t(({item:i})=>[s("div",Z,[e(P,{size:"small",onClick:C=>l.showPaymentDetails(i),title:"Ver detalle"},{default:t(()=>[e(p,{icon:"ri-eye-line"})]),_:2},1032,["onClick"])])]),tfoot:t(()=>[s("tfoot",null,[s("tr",$,[ee,te,s("td",ae,r(l.formatCurrency(l.calculateTotalAmount())),1),se])])]),_:1},8,["headers","items","loading","items-per-page","page","items-length","onUpdate:options"]),e(U,{modelValue:o.detailDialog,"onUpdate:modelValue":n[2]||(n[2]=i=>o.detailDialog=i),"max-width":"800px",persistent:""},{default:t(()=>[e(f,{class:"rounded-lg"},{default:t(()=>[e(z,{color:"primary",density:"compact"},{default:t(()=>[e(E,{class:"text-white font-weight-medium"},{default:t(()=>[e(h,{icon:"",variant:"text",color:"white",onClick:l.closeDetailDialog},{default:t(()=>[e(p,null,{default:t(()=>[c("ri-close-line")]),_:1})]),_:1},8,["onClick"]),c(" Detalle de Pagos - "+r(o.selectedPayment.date)+" - "+r(o.selectedPayment.payment_method_name),1)]),_:1})]),_:1}),e(_,{class:"px-4 pt-4 pb-2"},{default:t(()=>[e(f,{flat:"",border:"",class:"mb-4",color:"primary-lighten-5"},{default:t(()=>[e(B,{class:"py-0 mt-2"},{default:t(()=>[e(y,{class:"d-flex align-center"},{default:t(()=>[e(w,{icon:"ri-money-dollar-circle-line",class:"text-info mr-2",variant:"tonal"}),oe]),_:1})]),_:1}),e(j,{class:"my-1"}),e(_,null,{default:t(()=>[e(b,{dense:""},{default:t(()=>[e(g,{cols:"6",sm:"4"},{default:t(()=>[s("div",ne,[s("span",ie,[e(p,{icon:"ri-calendar-line",size:"14",class:"mr-1"}),c(" Fecha ")]),s("span",le,r(l.formatDateGrid(o.selectedPayment.date)),1)])]),_:1}),e(g,{cols:"6",sm:"4"},{default:t(()=>[s("div",re,[s("span",de,[e(p,{icon:"ri-bank-card-line",size:"14",class:"mr-1"}),c(" Método de Pago ")]),s("span",ce,r(o.selectedPayment.payment_method_name),1)])]),_:1}),e(g,{cols:"6",sm:"4"},{default:t(()=>[s("div",me,[s("span",pe,[e(p,{icon:"ri-money-dollar-circle-line",size:"14",class:"mr-1"}),c(" Total ")]),s("span",ue,r(l.formatCurrency(o.selectedPayment.amount)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{headers:o.detailHeaders,items:o.paymentDetails,class:"text-no-wrap striped-table border",loading:o.detailLoading,"items-per-page":"5",page:o.pagination.page},{"item.payment_date":t(({item:i})=>[s("div",he,[s("span",ge,r(l.formatDateTime(i.payment_date)),1)])]),"item.order_number":t(({item:i})=>[s("span",fe,"#"+r(i.order_number),1)]),"item.customer":t(({item:i})=>[s("div",_e,[s("span",ye,r(i.customer_name),1),s("small",xe,r(i.customer_contact),1)])]),"item.amount":t(({item:i})=>[s("div",De,[s("strong",null,r(l.formatCurrency(i.amount)),1)])]),_:1},8,["headers","items","loading","page"])]),_:1}),e(x,null,{default:t(()=>[e(N),e(h,{variant:"outlined",color:"primary",onClick:l.closeDetailDialog},{default:t(()=>[c(" Cerrar ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(G,{modelValue:o.snackbar,"onUpdate:modelValue":n[4]||(n[4]=i=>o.snackbar=i),color:o.snackbarColor,timeout:3e3},{action:t(({attrs:i})=>[e(h,I({text:""},i,{onClick:n[3]||(n[3]=C=>o.snackbar=!1)}),{default:t(()=>[c(" Cerrar ")]),_:2},1040)]),default:t(()=>[c(r(o.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})]),_:1})}const qe=A(H,[["render",be],["__scopeId","data-v-1c03727d"]]);export{qe as default};

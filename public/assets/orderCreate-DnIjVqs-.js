import{_ as W}from"./PaymentsRow-DVyivIB5.js";import{ab as Y,c as P,e as x,w as s,b as e,F,v as Z,ac as J,o as v,l as I,n as D,a9 as B,aa as R,H as c,t as h,a2 as m,V as y,Z as K,a as o,ad as Q,$ as X,x as $,y as ee}from"./main-DOucTeTc.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as S}from"./VForm-C4sJc7XK.js";import{V as O}from"./VDialog-BEsC9W0L.js";import{V as se,a as k,b as U,c as q}from"./VSnackbar-DomS3EVk.js";import{V as n,a as _}from"./VRow-Ir3wg7QB.js";import{a as b,V as w,d as T,b as ae,c as re}from"./VCard-BZ4rU-iA.js";import{V}from"./VAvatar-CfLGKvOU.js";import{V as z}from"./VSheet-CH3q31Uq.js";import{b as N,d as j,e as ie}from"./VChip-Dd9kPkn6.js";import{V as le}from"./VSwitch-BA0jDN5K.js";import{V as f}from"./VTextField-2ruvtwyY.js";import{V as oe}from"./VDataTable-DpdSlkcl.js";import{V as L}from"./VDivider-ChX3vsGx.js";import{V as de}from"./VTextarea-BEcfH4C2.js";import{V as ne}from"./VContainer-liPaIbhe.js";import{V as A}from"./VSpacer-DRVxq8PH.js";import"./forwardRefs-C-GTDzx5.js";import"./VOverlay-Ejijsbhx.js";import"./easing-DY7PVvcf.js";import"./lazy-DBukmiYt.js";import"./VImg-CfnnTD9W.js";import"./filter-FbS_J5vu.js";import"./VCheckboxBtn-BC80PW81.js";import"./index-D5A_Hox7.js";import"./ssrBoot-BIumrUOr.js";import"./VTable-ivgGpSdg.js";const ce={data(){return{isEditing:!1,editingOrderId:null,keyOrderForm:1,showFooter:!1,validOrder:!1,validCustomer:!1,validPayment:!1,creatingOrder:!1,savingCustomer:!1,savingPayment:!1,customerDialog:!1,paymentDialog:!1,paymentFormDialog:!1,customers:[],products:[],sellers:[],order:{customer_id:null,shipping_address:"",subtotal:0,aditional:0,discount_amount:0,total_amount:0,notes:"",items:[],shipping:0,shipping_address_status:!1,seller_id:""},newItem:{product_id:null,quantity:1,unit_price:0,unit_cost_price:0},newCustomer:{name:"",email:"",telephone:"",locality_id:"",address:""},payment:{amount:0,payment_method_id:null,notes:""},createdOrder:null,snackbar:!1,snackbarText:"",snackbarColor:"success",itemHeaders:[{title:"",key:"actions",width:"25px",sortable:!1},{title:"Producto",key:"product_name",width:"300px"},{title:"Cantidad",key:"quantity",width:"80px"},{title:"Precio Unit.",key:"unit_price",width:"150px"},{title:"Total",key:"total_price",width:"150px",align:"end"}],localities:[],keyPayments:0,change:0,totalPaid:0,isAdmibBebidas:!1,saveButtonLabel:"Crear Orden",priceLists:[],selectedPriceList:""}},computed:{...Y({}),selectedCustomer(){return this.customers.find(i=>i.id===this.order.customer_id)},canAddItem(){return this.newItem.product_id&&this.newItem.quantity>0&&this.newItem.unit_price>0},canCreateOrder(){return this.order.customer_id&&this.order.shipping_address&&this.order.items.length>0},pendingAmount(){let i=this.createdOrder.order.total_paid>0?this.createdOrder.order.total_paid:0;return this.createdOrder.order.total_amount-i}},beforeMount(){},async created(){this.$route.query.edit&&this.$route.query.orderId&&(this.isEditing=!0,this.editingOrderId=this.$route.query.orderId,this.saveButtonLabel="Editar Orden",await this.loadOrderData()),await this.loadData()},methods:{async loadOrderData(){Swal.alertGetInfo();try{this.isAdminBebidas=this.$is(["bebidas-admin"]);const i=await this.$axios.get(`${this.$routes.orders}/${this.editingOrderId}`),t=i.data.data||i.data;t.items&&t.items.length>0&&(this.selectedPriceList=t.items[0].price_list_id),this.$route.meta.title="Editar Orden N° "+t.order_number,document.title=this.$route.meta.title,this.order={customer_id:t.customer.id,shipping_address:t.shipping_address,delivery_date:t.delivery_date,subtotal:parseFloat(t.subtotal),aditional:parseFloat(t.aditional),discount_amount:parseFloat(t.discount_amount),total_amount:parseFloat(t.total_amount),notes:t.notes,seller_id:t.seller_id,items:t.items.map(d=>({product_id:d.product_id,quantity:parseInt(d.quantity),unit_price:parseFloat(d.unit_price),unit_cost_price:parseFloat(d.unit_cost_price),total_price:parseFloat(d.total_price),total_profit:parseFloat(d.total_profit)})),shipping:t.shipping?1:0},this.$forceUpdate()}catch(i){console.error("Error al cargar datos de la orden:",i),this.showSnackbar("Error al cargar la orden para edición","error")}finally{Swal.close()}},formatDateForInput(i){if(!i)return"";const t=new Date(i);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`},productTitle(i){const t=this.$store.getters.currentUser;let d=i.name;return t.data.tenant.id==2&&(d=`[${i.code}] ${i.name} `),t.data.tenant.id==3&&(d=`${i.name} [${i.code}]`),d},setDate(i){if(i)return;let t=this.getDateTimeTomorrow();this.order.delivery_date=t},updateTotal(i){this.totalPaid=i,this.change=this.totalPaid>this.createdOrder.order.total_amount?this.totalPaid-this.createdOrder.order.total_amount:0},async loadData(){Swal.alertGetInfo();try{this.isAdminBebidas=this.$is(["bebidas-admin"]);const[i,t,d,p]=await Promise.all([this.$axios.get(this.$routes.customers),this.$axios.get(this.$routes.products),this.$axios.get(this.$routes.localities),this.$axios.get(this.$routes.priceLists)]);if(this.isAdminBebidas){const a=await this.$axios.get(this.$routes.usersList);this.sellers=a.data.data||a.data}if(this.customers=i.data.data||i.data,this.products=t.data.data||t.data,this.localities=d.data.data||d.data,this.priceLists=p.data.data||p.data,this.$store.getters.currentUser.data.id==9)this.selectedPriceList=2,this.onPriceListChange();else{let a=this.priceLists.find(l=>l.is_default===1);this.selectedPriceList=a.id,this.onPriceListChange()}(this.$is("bebidas-admin")||this.$is("bebidas-user"))&&(this.order.shipping=1),(this.$is("superadmin")||this.$is("bebidas-admin")||this.$is("petshop-admin"))&&this.order.seller_id==""&&(this.order.seller_id=this.$store.getters.currentUser.data.id),this.$store.getters.currentUser.data.tenant.id==3&&(this.order.customer_id=1550,this.onCustomerChange()),this.setDate(this.order.delivery_date),this.$forceUpdate()}catch(i){console.error("Error loading data:",i),this.showSnackbar("Error al cargar los datos","error")}finally{Swal.close()}},onCustomerChange(){this.selectedCustomer&&(this.$store.getters.currentUser.data.tenant.id==2?this.order.shipping_address=this.selectedCustomer.address:this.order.shipping_address=this.selectedCustomer.firstname+", "+this.selectedCustomer.address+", "+this.selectedCustomer.locality.name+", "+this.selectedCustomer.telephone)},useCustomerAddress(){this.selectedCustomer&&(this.order.shipping_address=this.selectedCustomer.address)},onProductChange(){if(this.newItem.product_id){const i=this.getProductById(this.newItem.product_id);i&&(this.newItem.unit_price=parseFloat(i.display_price||i.sale_price||0),this.newItem.unit_cost_price=parseFloat(i.purchase_price||0))}},onPriceListChange(){this.products=this.products.map(i=>{const t=i.price_lists.find(d=>d.id===this.selectedPriceList);return{...i,sale_price:t?t.pivot.sale_price:0,current_price_list:t||null}}),this.newItem.product_id&&this.onProductChange()},getProductById(i){return this.products.find(t=>t.id===i)},getProductStock(i){if(!i)return null;const t=this.products.find(d=>d.id===i);return t?parseFloat(t.stocks[0].quantity)-parseFloat(t.stocks[0].reserved_quantity):0},showStockWarning(i,t){return t>this.getProductStock(i)},calculateItemTotal(){return this.newItem.quantity*this.newItem.unit_price},addItem(){if(!this.canAddItem)return;this.getProductById(this.newItem.product_id);const i=this.newItem.quantity*this.newItem.unit_price,t=this.newItem.quantity*this.newItem.unit_cost_price;this.order.items.push({product_id:this.newItem.product_id,quantity:this.newItem.quantity,unit_price:this.newItem.unit_price,unit_cost_price:this.newItem.unit_cost_price,total_price:i,total_profit:i-t,price_list_id:this.selectedPriceList}),this.newItem={product_id:null,quantity:1,unit_price:0,unit_cost_price:0},this.calculateTotals()},removeItem(i){this.order.items.splice(i,1),this.calculateTotals()},updateItemTotal(i){const t=this.order.items[i];t.total_price=t.quantity*t.unit_price,t.total_profit=t.total_price-t.quantity*t.unit_cost_price,this.calculateTotals()},calculateTotals(){this.order.subtotal=this.order.items.reduce((i,t)=>i+parseFloat(t.total_price),0),this.order.total_amount=this.order.subtotal+parseFloat(this.order.aditional||0)-parseFloat(this.order.discount_amount||0)},openCustomerDialog(){this.customerDialog=!0},closeCustomerDialog(){this.customerDialog=!1,this.newCustomer={name:"",email:"",phone:"",document:"",address:""}},async saveCustomer(){if(await this.$refs.customerForm.validate()){this.savingCustomer=!0;try{const t=await this.$axios.post(this.$routes.customers,this.newCustomer),d=t.data.data||t.data;this.customers.push(d),this.order.customer_id=d.id,this.order.shipping_address=d.address,this.showSnackbar("Cliente creado exitosamente","success"),this.closeCustomerDialog()}catch(t){console.error("Error saving customer:",t),this.showSnackbar("Error al crear el cliente","error")}finally{this.savingCustomer=!1}}},async updateOrder(){if(Swal.alertGetInfo(),!!await this.$refs.orderForm.validate()){this.creatingOrder=!0;try{const t={...this.order,quantity_products:this.order.items.reduce((p,a)=>p+parseInt(a.quantity),0),total_cost:this.order.items.reduce((p,a)=>p+a.quantity*a.unit_cost_price,0),total_profit:this.order.items.reduce((p,a)=>p+parseFloat(a.total_profit),0)},d=await this.$axios.post(`${this.$routes.orders}-update/${this.editingOrderId}`,t);this.createdOrder=d.data.data||d.data,this.showSnackbar("Orden actualizada exitosamente","success"),this.$router.push({path:"/order-search"})}catch(t){console.error("Error updating order:",t),this.showSnackbar("Error al actualizar la orden","error")}finally{this.creatingOrder=!1,Swal.close()}}},async createOrder(){if(Swal.alertGetInfo(),this.isEditing){await this.updateOrder();return}if(await this.$refs.orderForm.validate()){this.creatingOrder=!0;try{const t={...this.order,quantity_products:this.order.items.reduce((p,a)=>p+parseInt(a.quantity),0),total_cost:this.order.items.reduce((p,a)=>p+a.quantity*a.unit_cost_price,0),total_profit:this.order.items.reduce((p,a)=>p+parseFloat(a.total_profit),0)},d=await this.$axios.post(this.$routes.orders,t);this.createdOrder=d.data.data||d.data,this.paymentDialog=!0}catch(t){console.error("Error creating order:",t),this.showSnackbar("Error al crear la orden","error")}finally{this.creatingOrder=!1,Swal.close()}}},openPaymentForm(){this.paymentDialog=!1,this.paymentFormDialog=!0},closePaymentForm(){this.paymentFormDialog=!1,this.clearForm()},clearForm(){this.order={customer_id:null,shipping:0,shipping_address:"",delivery_date:"",subtotal:0,aditional:0,discount_amount:0,total_amount:0,notes:"",items:[]},this.$store.getters.currentUser.data.tenant.id==3&&(this.order.customer_id=1550),this.$refs.orderForm.resetValidation(),this.$nextTick(()=>{this.$refs.orderForm.resetValidation()}),this.loadData()},async validatePayments(i){if(i.length<=0)return"Debe incluir al menos una modalidad de pago";const t=new Set;i.reduce((d,p)=>d+parseFloat(p.amount),0);for(const d of i){if(!d.amount||!d.payment_method_id)return"Verifique la informacion de los pagos";if(t.has(d.payment_method_id.id))return"Ha seleccionado mas de una vez el mismo metodo de pago. Metodo de pago: "+d.payment_method_id.name;t.add(d.payment_method_id.id)}return!0},async savePayment(){const i=await this.validatePayments(this.$refs.paymentsRow.payments);if(i!==!0)return this.showSnackbar(i,"error");this.savingPayment=!0,Swal.alertGetInfo();try{const t={order_id:this.createdOrder.order.id,payments:this.$refs.paymentsRow.payments},d=await this.$axios.post(this.$routes.payments,t);console.log(d),d.status==201&&(this.showSnackbar("Pago registrado exitosamente","success"),this.finishOrder())}catch(t){console.error("Error saving payment:",t),this.showSnackbar("Error al registrar el pago","error")}finally{this.savingPayment=!1,Swal.close()}},async updateOrderStatus(i){try{await this.$axios.patch(`${this.$routes.orders}/${this.createdOrder.id}/status`,{status:i})}catch(t){console.error("Error updating order status:",t)}},finishOrder(){this.clearForm(),this.paymentDialog=!1,this.paymentFormDialog=!1},formatNumber(i){return new Intl.NumberFormat("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(i||0)},formatCurrency(i){return i?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(i):"$0"},showSnackbar(i,t){this.snackbarText=i,this.snackbarColor=t,this.snackbar=!0},toggleShipping(i){console.log(i.shipping),i.shipping_address_status=!i.shipping_address_status}}},C=i=>($("data-v-4bb1eb9e"),i=i(),ee(),i),ue={class:"ml-2 text-success font-weight-bold"},me={class:"text-caption"},pe={class:"text-warning pt-6",style:{width:"15px !important"}},he={class:"v-card-item"},_e={class:"v-card-item__content"},fe={class:"v-card-title"},ye={class:"text-h5"},ge={style:{"min-height":"280px","max-height":"270px","overflow-y":"auto"}},be={class:"v-card-item"},we={class:"v-card-item__content"},Ve={class:"v-card-title"},ve={class:"text-h5"},Ce={class:"v-card-item"},xe={class:"v-card-item__content"},ke={class:"v-card-title"},Ie={class:"text-h5"},Pe={class:"text-center mb-5"},Fe=C(()=>o("h3",{class:"text-h5 font-weight-medium text-success mb-2"}," ¡Orden creada exitosamente! ",-1)),De=C(()=>o("p",{class:"text-medium-emphasis mb-0"}," ¿Deseas registrar un pago para esta orden? ",-1)),Se={class:"d-flex justify-space-between align-center mb-3"},Oe=C(()=>o("span",{class:"text-medium-emphasis"},"Número de Orden:",-1)),Ue={class:"font-weight-medium"},qe={class:"d-flex justify-space-between align-center"},Te=C(()=>o("span",{class:"text-medium-emphasis"},"Total:",-1)),Le={class:"text-h5 font-weight-medium text-success"},Ae={class:"d-flex flex-column gap-2"},Ee={class:"d-flex justify-space-between"},Be=C(()=>o("span",{class:"text-caption text-medium-emphasis"},"Total Orden:",-1)),Re={class:"font-weight-medium"},ze={class:"d-flex justify-space-between"},Ne=C(()=>o("span",{class:"text-caption text-medium-emphasis"},"Total Pagado:",-1)),je={class:"font-weight-medium text-primary"},Ge={class:"d-flex justify-space-between"},He=C(()=>o("span",{class:"text-caption text-medium-emphasis"},"Saldo Pendiente:",-1)),Me={class:"d-flex justify-space-between"},We=C(()=>o("span",{class:"text-caption text-medium-emphasis"},"Vuelto:",-1)),Ye={class:"font-weight-medium text-success"},Ze={class:"mt-4"};function Je(i,t,d,p,a,l){const G=Z("IconBtn"),H=W,M=J("mask");return v(),P(F,null,[(v(),x(S,{key:a.keyOrderForm,ref:"orderForm",modelValue:a.validOrder,"onUpdate:modelValue":t[16]||(t[16]=r=>a.validOrder=r)},{default:s(()=>[e(_,null,{default:s(()=>[e(n,{cols:"12",sm:"12",md:"6"},{default:s(()=>[e(b,null,{default:s(()=>[e(w,{class:"mb-0 pb-2"},{default:s(()=>[e(_,{class:"mb-0 pb-0"},{default:s(()=>[i.isAdminBebidas?(v(),x(n,{key:0,cols:"1",md:"1",sm:"1",class:"mb-0 pt-3 d-none d-sm-flex"},{default:s(()=>[e(V,{icon:"ri-user-line",class:"text-error mr-2",variant:"tonal",size:"40"})]),_:1})):I("",!0),i.isAdminBebidas?(v(),x(n,{key:1,cols:"12",sm:"11",md:"10",class:"mb-0 pt-4 ml-0 pr-0 mr-0"},{default:s(()=>[e(k,{modelValue:a.order.seller_id,"onUpdate:modelValue":t[0]||(t[0]=r=>a.order.seller_id=r),items:a.sellers,"item-title":"name","item-value":"id",label:"Vendedor",rules:[r=>!!r||"Vendedor es requerido"],clearable:"",density:"compact","return-object":""},null,8,["modelValue","items","rules"])]),_:1})):I("",!0)]),_:1}),e(_,{class:D(["mb-0",i.isAdminBebidas?"pb-0":"py-8"])},{default:s(()=>[e(n,{cols:"1",md:"1",sm:"1",class:"mb-0 pt-0 d-none d-sm-flex"},{default:s(()=>[e(V,{icon:"ri-user-line",class:"text-info mr-2",variant:"tonal",size:"40"})]),_:1}),e(n,{cols:"9",sm:"9",md:"5",class:"mb-0 pt-0 ml-0"},{default:s(()=>[e(k,{modelValue:a.order.customer_id,"onUpdate:modelValue":[t[1]||(t[1]=r=>a.order.customer_id=r),l.onCustomerChange],items:a.customers,"item-title":"address","item-value":"id",label:"Cliente",rules:[r=>!!r||"Cliente es requerido"],clearable:"",density:"compact"},{item:s(({props:r,item:u})=>[e(z,{border:"info md"},{default:s(()=>[e(N,B(R(r)),{default:s(()=>[e(j,{class:"text-caption"},{default:s(()=>{var g;return[c(h(u.raw.firstname)+", "+h(u.raw.telephone)+", "+h((g=u.raw.locality)==null?void 0:g.name),1)]}),_:2},1024)]),_:2},1040)]),_:2},1024)]),_:1},8,["modelValue","items","rules","onUpdate:modelValue"])]),_:1}),e(n,{cols:"auto",class:"mb-0 pt-0"},{default:s(()=>[e(m,{onClick:l.openCustomerDialog,color:i.$cv("principal"),title:"nuevo cliente"},{default:s(()=>[e(y,{icon:"ri-user-add-line",class:""})]),_:1},8,["onClick","color"])]),_:1}),e(n,{cols:"9",sm:"6",md:"4",class:"mb-0 pt-0 ml-0"},{default:s(()=>[e(k,{modelValue:a.selectedPriceList,"onUpdate:modelValue":[t[2]||(t[2]=r=>a.selectedPriceList=r),l.onPriceListChange],items:a.priceLists,"item-title":"name","item-value":"id",label:"Lista de Precios",rules:[r=>!!r||"Lista de precios es requerida"],clearable:"",density:"compact"},null,8,["modelValue","items","rules","onUpdate:modelValue"])]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",sm:"12",md:"6"},{default:s(()=>[e(b,null,{default:s(()=>[e(w,{class:"mb-0 pb-2"},{default:s(()=>[e(_,{class:"mb-0 pb-0"},{default:s(()=>[e(n,{cols:"1",md:"1",class:"mb-0 pb-0 pt-2 d-none d-sm-flex"},{default:s(()=>[e(V,{icon:"ri-map-pin-line",class:"text-info mr-2",variant:"tonal"})]),_:1}),e(n,{cols:"1",md:"1",class:"mb-0 pt-5 ml-1"},{default:s(()=>[e(le,{modelValue:a.order.shipping,"onUpdate:modelValue":t[3]||(t[3]=r=>a.order.shipping=r),"true-value":1,"false-value":0,color:"primary","hide-details":"",title:"Requiere Envío",onClick:t[4]||(t[4]=r=>l.toggleShipping(a.order))},null,8,["modelValue"])]),_:1}),e(n,{cols:"8",sm:"8",md:"8",class:"mb-0 pt-3"},{default:s(()=>[e(f,{modelValue:a.order.shipping_address,"onUpdate:modelValue":t[5]||(t[5]=r=>a.order.shipping_address=r),label:"Dirección de Entrega",rules:[r=>!!r||"Dirección de entrega es requerida"],disabled:!a.order.shipping,density:"compact"},null,8,["modelValue","rules","disabled"])]),_:1}),e(n,{cols:"auto",md:"auto",class:"mb-0"},{default:s(()=>[e(m,{onClick:l.useCustomerAddress,color:i.$cv("principal"),title:"Usar del cliente"},{default:s(()=>[e(y,{icon:"ri-refresh-line",class:"mr-2"})]),_:1},8,["onClick","color"])]),_:1})]),_:1}),e(_,{class:"mb-0 pb-2"},{default:s(()=>[e(n,{cols:"1",md:"1",class:"mb-0 pb-0 pt-0 d-none d-sm-flex"},{default:s(()=>[e(V,{icon:"ri-truck-line",class:"text-info mr-2",variant:"tonal"})]),_:1}),e(n,{cols:"1",md:"1",class:"ml-1"}),e(n,{cols:"8",sm:"8",md:"8",class:"mb-0 pt-0"},{default:s(()=>[K(e(f,{modelValue:a.order.delivery_date,"onUpdate:modelValue":t[6]||(t[6]=r=>a.order.delivery_date=r),label:"Fecha de Entrega",placeholder:"dd/mm/yyyy",clearable:"",onFocus:t[7]||(t[7]=r=>l.setDate(a.order.delivery_date)),disabled:!a.order.shipping,density:"compact"},null,8,["modelValue","disabled"]),[[M,"##/##/####"]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,null,{default:s(()=>[e(n,{cols:"12",sm:"12",md:"12"},{default:s(()=>[e(b,null,{default:s(()=>[e(w,{class:"mb-0 pb-3"},{default:s(()=>[e(_,{class:"mb-0 pb-0"},{default:s(()=>[e(n,{class:"mb-0 pb-0 pt-4 d-none d-sm-flex flex-grow-0"},{default:s(()=>[e(V,{icon:"ri-shopping-cart-line",class:"text-info mr-2",variant:"tonal",size:"40"})]),_:1}),e(n,{cols:"8",md:"5",class:"pt-5"},{default:s(()=>[e(k,{modelValue:a.newItem.product_id,"onUpdate:modelValue":[t[8]||(t[8]=r=>a.newItem.product_id=r),l.onProductChange],items:a.products,"item-title":l.productTitle,"item-value":"id",label:"Seleccionar Producto",clearable:"",density:"compact"},{item:s(({props:r,item:u})=>[e(z,{border:"info md"},{default:s(()=>[e(N,B(R(r)),{default:s(()=>[e(j,{class:"text-caption"},{default:s(()=>[i.$is("bebidas-user")==!1?(v(),x(ie,{key:0,color:l.getProductStock(u.raw.id)>0?"success":"error"},{default:s(()=>[c("Stock: "+h(l.getProductStock(u.raw.id)),1)]),_:2},1032,["color"])):I("",!0),o("span",ue," $"+h(l.formatNumber(u.raw.display_price||u.raw.sale_price)),1)]),_:2},1024)]),_:2},1040)]),_:2},1024)]),_:1},8,["modelValue","items","item-title","onUpdate:modelValue"])]),_:1}),e(n,{cols:"4",md:"1",class:"pr-0"},{default:s(()=>[o("div",{class:D([a.newItem.product_id&&l.showStockWarning(a.newItem.product_id,a.newItem.quantity)?"bg-warning-2 rounded-lg":"","px-2 pt-2"])},[e(f,{modelValue:a.newItem.quantity,"onUpdate:modelValue":t[9]||(t[9]=r=>a.newItem.quantity=r),label:"Cant",type:"number",min:"1",rules:[r=>!!r||"Cantidad requerida",r=>r>0||"Debe ser mayor a 0"],density:"compact"},null,8,["modelValue","rules"]),o("div",me," En stock: "+h(l.getProductStock(a.newItem.product_id)),1)],2)]),_:1}),o("div",pe,[a.newItem.product_id&&l.showStockWarning(a.newItem.product_id,a.newItem.quantity)?(v(),x(y,{key:0,icon:"ri-error-warning-fill",title:"Stock Insuficiente"})):I("",!0)]),e(n,{cols:"6",md:"2",class:"pt-5"},{default:s(()=>[e(f,{modelValue:a.newItem.unit_price,"onUpdate:modelValue":t[10]||(t[10]=r=>a.newItem.unit_price=r),label:"Precio Unitario",type:"number",step:"0.01",prefix:"$",rules:[r=>!!r||"Precio requerido",r=>r>0||"Debe ser mayor a 0"],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"6",md:"2",class:"pt-5"},{default:s(()=>[e(f,{"model-value":l.calculateItemTotal(),label:"Total",prefix:"$",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"])]),_:1}),e(n,{cols:"12",md:"1",class:"pt-5"},{default:s(()=>[e(m,{color:"primary",onClick:l.addItem,disabled:!l.canAddItem,block:""},{default:s(()=>[e(y,{icon:"ri-add-line"})]),_:1},8,["onClick","disabled"])]),_:1})]),_:1}),e(_,{class:"my-0"},{default:s(()=>[e(n,{cols:"12",sm:"12",md:"9"},{default:s(()=>[e(b,null,{default:s(()=>[o("div",he,[o("div",_e,[o("div",fe,[o("h5",ye,[e(V,{icon:"ri-luggage-cart-line",class:"text-info mr-2",variant:"tonal"}),c("Productos agregados ")])])])]),e(w,null,{default:s(()=>[o("div",ge,[e(oe,{headers:a.itemHeaders,items:a.order.items,class:"elevation-1","no-data-text":"No hay productos agregados",density:"compact","items-per-page":1e3},Q({"item.product_name":s(({item:r})=>{var u;return[c(h((u=l.getProductById(r.product_id))==null?void 0:u.name),1)]}),"item.unit_price":s(({item:r,index:u})=>[e(f,{modelValue:r.unit_price,"onUpdate:modelValue":g=>r.unit_price=g,type:"number",step:"0.01",prefix:"$",density:"compact","hide-details":"",onInput:g=>l.updateItemTotal(u),class:"ma-0 pa-0 text-sm"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),"item.quantity":s(({item:r,index:u})=>[e(f,{modelValue:r.quantity,"onUpdate:modelValue":g=>r.quantity=g,type:"number",min:"1",density:"compact","hide-details":"",onInput:g=>l.updateItemTotal(u),style:{width:"80px"}},null,8,["modelValue","onUpdate:modelValue","onInput"])]),"item.total_price":s(({item:r})=>[c(" $"+h(l.formatNumber(r.total_price)),1)]),"item.actions":s(({index:r})=>[e(G,{size:"small",color:"error",onClick:u=>l.removeItem(r)},{default:s(()=>[e(y,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])]),_:2},[a.showFooter?void 0:{name:"bottom",fn:s(()=>[]),key:"0"}]),1032,["headers","items"])])]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",sm:"12",md:"3"},{default:s(()=>[e(b,null,{default:s(()=>[o("div",be,[o("div",we,[o("div",Ve,[o("h5",ve,[e(V,{icon:"ri-calculator-line",class:"text-info mr-2",variant:"tonal"}),c("Totales ")])])])]),e(w,null,{default:s(()=>[e(_,null,{default:s(()=>[e(n,{cols:"12",md:"12"},{default:s(()=>[e(f,{"model-value":l.formatCurrency(a.order.subtotal),label:"Subtotal",readonly:"",variant:"outlined",density:"compact",class:"custom-bg-gray number-end"},null,8,["model-value"])]),_:1}),e(n,{cols:"12",md:"12"},{default:s(()=>[e(f,{modelValue:a.order.discount_amount,"onUpdate:modelValue":t[11]||(t[11]=r=>a.order.discount_amount=r),label:"Descuento",type:"number",step:"0.01",prefix:"$",onInput:l.calculateTotals,density:"compact",class:"number-end"},null,8,["modelValue","onInput"])]),_:1}),e(n,{cols:"12",md:"12"},{default:s(()=>[e(f,{modelValue:a.order.aditional,"onUpdate:modelValue":t[12]||(t[12]=r=>a.order.aditional=r),label:"Adicional",type:"number",step:"0.01",prefix:"$",onInput:l.calculateTotals,density:"compact",class:"number-end"},null,8,["modelValue","onInput"])]),_:1})]),_:1}),e(L,{class:"my-4"}),e(_,null,{default:s(()=>[e(n,{cols:"12",md:"12"},{default:s(()=>[e(f,{"model-value":l.formatCurrency(a.order.total_amount),label:"Total Final",readonly:"",variant:"outlined",class:"text-h6 custom-bg-gray number-end",density:"compact"},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,null,{default:s(()=>[e(n,{cols:"12",sm:"12",md:"12"},{default:s(()=>[e(b,null,{default:s(()=>[o("div",Ce,[o("div",xe,[o("div",ke,[o("h5",Ie,[e(V,{icon:"ri-file-text-line",class:"text-info mr-2",variant:"tonal"}),c("Notas Adicionales ")])])])]),e(w,null,{default:s(()=>[e(de,{modelValue:a.order.notes,"onUpdate:modelValue":t[13]||(t[13]=r=>a.order.notes=r),label:"Notas de la orden",rows:"2",style:{height:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(_,null,{default:s(()=>[e(n,{cols:"12",class:"text-center"},{default:s(()=>[e(m,{color:"primary",variant:"outlined",class:"mr-4",onClick:t[14]||(t[14]=r=>i.$router.go(-1))},{default:s(()=>[e(y,{icon:"ri-close-circle-line",class:"mr-2"}),c(" Cancelar ")]),_:1}),e(m,{color:"primary",class:"mr-4",onClick:t[15]||(t[15]=r=>i.$router.push({path:"order-search"}))},{default:s(()=>[e(y,{icon:"ri-shopping-bag-line",class:"mr-2"}),c(" Ordenes ")]),_:1}),e(m,{color:"primary",onClick:l.createOrder,loading:a.creatingOrder,disabled:!l.canCreateOrder},{default:s(()=>[e(y,{icon:"ri-save-line",class:"mr-2"}),c(" "+h(a.saveButtonLabel),1)]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])),e(O,{modelValue:a.customerDialog,"onUpdate:modelValue":t[23]||(t[23]=r=>a.customerDialog=r),"max-width":"600px"},{default:s(()=>[e(b,null,{default:s(()=>[e(U,{color:"primary"},{default:s(()=>[e(m,{icon:"ri-close-line",color:"white",onClick:l.closeCustomerDialog},null,8,["onClick"]),e(q,null,{default:s(()=>[c("Nuevo Cliente")]),_:1})]),_:1}),e(S,{ref:"customerForm",modelValue:a.validCustomer,"onUpdate:modelValue":t[22]||(t[22]=r=>a.validCustomer=r)},{default:s(()=>[e(w,null,{default:s(()=>[e(ne,null,{default:s(()=>[e(_,null,{default:s(()=>[e(n,{cols:"12",sm:"6"},{default:s(()=>[e(f,{modelValue:a.newCustomer.address,"onUpdate:modelValue":t[17]||(t[17]=r=>a.newCustomer.address=r),label:"Dirección",rules:[r=>!!r||"Dirección es requerida"],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:s(()=>[e(f,{modelValue:a.newCustomer.telephone,"onUpdate:modelValue":t[18]||(t[18]=r=>a.newCustomer.telephone=r),label:"Teléfono",rules:[r=>!!r||"Teléfono es requerido"],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:s(()=>[e(f,{modelValue:a.newCustomer.firstname,"onUpdate:modelValue":t[19]||(t[19]=r=>a.newCustomer.firstname=r),label:"Nombre",density:"compact"},null,8,["modelValue"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:s(()=>[e(k,{modelValue:a.newCustomer.locality_id,"onUpdate:modelValue":t[20]||(t[20]=r=>a.newCustomer.locality_id=r),items:a.localities,"item-title":"name","item-value":"id",label:"Localidad",clearable:"",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:s(()=>[e(f,{modelValue:a.newCustomer.email,"onUpdate:modelValue":t[21]||(t[21]=r=>a.newCustomer.email=r),label:"Email",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(T,null,{default:s(()=>[e(A),e(m,{variant:"outlined",color:"primary",onClick:l.closeCustomerDialog},{default:s(()=>[c(" Cancelar ")]),_:1},8,["onClick"]),e(m,{color:"white",class:"bg-primary",onClick:l.saveCustomer,loading:a.savingCustomer},{default:s(()=>[c(" Guardar Cliente ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(O,{modelValue:a.paymentDialog,"onUpdate:modelValue":t[26]||(t[26]=r=>a.paymentDialog=r),"max-width":"580px",persistent:""},{default:s(()=>[e(b,{class:"rounded-lg"},{default:s(()=>[e(U,{color:"primary",density:"compact"},{default:s(()=>[e(q,{class:"text-white font-weight-medium"},{default:s(()=>[e(m,{icon:"ri-close-line",color:"white",onClick:t[24]||(t[24]=r=>a.paymentDialog=!1)}),c(" Confirmación de Pago ")]),_:1}),e(A),e(m,{icon:"",variant:"text",color:"white",onClick:t[25]||(t[25]=r=>a.paymentDialog=!1),class:"mr-1"},{default:s(()=>[e(y,null,{default:s(()=>[c("mdi-close")]),_:1})]),_:1})]),_:1}),e(w,{class:"px-4 pt-5 pb-2"},{default:s(()=>[o("div",Pe,[e(V,{color:"success-lighten-5",size:"56",class:"mb-3"},{default:s(()=>[e(y,{icon:"ri-checkbox-circle-fill",color:"success",size:"80"})]),_:1}),Fe,De]),e(b,{flat:"",border:"",class:"mb-4"},{default:s(()=>[e(w,{class:"pa-4"},{default:s(()=>{var r,u,g,E;return[o("div",Se,[Oe,o("span",Ue," #"+h((u=(r=a.createdOrder)==null?void 0:r.order)==null?void 0:u.order_number),1)]),o("div",qe,[Te,o("span",Le,h(l.formatCurrency((E=(g=a.createdOrder)==null?void 0:g.order)==null?void 0:E.total_amount)),1)])]}),_:1})]),_:1})]),_:1}),e(T,{class:"px-4 pb-4 pt-0"},{default:s(()=>[e(_,null,{default:s(()=>[e(n,{cols:"12",md:"12",sm:"12",class:"pt-4 pb-0 my-0"},{default:s(()=>[e(m,{variant:"outlined",color:"primary",onClick:l.finishOrder,block:"",class:"text-capitalize mr-2"},{default:s(()=>[e(y,{icon:"mdi-check",class:"mr-1"}),c(" Finalizar sin pago ")]),_:1},8,["onClick"])]),_:1}),e(n,{cols:"12",md:"12",sm:"12",class:"pt-1 pb-2 my-0"},{default:s(()=>[e(m,{color:"white",onClick:l.openPaymentForm,block:"",class:"bg-primary text-capitalize"},{default:s(()=>[e(y,{icon:"mdi-cash-plus",class:"mr-1"}),c(" Registrar Pago ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(O,{modelValue:a.paymentFormDialog,"onUpdate:modelValue":t[28]||(t[28]=r=>a.paymentFormDialog=r),"max-width":"600px",persistent:""},{default:s(()=>[e(b,{class:"rounded-lg"},{default:s(()=>[e(U,{color:"primary",density:"compact",class:"ml-0 pl-0"},{default:s(()=>[e(q,{class:"text-h6 font-weight-medium text-white"},{default:s(()=>[e(m,{icon:"ri-close-line",color:"white",onClick:l.closePaymentForm},null,8,["onClick"]),c(" Registrar Pago ")]),_:1}),e(A),e(m,{icon:"",variant:"text",color:"white",onClick:l.closePaymentForm},{default:s(()=>[e(y,null,{default:s(()=>[c("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),e(S,{ref:"paymentForm",modelValue:a.validPayment,"onUpdate:modelValue":t[27]||(t[27]=r=>a.validPayment=r)},{default:s(()=>[e(w,{class:"px-4 pt-4 pb-2"},{default:s(()=>[e(b,{flat:"",class:"border",color:"surface"},{default:s(()=>[e(ae,{class:"py-2"},{default:s(()=>[e(re,{class:"text-subtitle-1 font-weight-medium d-flex align-center"},{default:s(()=>[e(V,{icon:"ri-money-dollar-circle-line",class:"text-primary mr-2",variant:"tonal"}),c(" Resumen de Pagos ")]),_:1})]),_:1}),e(L),e(w,{class:"px-2 py-3"},{default:s(()=>{var r,u;return[o("div",Ae,[o("div",Ee,[Be,o("span",Re,h(l.formatCurrency((u=(r=a.createdOrder)==null?void 0:r.order)==null?void 0:u.total_amount)),1)]),o("div",ze,[Ne,o("span",je,h(l.formatCurrency(a.totalPaid)),1)]),o("div",Ge,[He,o("span",{class:D(["font-weight-medium",l.pendingAmount>0?"text-error":"text-success"])},h(l.formatCurrency(l.pendingAmount)),3)]),e(L,{class:"my-1"}),o("div",Me,[We,o("span",Ye,h(l.formatCurrency(a.change)),1)])])]}),_:1})]),_:1}),o("div",Ze,[(v(),x(H,{ref:"paymentsRow",key:a.keyPayments,modulo:"pagos",onUpdateTotal:l.updateTotal,"pending-amount":l.pendingAmount},null,8,["onUpdateTotal","pending-amount"]))])]),_:1}),e(T,{class:"px-4 pb-4 pt-2"},{default:s(()=>[e(_,null,{default:s(()=>[e(n,{cols:"12",md:"12",sm:"12",class:"pt-4 pb-0 my-0"},{default:s(()=>[e(m,{variant:"outlined",color:"primary",onClick:l.closePaymentForm,class:"text-capitalize",block:""},{default:s(()=>[c(" Cancelar ")]),_:1},8,["onClick"])]),_:1}),e(n,{cols:"12",md:"12",sm:"12",class:"pt-1 my-0 pb-2"},{default:s(()=>[e(m,{onClick:l.savePayment,loading:a.savingPayment,disabled:!a.validPayment,color:"white",class:"bg-primary text-capitalize",block:""},{default:s(()=>[a.savingPayment?(v(),P(F,{key:1},[c(" Procesando... ")],64)):(v(),P(F,{key:0},[e(y,{icon:"mdi-check-circle-outline",class:"mr-1"}),c(" Confirmar Pago ")],64))]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(se,{modelValue:a.snackbar,"onUpdate:modelValue":t[30]||(t[30]=r=>a.snackbar=r),color:a.snackbarColor,timeout:4e3},{action:s(({attrs:r})=>[e(m,X({text:""},r,{onClick:t[29]||(t[29]=u=>a.snackbar=!1)}),{default:s(()=>[c(" Cerrar ")]),_:2},1040)]),default:s(()=>[c(h(a.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])],64)}const xt=te(ce,[["render",Je],["__scopeId","data-v-4bb1eb9e"]]);export{xt as default};

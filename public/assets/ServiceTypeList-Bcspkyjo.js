import{r as g,j as w,an as M,ap as N,s as ae,G as le,o as S,e as U,w as a,b as e,H as T,t as b,a2 as J,V as W,ao as ne,a9 as ce,aa as de,a as h,l as K,u as X,v as pe,c as re,$ as me}from"./main-DOucTeTc.js";import{a as Y,V as Z,d as ve}from"./VCard-BZ4rU-iA.js";import{b as _e,c as ye,a as ie,V as fe}from"./VSnackbar-DomS3EVk.js";import{V as se}from"./VSpacer-DRVxq8PH.js";import{V as Ve}from"./VForm-C4sJc7XK.js";import{a as oe,V as x}from"./VRow-Ir3wg7QB.js";import{V as B}from"./VTextField-2ruvtwyY.js";import{V as ge}from"./VTextarea-BEcfH4C2.js";import{V as ee}from"./VSwitch-BA0jDN5K.js";import{b as xe,e as F}from"./VChip-Dd9kPkn6.js";import{V as te}from"./VAlert-Dspz5fOI.js";import{V as be}from"./VDialog-BEsC9W0L.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Te}from"./VDataTable-DpdSlkcl.js";import{V as he}from"./filter-FbS_J5vu.js";import"./VAvatar-CfLGKvOU.js";import"./VImg-CfnnTD9W.js";import"./forwardRefs-C-GTDzx5.js";import"./VCheckboxBtn-BC80PW81.js";import"./index-D5A_Hox7.js";import"./VOverlay-Ejijsbhx.js";import"./easing-DY7PVvcf.js";import"./lazy-DBukmiYt.js";import"./ssrBoot-BIumrUOr.js";import"./VDivider-ChX3vsGx.js";import"./VTable-ivgGpSdg.js";function ue(){const p=g([]),q=g(null),l=g(!1),m=g(null),H=async(n={})=>{var v,d;l.value=!0,m.value=null;try{const s=await M.get(N.servicesTypes,{params:{include:"resourceType,reservations_count",...n}});return p.value=s.data.data||s.data,p.value}catch(s){throw m.value=((d=(v=s.response)==null?void 0:v.data)==null?void 0:d.message)||"Error al cargar los tipos de servicio",s}finally{l.value=!1}},L=async n=>{var v,d;l.value=!0,m.value=null;try{const s=await M.get(`${N.servicesTypes}/${n}`,{params:{include:"resourceType,reservations_count"}});return q.value=s.data.data||s.data,q.value}catch(s){throw m.value=((d=(v=s.response)==null?void 0:v.data)==null?void 0:d.message)||"Error al cargar el tipo de servicio",s}finally{l.value=!1}},z=async n=>{var v,d;l.value=!0,m.value=null;try{const s=await M.post(N.servicesTypes,n),V=s.data.data||s.data;return p.value.push(V),V}catch(s){throw m.value=((d=(v=s.response)==null?void 0:v.data)==null?void 0:d.message)||"Error al crear el tipo de servicio",s}finally{l.value=!1}},A=async(n,v)=>{var d,s;l.value=!0,m.value=null;try{const V=await M.put(`${N.servicesTypes}/${n}`,v),R=V.data.data||V.data,k=p.value.findIndex(G=>G.id===n);return k!==-1&&(p.value[k]=R),q.value&&q.value.id===n&&(q.value=R),R}catch(V){throw m.value=((s=(d=V.response)==null?void 0:d.data)==null?void 0:s.message)||"Error al actualizar el tipo de servicio",V}finally{l.value=!1}},r=async n=>{var v,d;l.value=!0,m.value=null;try{return await M.delete(`${N.servicesTypes}/${n}`),p.value=p.value.filter(s=>s.id!==n),q.value&&q.value.id===n&&(q.value=null),!0}catch(s){throw m.value=((d=(v=s.response)==null?void 0:v.data)==null?void 0:d.message)||"Error al eliminar el tipo de servicio",s}finally{l.value=!1}},y=async n=>{var v,d;l.value=!0,m.value=null;try{const s=await M.patch(`${N.servicesTypes}/${n}/soft-delete`),V=s.data.data||s.data,R=p.value.findIndex(k=>k.id===n);return R!==-1&&(p.value[R]=V),V}catch(s){throw m.value=((d=(v=s.response)==null?void 0:v.data)==null?void 0:d.message)||"Error al eliminar el tipo de servicio",s}finally{l.value=!1}},C=async n=>{var v,d;l.value=!0,m.value=null;try{const s=await M.patch(`${N.servicesTypes}/${n}/restore`),V=s.data.data||s.data;return p.value.push(V),V}catch(s){throw m.value=((d=(v=s.response)==null?void 0:v.data)==null?void 0:d.message)||"Error al restaurar el tipo de servicio",s}finally{l.value=!1}},$=w(()=>p.value.filter(n=>!n.deleted_at)),E=w(()=>p.value.filter(n=>n.deleted_at)),f=w(()=>p.value.filter(n=>n.requires_resource)),I=w(()=>p.value.filter(n=>!n.requires_resource));return{serviceTypes:p,serviceType:q,loading:l,error:m,activeServiceTypes:$,deletedServiceTypes:E,serviceTypesRequiringResources:f,serviceTypesNotRequiringResources:I,fetchServiceTypes:H,fetchServiceType:L,createServiceType:z,updateServiceType:A,deleteServiceType:r,softDeleteServiceType:y,restoreServiceType:C,reset:()=>{p.value=[],q.value=null,m.value=null,l.value=!1}}}const Re={class:"d-flex justify-space-between"},Se={class:"text-caption"},we=h("div",{class:"text-caption"},[h("strong",null,"Servicio con Recurso:"),T(" Este servicio requiere la asignación de un recurso específico (ej: habitación, puesto de trabajo, cancha) para poder ser reservado. ")],-1),ke=h("div",{class:"text-caption"},[h("strong",null,"Servicio sin Recurso:"),T(" Este servicio no requiere la asignación de un recurso específico (ej: consulta médica, clase grupal, servicio a domicilio). ")],-1),Ce={__name:"ServiceTypeForm",props:{modelValue:{type:Boolean,default:!1},serviceType:{type:Object,default:null},mode:{type:String,default:"create",validator:p=>["create","edit"].includes(p)}},emits:["update:modelValue","saved","cancel"],setup(p,{emit:q}){const l=p,m=q,{createServiceType:H,updateServiceType:L,loading:z,error:A}=ue(),r=g({name:"",description:"",base_price:null,duration_minutes:60,min_units:1,max_units:1,max_participants:1,requires_resource:!1,resource_type_id:null,requires_capacity:!1,max_capacity_per_reservation:null}),y=g({}),C=g(null),$=g([]),E=g(!1),f={required:i=>!!i||"Este campo es requerido",minValue:i=>o=>o>=i||`El valor debe ser mayor o igual a ${i}`},I=w({get:()=>l.modelValue,set:i=>m("update:modelValue",i)}),O=w(()=>{const i=r.value.name&&r.value.base_price&&r.value.duration_minutes&&r.value.min_units&&r.value.max_units&&r.value.max_participants;return r.value.requires_resource?i&&r.value.resource_type_id:i}),n=w(()=>r.value.requires_resource?"Este servicio requiere un recurso específico":"Este servicio no requiere un recurso específico"),v=w(()=>r.value.requires_capacity?"Se controlará la capacidad disponible del recurso":"No se controlará la capacidad del recurso"),d=w(()=>r.value.max_capacity_per_reservation?`Máximo ${r.value.max_capacity_per_reservation} participantes por reserva en este recurso`:"Sin límite de capacidad específico"),s=async()=>{E.value=!0;try{const i=await M.get(N.resourceTypes,{params:{active:!0}});$.value=i.data.data||i.data}catch(i){console.error("Error cargando tipos de recurso:",i)}finally{E.value=!1}},V=()=>{r.value.requires_resource||(r.value.resource_type_id=null,r.value.requires_capacity=!1,r.value.max_capacity_per_reservation=null)},R=()=>{r.value={name:"",description:"",base_price:null,duration_minutes:60,min_units:1,max_units:1,max_participants:1,requires_resource:!1,resource_type_id:null,requires_capacity:!1,max_capacity_per_reservation:null},y.value={}},k=()=>{I.value=!1,m("cancel")},G=async()=>{var i;if(O.value){y.value={};try{const o={...r.value,base_price:parseFloat(r.value.base_price),duration_minutes:parseInt(r.value.duration_minutes),min_units:parseInt(r.value.min_units),max_units:parseInt(r.value.max_units),max_participants:parseInt(r.value.max_participants),max_capacity_per_reservation:r.value.max_capacity_per_reservation?parseInt(r.value.max_capacity_per_reservation):null};l.mode==="create"?await H(o):await L(l.serviceType.id,o),m("saved"),k()}catch(o){((i=o.response)==null?void 0:i.status)===422?y.value=o.response.data.errors||{}:y.value.general=[A.value||"Error al guardar el tipo de servicio"]}}};return ae(()=>l.serviceType,i=>{i?r.value={name:i.name||"",description:i.description||"",base_price:i.base_price||null,duration_minutes:i.duration_minutes||60,min_units:i.min_units||1,max_units:i.max_units||1,max_participants:i.max_participants||1,requires_resource:i.requires_resource||!1,resource_type_id:i.resource_type_id||null,requires_capacity:i.requires_capacity||!1,max_capacity_per_reservation:i.max_capacity_per_reservation||null}:R()}),ae(()=>l.modelValue,i=>{i&&l.serviceType?r.value={name:l.serviceType.name||"",description:l.serviceType.description||"",base_price:l.serviceType.base_price||null,duration_minutes:l.serviceType.duration_minutes||60,min_units:l.serviceType.min_units||1,max_units:l.serviceType.max_units||1,max_participants:l.serviceType.max_participants||1,requires_resource:l.serviceType.requires_resource||!1,resource_type_id:l.serviceType.resource_type_id||null,requires_capacity:l.serviceType.requires_capacity||!1,max_capacity_per_reservation:l.serviceType.max_capacity_per_reservation||null}:i||R()}),le(()=>{s()}),(i,o)=>(S(),U(be,{modelValue:I.value,"onUpdate:modelValue":o[11]||(o[11]=c=>I.value=c),"max-width":"800",persistent:""},{default:a(()=>[e(Y,null,{default:a(()=>[e(_e,{color:p.mode==="create"?"primary":"secondary",density:"compact"},{default:a(()=>[e(ye,{class:"text-white"},{default:a(()=>[T(b(p.mode==="create"?"Nuevo Tipo de Servicio":"Editar Tipo de Servicio"),1)]),_:1}),e(se),e(J,{icon:"",color:"white",onClick:k},{default:a(()=>[e(W,null,{default:a(()=>[T("ri-close-line")]),_:1})]),_:1})]),_:1},8,["color"]),e(Z,{class:"pt-4"},{default:a(()=>[e(Ve,{onSubmit:ne(G,["prevent"]),ref_key:"formRef",ref:C},{default:a(()=>[e(oe,null,{default:a(()=>[e(x,{cols:"12",md:"6"},{default:a(()=>[e(B,{modelValue:r.value.name,"onUpdate:modelValue":o[0]||(o[0]=c=>r.value.name=c),label:"Nombre del Servicio *",variant:"outlined",rules:[f.required],"error-messages":y.value.name,required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),e(x,{cols:"12",md:"6"},{default:a(()=>[e(B,{modelValue:r.value.base_price,"onUpdate:modelValue":o[1]||(o[1]=c=>r.value.base_price=c),label:"Precio Base *",type:"number",step:"0.01",variant:"outlined",rules:[f.required,f.minValue(0)],"error-messages":y.value.base_price,prefix:"$",required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),e(x,{cols:"12"},{default:a(()=>[e(ge,{modelValue:r.value.description,"onUpdate:modelValue":o[2]||(o[2]=c=>r.value.description=c),label:"Descripción del Servicio",variant:"outlined",rows:"3","error-messages":y.value.description,placeholder:"Descripción detallada del servicio..."},null,8,["modelValue","error-messages"])]),_:1}),e(x,{cols:"12",md:"4"},{default:a(()=>[e(B,{modelValue:r.value.duration_minutes,"onUpdate:modelValue":o[3]||(o[3]=c=>r.value.duration_minutes=c),label:"Duración (minutos) *",type:"number",variant:"outlined",rules:[f.required,f.minValue(1)],"error-messages":y.value.duration_minutes,required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),e(x,{cols:"12",md:"4"},{default:a(()=>[e(B,{modelValue:r.value.min_units,"onUpdate:modelValue":o[4]||(o[4]=c=>r.value.min_units=c),label:"Unidades Mínimas *",type:"number",variant:"outlined",rules:[f.required,f.minValue(1)],"error-messages":y.value.min_units,required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),e(x,{cols:"12",md:"4"},{default:a(()=>[e(B,{modelValue:r.value.max_units,"onUpdate:modelValue":o[5]||(o[5]=c=>r.value.max_units=c),label:"Unidades Máximas *",type:"number",variant:"outlined",rules:[f.required,f.minValue(1)],"error-messages":y.value.max_units,required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),e(x,{cols:"12",md:"6"},{default:a(()=>[e(B,{modelValue:r.value.max_participants,"onUpdate:modelValue":o[6]||(o[6]=c=>r.value.max_participants=c),label:"Máximo de Participantes *",type:"number",variant:"outlined",rules:[f.required,f.minValue(1)],"error-messages":y.value.max_participants,required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),e(x,{cols:"12",md:"6"},{default:a(()=>[e(ee,{modelValue:r.value.requires_resource,"onUpdate:modelValue":o[7]||(o[7]=c=>r.value.requires_resource=c),label:"Requiere Recurso",color:"primary",messages:n.value,"hide-details":"",onChange:V},null,8,["modelValue","messages"])]),_:1}),r.value.requires_resource?(S(),U(x,{key:0,cols:"12",md:"6"},{default:a(()=>[e(ie,{modelValue:r.value.resource_type_id,"onUpdate:modelValue":o[8]||(o[8]=c=>r.value.resource_type_id=c),items:$.value,"item-title":"name","item-value":"id",label:"Tipo de Recurso *",variant:"outlined",rules:r.value.requires_resource?[f.required]:[],"error-messages":y.value.resource_type_id,loading:E.value,clearable:""},{item:a(({props:c,item:P})=>[e(xe,ce(de(c)),{title:a(()=>[h("div",Re,[h("span",null,b(P.raw.name),1),e(F,{size:"small",color:P.raw.is_shared_capacity?"success":"info"},{default:a(()=>[T(b(P.raw.is_shared_capacity?"Compartida":"Individual"),1)]),_:2},1032,["color"])])]),subtitle:a(()=>[h("span",Se,b(P.raw.description),1)]),_:2},1040)]),_:1},8,["modelValue","items","rules","error-messages","loading"])]),_:1})):K("",!0),r.value.requires_resource?(S(),U(x,{key:1,cols:"12",md:"6"},{default:a(()=>[e(ee,{modelValue:r.value.requires_capacity,"onUpdate:modelValue":o[9]||(o[9]=c=>r.value.requires_capacity=c),label:"Requiere Control de Capacidad",color:"primary",messages:v.value,"hide-details":""},null,8,["modelValue","messages"])]),_:1})):K("",!0),r.value.requires_capacity?(S(),U(x,{key:2,cols:"12",md:"6"},{default:a(()=>[e(B,{modelValue:r.value.max_capacity_per_reservation,"onUpdate:modelValue":o[10]||(o[10]=c=>r.value.max_capacity_per_reservation=c),label:"Capacidad Máxima por Reserva",type:"number",variant:"outlined",min:1,"error-messages":y.value.max_capacity_per_reservation,hint:d.value,"persistent-hint":""},null,8,["modelValue","error-messages","hint"])]),_:1})):K("",!0),r.value.requires_resource?(S(),U(x,{key:3,cols:"12"},{default:a(()=>[e(te,{type:"info",variant:"tonal",density:"compact"},{default:a(()=>[we]),_:1})]),_:1})):(S(),U(x,{key:4,cols:"12"},{default:a(()=>[e(te,{type:"info",variant:"tonal",density:"compact"},{default:a(()=>[ke]),_:1})]),_:1}))]),_:1}),e(ve,{class:"px-0"},{default:a(()=>[e(se),e(J,{variant:"outlined",onClick:k,disabled:X(z)},{default:a(()=>[T(" Cancelar ")]),_:1},8,["disabled"]),e(J,{color:"primary",type:"submit",loading:X(z),disabled:!O.value},{default:a(()=>[T(b(p.mode==="create"?"Crear":"Actualizar"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},$e={key:1,class:"grey--text caption"},Ee={key:1,class:"text-disabled"},Ue={class:"d-flex flex-wrap gap-1 align-center",style:{"min-width":"120px"}},Ie=["innerHTML"],De={__name:"ServiceTypeList",setup(p){const{serviceTypes:q,loading:l,error:m,fetchServiceTypes:H,updateServiceType:L,deleteServiceType:z}=ue(),A=g(""),r=g(null),y=g(!1),C=g([]),$=g("create"),E=g(null),f=g({show:!1,message:"",color:"success"}),I=g([{title:"Acciones",key:"actions",sortable:!1},{title:"Nombre",key:"name"},{title:"Precio Base",key:"base_price"},{title:"Duración",key:"duration_minutes"},{title:"Unidades",key:"units_range"},{title:"Máx. Participantes",key:"max_participants"},{title:"Requiere Recurso",key:"requires_resource"},{title:"Tipo Recurso",key:"resource_type"},{title:"Reservas",key:"reservations_count"},{title:"Estado",key:"active"}]);C.value=[...I.value];const O=g([{title:"Requiere Recurso",value:!0},{title:"No Requiere Recurso",value:!1}]),n=w(()=>C.value),v=w(()=>{let u=q.value;return r.value!==null&&(u=u.filter(_=>_.requires_resource===r.value)),u}),d=async()=>{try{await H()}catch{j("Error al cargar los tipos de servicio","error")}},s=()=>{E.value=null,$.value="create",y.value=!0},V=u=>{E.value={...u},$.value="edit",y.value=!0},R=async u=>{const _=u.reservations_count||0,Q=`¿Está seguro que desea eliminar el tipo de servicio "${u.name}"?${_>0?`

Este tipo de servicio tiene ${_} reservas asociadas.`:""}`;if(confirm(Q))try{await z(u.id),j("Tipo de servicio eliminado exitosamente","success")}catch{j(m.value||"Error al eliminar el tipo de servicio","error")}},k=async u=>{try{const _=await L(u.id,{...u,active:u.active});j(`Tipo de servicio ${u.active?"activado":"inactivado"} exitosamente`,"success")}catch{u.active=!u.active,j(m.value||"Error al cambiar el estado","error")}},G=()=>{y.value=!1,d(),j($.value==="create"?"Tipo de servicio creado exitosamente":"Tipo de servicio actualizado exitosamente","success")},i=u=>parseFloat(u).toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}),o=u=>u?"warning":"success",c=u=>u.deleted_at?"error":u.active?"success":"warning",P=u=>u.deleted_at?"Eliminado":u.active?"Activo":"Inactivo",j=(u,_="success")=>{f.value={show:!0,message:u,color:_}};return le(()=>{d()}),(u,_)=>{const Q=pe("IconBtn");return S(),U(Y,{title:"Administración de Servicios"},{default:a(()=>[e(Z,{class:"d-flex px-2"},{default:a(()=>[e(Te,{headers:n.value,items:v.value,search:A.value,loading:X(l),class:"text-no-wrap striped-table"},{top:a(()=>[e(Y,{flat:"",color:"white"},{default:a(()=>[e(Z,null,{default:a(()=>[e(oe,null,{default:a(()=>[e(x,{sm:"4",class:"pl-0 pt-20 py-2"},{default:a(()=>[e(B,{modelValue:A.value,"onUpdate:modelValue":_[0]||(_[0]=t=>A.value=t),"append-icon":"ri-search-line",label:"Búsqueda de Tipos de Servicio"},null,8,["modelValue"])]),_:1}),e(x,{sm:"3",class:"pt-20 py-2"},{default:a(()=>[e(he,{modelValue:r.value,"onUpdate:modelValue":_[1]||(_[1]=t=>r.value=t),items:O.value,label:"Requiere Recurso",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1}),e(x,{sm:"4",class:"pt-20 py-2"},{default:a(()=>[e(ie,{modelValue:C.value,"onUpdate:modelValue":_[2]||(_[2]=t=>C.value=t),items:I.value,label:"Columnas Visibles",multiple:"","return-object":""},{selection:a(({item:t,index:D})=>[D<2?(S(),U(F,{key:0},{default:a(()=>[h("span",null,b(t.title),1)]),_:2},1024)):K("",!0),D===2?(S(),re("span",$e,"(otras "+b(C.value.length-2)+"+)",1)):K("",!0)]),_:1},8,["modelValue","items"])]),_:1}),e(x,{sm:"1",class:"pt-20 py-2"},{default:a(()=>[e(J,{onClick:s,color:u.$cv("principal"),size:"x-large",title:"Registrar Tipo de Servicio"},{default:a(()=>[e(W,{size:"large",icon:"ri-add-circle-line"})]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1})]),"item.base_price":a(({item:t})=>[e(F,{color:"primary",variant:"outlined",density:"comfortable"},{default:a(()=>[T(" $"+b(i(t.base_price)),1)]),_:2},1024)]),"item.duration_minutes":a(({item:t})=>[h("span",null,b(t.duration_minutes)+" min",1)]),"item.requires_resource":a(({item:t})=>[e(F,{color:o(t.requires_resource),density:"comfortable"},{default:a(()=>[T(b(t.requires_resource?"Sí":"No"),1)]),_:2},1032,["color"])]),"item.units_range":a(({item:t})=>[h("span",null,b(t.min_units)+" - "+b(t.max_units),1)]),"item.resource_type":a(({item:t})=>[t.resource_type?(S(),U(F,{key:0,color:"info",density:"comfortable"},{default:a(()=>[T(b(t.resource_type.name),1)]),_:2},1024)):(S(),re("span",Ee,"No aplica"))]),"item.reservations_count":a(({item:t})=>[e(F,{color:"secondary",density:"comfortable"},{default:a(()=>[T(b(t.reservations_count||0),1)]),_:2},1024)]),"item.active":a(({item:t})=>[e(F,{color:c(t),density:"comfortable"},{default:a(()=>[T(b(P(t)),1)]),_:2},1032,["color"])]),"item.actions":a(({item:t})=>[h("div",Ue,[e(Q,{size:"small",title:"Editar",onClick:D=>V(t)},{default:a(()=>[e(W,{icon:"ri-pencil-line"})]),_:2},1032,["onClick"]),e(ee,{modelValue:t.active,"onUpdate:modelValue":D=>t.active=D,"true-value":!0,"false-value":!1,color:"primary","hide-details":"",title:"Activar o Inactivar",onChange:D=>k(t)},null,8,["modelValue","onUpdate:modelValue","onChange"]),e(Q,{size:"small",title:"Eliminar",onClick:D=>R(t)},{default:a(()=>[e(W,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])])]),_:1},8,["headers","items","search","loading"]),e(Ce,{modelValue:y.value,"onUpdate:modelValue":_[3]||(_[3]=t=>y.value=t),"service-type":E.value,mode:$.value,onSaved:G,onCancel:_[4]||(_[4]=t=>y.value=!1)},null,8,["modelValue","service-type","mode"]),e(fe,{modelValue:f.value.show,"onUpdate:modelValue":_[6]||(_[6]=t=>f.value.show=t),color:f.value.color,timeout:3e3},{action:a(({attrs:t})=>[e(J,me({dark:"",text:""},t,{onClick:_[5]||(_[5]=D=>f.value.show=!1)}),{default:a(()=>[T(" Cerrar ")]),_:2},1040)]),default:a(()=>[h("div",{innerHTML:f.value.message},null,8,Ie)]),_:1},8,["modelValue","color"])]),_:1})]),_:1})}}},oa=qe(De,[["__scopeId","data-v-5e79df42"]]);export{oa as default};

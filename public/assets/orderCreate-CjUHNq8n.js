import{_ as Oe}from"./PaymentsRow-DUuQy2_r.js";import{K as be,ac as Re,M as qe,ad as Be,ae as Ae,N as Ee,af as Ne,O as ze,P as He,Q as Me,R as xe,ag as je,S as Ge,B as Le,ah as We,ai as Ke,aj as Qe,X as Xe,ak as Ye,T as Je,Y as Ve,b as e,al as Ze,j as L,r as B,D as $e,am as et,G as tt,s as A,a6 as at,an as st,a0 as N,F as U,_ as ne,ao as we,ap as lt,a8 as J,aq as ot,ar as rt,as as it,at as nt,v as dt,o as D,c as Z,e as E,w as t,l as $,n as ee,aa as fe,ab as he,H as u,t as y,a3 as p,V as g,a as i,au as ut}from"./main-6un_LZV3.js";import{_ as ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as te}from"./VForm-BroPHNre.js";import{V as ae}from"./VDialog-D0HQfBvj.js";import{V as mt,a as W,b as se,c as le}from"./VSnackbar-DYX9Ldxv.js";import{V as n,a as _}from"./VRow-1IsH-HXB.js";import{a as V,V as w,d as oe,b as pt,c as ft}from"./VCard-C4ovO3Xn.js";import{V as C}from"./VAvatar-GilCUASU.js";import{b as _e,d as ye,e as ht}from"./VChip-Dk80kfPr.js";import{V as _t}from"./VSwitch-AwbuqzRS.js";import{m as yt,a as gt,u as vt,V as ge,f as bt,b as xt,c as Vt,d as h}from"./VTextField-DkY_PXxT.js";import{V as wt}from"./VDataTable-BLZgC8uG.js";import{V as re}from"./VDivider-CbpsEDfw.js";import{f as Ct}from"./forwardRefs-C-GTDzx5.js";import{I as kt}from"./VImg-DVuj2CJR.js";import{V as Pt}from"./VContainer-C0DfHo0K.js";import{V as ie}from"./VSpacer-pNpvz9cS.js";import"./VOverlay-D_por6rs.js";import"./easing-DY7PVvcf.js";import"./lazy-7v_vxMTA.js";import"./VCheckboxBtn-B7YgUxzS.js";import"./index-yGNNQEqj.js";import"./ssrBoot-IhPJnLOu.js";import"./VTable-CLNiyE_V.js";const It=be({color:String,...Re(),...qe(),...Be(),...Ae(),...Ee(),...Ne(),...ze(),...He(),...Me()},"VSheet"),ve=xe()({name:"VSheet",props:It(),setup(a,s){let{slots:d}=s;const{themeClasses:f}=je(a),{backgroundColorClasses:l,backgroundColorStyles:r}=Ge(Le(a,"color")),{borderClasses:k}=We(a),{dimensionStyles:O}=Ke(a),{elevationClasses:R}=Qe(a),{locationStyles:o}=Xe(a),{positionClasses:c}=Ye(a),{roundedClasses:b}=Je(a);return Ve(()=>e(a.tag,{class:["v-sheet",f.value,l.value,k.value,R.value,c.value,b.value,a.class],style:[r.value,O.value,o.value,a.style]},d)),{}}}),Ft=be({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:a=>!isNaN(parseFloat(a))},maxRows:{type:[Number,String],validator:a=>!isNaN(parseFloat(a))},suffix:String,modelModifiers:Object,...yt(),...gt()},"VTextarea"),Dt=xe()({name:"VTextarea",directives:{Intersect:kt},inheritAttrs:!1,props:Ft(),emits:{"click:control":a=>!0,"mousedown:control":a=>!0,"update:focused":a=>!0,"update:modelValue":a=>!0},setup(a,s){let{attrs:d,emit:f,slots:l}=s;const r=Ze(a,"modelValue"),{isFocused:k,focus:O,blur:R}=vt(a),o=L(()=>typeof a.counterValue=="function"?a.counterValue(r.value):(r.value||"").toString().length),c=L(()=>{if(d.maxlength)return d.maxlength;if(!(!a.counter||typeof a.counter!="number"&&typeof a.counter!="string"))return a.counter});function b(m,x){var v,P;!a.autofocus||!m||(P=(v=x[0].target)==null?void 0:v.focus)==null||P.call(v)}const q=B(),z=B(),de=$e(""),H=B(),Ce=L(()=>a.persistentPlaceholder||k.value||a.active);function K(){var m;H.value!==document.activeElement&&((m=H.value)==null||m.focus()),k.value||O()}function ke(m){K(),f("click:control",m)}function Pe(m){f("mousedown:control",m)}function Ie(m){m.stopPropagation(),K(),J(()=>{r.value="",ot(a["onClick:clear"],m)})}function Fe(m){var v;const x=m.target;if(r.value=x.value,(v=a.modelModifiers)!=null&&v.trim){const P=[x.selectionStart,x.selectionEnd];J(()=>{x.selectionStart=P[0],x.selectionEnd=P[1]})}}const S=B(),M=B(+a.rows),Q=L(()=>["plain","underlined"].includes(a.variant));et(()=>{a.autoGrow||(M.value=+a.rows)});function T(){a.autoGrow&&J(()=>{if(!S.value||!z.value)return;const m=getComputedStyle(S.value),x=getComputedStyle(z.value.$el),v=parseFloat(m.getPropertyValue("--v-field-padding-top"))+parseFloat(m.getPropertyValue("--v-input-padding-top"))+parseFloat(m.getPropertyValue("--v-field-padding-bottom")),P=S.value.scrollHeight,j=parseFloat(m.lineHeight),X=Math.max(parseFloat(a.rows)*j+v,parseFloat(x.getPropertyValue("--v-input-control-height"))),Y=parseFloat(a.maxRows)*j+v||1/0,F=it(P??0,X,Y);M.value=Math.floor((F-v)/j),de.value=rt(F)})}tt(T),A(r,T),A(()=>a.rows,T),A(()=>a.maxRows,T),A(()=>a.density,T);let I;return A(S,m=>{m?(I=new ResizeObserver(T),I.observe(S.value)):I==null||I.disconnect()}),at(()=>{I==null||I.disconnect()}),Ve(()=>{const m=!!(l.counter||a.counter||a.counterValue),x=!!(m||l.details),[v,P]=st(d),{modelValue:j,...X}=ge.filterProps(a),Y=bt(a);return e(ge,N({ref:q,modelValue:r.value,"onUpdate:modelValue":F=>r.value=F,class:["v-textarea v-text-field",{"v-textarea--prefixed":a.prefix,"v-textarea--suffixed":a.suffix,"v-text-field--prefixed":a.prefix,"v-text-field--suffixed":a.suffix,"v-textarea--auto-grow":a.autoGrow,"v-textarea--no-resize":a.noResize||a.autoGrow,"v-input--plain-underlined":Q.value},a.class],style:a.style},v,X,{centerAffix:M.value===1&&!Q.value,focused:k.value}),{...l,default:F=>{let{id:G,isDisabled:ue,isDirty:ce,isReadonly:De,isValid:Se}=F;return e(xt,N({ref:z,style:{"--v-textarea-control-height":de.value},onClick:ke,onMousedown:Pe,"onClick:clear":Ie,"onClick:prependInner":a["onClick:prependInner"],"onClick:appendInner":a["onClick:appendInner"]},Y,{id:G.value,active:Ce.value||ce.value,centerAffix:M.value===1&&!Q.value,dirty:ce.value||a.dirty,disabled:ue.value,focused:k.value,error:Se.value===!1}),{...l,default:Te=>{let{props:{class:me,...pe}}=Te;return e(U,null,[a.prefix&&e("span",{class:"v-text-field__prefix"},[a.prefix]),ne(e("textarea",N({ref:H,class:me,value:r.value,onInput:Fe,autofocus:a.autofocus,readonly:De.value,disabled:ue.value,placeholder:a.placeholder,rows:a.rows,name:a.name,onFocus:K,onBlur:R},pe,P),null),[[we("intersect"),{handler:b},null,{once:!0}]]),a.autoGrow&&ne(e("textarea",{class:[me,"v-textarea__sizer"],id:`${pe.id}-sizer`,"onUpdate:modelValue":Ue=>r.value=Ue,ref:S,readonly:!0,"aria-hidden":"true"},null),[[lt,r.value]]),a.suffix&&e("span",{class:"v-text-field__suffix"},[a.suffix])])}})},details:x?F=>{var G;return e(U,null,[(G=l.details)==null?void 0:G.call(l,F),m&&e(U,null,[e("span",null,null),e(Vt,{active:a.persistentCounter||k.value,value:o.value,max:c.value},l.counter)])])}:void 0})}),Ct({},q,z,H)}}),St={data(){return{keyOrderForm:1,showFooter:!1,validOrder:!1,validCustomer:!1,validPayment:!1,creatingOrder:!1,savingCustomer:!1,savingPayment:!1,customerDialog:!1,paymentDialog:!1,paymentFormDialog:!1,customers:[],products:[],stock:[],sellers:[],order:{customer_id:null,shipping_address:"",subtotal:0,tax_amount:0,discount_amount:0,total_amount:0,notes:"",items:[],shipping:0,shipping_address_status:!1},newItem:{product_id:null,quantity:1,unit_price:0,unit_cost_price:0},newCustomer:{name:"",email:"",telephone:"",locality_id:"",address:""},payment:{amount:0,payment_method_id:null,notes:""},createdOrder:null,snackbar:!1,snackbarText:"",snackbarColor:"success",itemHeaders:[{title:"",key:"actions",width:"25px",sortable:!1},{title:"Producto",key:"product_name",width:"300px"},{title:"Cantidad",key:"quantity",width:"80px"},{title:"Precio Unit.",key:"unit_price",width:"150px"},{title:"Total",key:"total_price",width:"150px",align:"end"}],localities:[],keyPayments:0,change:0,totalPaid:0,isAdmibBebidas:!1}},computed:{...nt({}),selectedCustomer(){return this.customers.find(a=>a.id===this.order.customer_id)},canAddItem(){return this.newItem.product_id&&this.newItem.quantity>0&&this.newItem.unit_price>0},canCreateOrder(){return this.order.customer_id&&this.order.shipping_address&&this.order.items.length>0},pendingAmount(){return this.createdOrder&&this.totalPaid<this.createdOrder.order.total_amount?this.createdOrder.order.total_amount-this.totalPaid:0}},async created(){await this.loadData()},methods:{setDate(a){if(a)return;let s=this.getDateTimeTomorrow();this.order.delivery_date=s},updateTotal(a){this.totalPaid=a,this.change=this.totalPaid>this.createdOrder.order.total_amount?this.totalPaid-this.createdOrder.order.total_amount:0},async loadData(){try{this.isAdminBebidas=this.$is(["bebidas-admin"]);const[a,s,d,f]=await Promise.all([this.$axios.get(this.$routes.customers),this.$axios.get(this.$routes.products),this.$axios.get(this.$routes.stocks),this.$axios.get(this.$routes.localities)]);if(this.isAdminBebidas){const l=await this.$axios.get(this.$routes.usersList);this.sellers=l.data.data||l.data}this.customers=a.data.data||a.data,this.products=s.data.data||s.data,this.stock=d.data.data||d.data,this.localities=f.data.data||f.data,(this.$is("bebidas-admin")||this.$is("bebidas-user"))&&(this.order.shipping=1),this.setDate(this.order.delivery_date)}catch(a){console.error("Error loading data:",a),this.showSnackbar("Error al cargar los datos","error")}},onCustomerChange(){this.selectedCustomer&&(this.order.shipping_address=this.selectedCustomer.address)},useCustomerAddress(){this.selectedCustomer&&(this.order.shipping_address=this.selectedCustomer.address)},onProductChange(){if(this.newItem.product_id){const a=this.getProductById(this.newItem.product_id);a&&(this.newItem.unit_price=parseFloat(a.sale_price||0),this.newItem.unit_cost_price=parseFloat(a.purchase_price||0))}},getProductById(a){return this.products.find(s=>s.id===a)},getProductStock(a){const s=this.stock.find(d=>d.product_id===a);return s?parseFloat(s.quantity)-parseFloat(s.reserved_quantity):0},showStockWarning(a,s){return s>this.getProductStock(a)},calculateItemTotal(){return this.newItem.quantity*this.newItem.unit_price},addItem(){if(!this.canAddItem)return;this.getProductById(this.newItem.product_id);const a=this.newItem.quantity*this.newItem.unit_price,s=this.newItem.quantity*this.newItem.unit_cost_price;this.order.items.push({product_id:this.newItem.product_id,quantity:this.newItem.quantity,unit_price:this.newItem.unit_price,unit_cost_price:this.newItem.unit_cost_price,total_price:a,total_profit:a-s}),this.newItem={product_id:null,quantity:1,unit_price:0,unit_cost_price:0},this.calculateTotals()},removeItem(a){this.order.items.splice(a,1),this.calculateTotals()},updateItemTotal(a){const s=this.order.items[a];s.total_price=s.quantity*s.unit_price,s.total_profit=s.total_price-s.quantity*s.unit_cost_price,this.calculateTotals()},calculateTotals(){this.order.subtotal=this.order.items.reduce((a,s)=>a+parseFloat(s.total_price),0),this.order.total_amount=this.order.subtotal+parseFloat(this.order.tax_amount||0)-parseFloat(this.order.discount_amount||0)},openCustomerDialog(){this.customerDialog=!0},closeCustomerDialog(){this.customerDialog=!1,this.newCustomer={name:"",email:"",phone:"",document:"",address:""}},async saveCustomer(){if(await this.$refs.customerForm.validate()){this.savingCustomer=!0;try{const s=await this.$axios.post(this.$routes.customers,this.newCustomer),d=s.data.data||s.data;this.customers.push(d),this.order.customer_id=d.id,this.order.shipping_address=d.address,this.showSnackbar("Cliente creado exitosamente","success"),this.closeCustomerDialog()}catch(s){console.error("Error saving customer:",s),this.showSnackbar("Error al crear el cliente","error")}finally{this.savingCustomer=!1}}},async createOrder(){if(await this.$refs.orderForm.validate()){this.creatingOrder=!0;try{const s={...this.order,quantity_products:this.order.items.reduce((f,l)=>f+parseInt(l.quantity),0),total_cost:this.order.items.reduce((f,l)=>f+l.quantity*l.unit_cost_price,0),total_profit:this.order.items.reduce((f,l)=>f+parseFloat(l.total_profit),0)},d=await this.$axios.post(this.$routes.orders,s);this.createdOrder=d.data.data||d.data,this.paymentDialog=!0}catch(s){console.error("Error creating order:",s),this.showSnackbar("Error al crear la orden","error")}finally{this.creatingOrder=!1}}},openPaymentForm(){this.paymentDialog=!1,this.paymentFormDialog=!0},closePaymentForm(){this.paymentFormDialog=!1,this.clearForm()},clearForm(){this.order={customer_id:null,shipping_address:"",delivery_date:"",subtotal:0,tax_amount:0,discount_amount:0,total_amount:0,notes:"",items:[]},this.order.shipping_address="",this.$refs.orderForm.resetValidation(),this.$nextTick(()=>{this.$refs.orderForm.resetValidation()}),this.loadData()},async validatePayments(a){if(a.length<=0)return"Debe incluir al menos una modalidad de pago";const s=new Set;a.reduce((d,f)=>d+parseFloat(f.amount),0);for(const d of a){if(!d.amount||!d.payment_method_id)return"Verifique la informacion de los pagos";if(s.has(d.payment_method_id.id))return"Ha seleccionado mas de una vez el mismo metodo de pago. Metodo de pago: "+d.payment_method_id.name;s.add(d.payment_method_id.id)}return!0},async savePayment(){const a=await this.validatePayments(this.$refs.paymentsRow.payments);if(a!==!0)return this.showSnackbar(a,"error");this.savingPayment=!0;try{const s={order_id:this.createdOrder.order.id,payments:this.$refs.paymentsRow.payments},d=await this.$axios.post(this.$routes.payments,s);console.log(d),d.status==201&&(this.showSnackbar("Pago registrado exitosamente","success"),this.finishOrder())}catch(s){console.error("Error saving payment:",s),this.showSnackbar("Error al registrar el pago","error")}finally{this.savingPayment=!1}},async updateOrderStatus(a){try{await this.$axios.patch(`${this.$routes.orders}/${this.createdOrder.id}/status`,{status:a})}catch(s){console.error("Error updating order status:",s)}},finishOrder(){this.clearForm(),this.paymentDialog=!1,this.paymentFormDialog=!1},formatNumber(a){return new Intl.NumberFormat("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a||0)},formatCurrency(a){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(a||0)},showSnackbar(a,s){this.snackbarText=a,this.snackbarColor=s,this.snackbar=!0},toggleShipping(a){console.log(a.shipping),a.shipping_address_status=!a.shipping_address_status}}},Tt=i("strong",null,"localidad:",-1),Ut=i("strong",null,"telefono:",-1),Ot={class:"text-caption"},Rt={class:"text-warning pt-6",style:{width:"15px !important"}},qt={class:"v-card-item"},Bt={class:"v-card-item__content"},At={class:"v-card-title"},Et={class:"text-h5"},Nt={style:{"min-height":"280px","max-height":"270px","overflow-y":"auto"}},zt={class:"v-card-item"},Ht={class:"v-card-item__content"},Mt={class:"v-card-title"},jt={class:"text-h5"},Gt={class:"v-card-item"},Lt={class:"v-card-item__content"},Wt={class:"v-card-title"},Kt={class:"text-h5"},Qt={class:"text-center mb-5"},Xt=i("h3",{class:"text-h5 font-weight-medium text-success mb-2"}," ¡Orden creada exitosamente! ",-1),Yt=i("p",{class:"text-medium-emphasis mb-0"}," ¿Deseas registrar un pago para esta orden? ",-1),Jt={class:"d-flex justify-space-between align-center mb-3"},Zt=i("span",{class:"text-medium-emphasis"},"Número de Orden:",-1),$t={class:"font-weight-medium"},ea={class:"d-flex justify-space-between align-center"},ta=i("span",{class:"text-medium-emphasis"},"Total:",-1),aa={class:"text-h5 font-weight-medium text-success"},sa={class:"d-flex flex-column gap-2"},la={class:"d-flex justify-space-between"},oa=i("span",{class:"text-caption text-medium-emphasis"},"Total Orden:",-1),ra={class:"font-weight-medium"},ia={class:"d-flex justify-space-between"},na=i("span",{class:"text-caption text-medium-emphasis"},"Total Pagado:",-1),da={class:"font-weight-medium text-primary"},ua={class:"d-flex justify-space-between"},ca=i("span",{class:"text-caption text-medium-emphasis"},"Saldo Pendiente:",-1),ma={class:"d-flex justify-space-between"},pa=i("span",{class:"text-caption text-medium-emphasis"},"Vuelto:",-1),fa={class:"font-weight-medium text-success"},ha={class:"mt-4"};function _a(a,s,d,f,l,r){const k=dt("IconBtn"),O=Oe,R=we("mask");return D(),Z(U,null,[(D(),E(te,{key:l.keyOrderForm,ref:"orderForm",modelValue:l.validOrder,"onUpdate:modelValue":s[15]||(s[15]=o=>l.validOrder=o)},{default:t(()=>[e(_,null,{default:t(()=>[e(n,{cols:"12",sm:"12",md:"6"},{default:t(()=>[e(V,null,{default:t(()=>[e(w,{class:"mb-0 pb-2"},{default:t(()=>[e(_,{class:"mb-0 pb-0"},{default:t(()=>[a.isAdminBebidas?(D(),E(n,{key:0,cols:"1",md:"1",sm:"1",class:"mb-0 pt-3 d-none d-sm-flex"},{default:t(()=>[e(C,{icon:"ri-user-line",class:"text-error mr-2",variant:"tonal",size:"40"})]),_:1})):$("",!0),a.isAdminBebidas?(D(),E(n,{key:1,cols:"9",sm:"9",md:"8",class:"mb-0 pt-4 ml-3"},{default:t(()=>[e(W,{modelValue:l.order.seller_id,"onUpdate:modelValue":s[0]||(s[0]=o=>l.order.seller_id=o),items:l.sellers,"item-title":"name","item-value":"id",label:"Seleccionar Vendedor",rules:[o=>!!o||"Vendedor es requerido"],clearable:"",density:"compact","return-object":""},null,8,["modelValue","items","rules"])]),_:1})):$("",!0)]),_:1}),e(_,{class:ee(["mb-0",a.isAdminBebidas?"pb-0":"py-8"])},{default:t(()=>[e(n,{cols:"1",md:"1",sm:"1",class:"mb-0 pt-0 d-none d-sm-flex"},{default:t(()=>[e(C,{icon:"ri-user-line",class:"text-info mr-2",variant:"tonal",size:"40"})]),_:1}),e(n,{cols:"9",sm:"9",md:"8",class:"mb-0 pt-0 ml-3"},{default:t(()=>[e(W,{modelValue:l.order.customer_id,"onUpdate:modelValue":[s[1]||(s[1]=o=>l.order.customer_id=o),r.onCustomerChange],items:l.customers,"item-title":"address","item-value":"id",label:"Seleccionar Cliente",rules:[o=>!!o||"Cliente es requerido"],clearable:"",density:"compact"},{item:t(({props:o,item:c})=>[e(ve,{border:"info md"},{default:t(()=>[e(_e,fe(he(o)),{default:t(()=>[e(ye,{class:"text-caption"},{default:t(()=>[Tt,u(y(c.raw.locality_id)+" - ",1),Ut,u(y(c.raw.telephone),1)]),_:2},1024)]),_:2},1040)]),_:2},1024)]),_:1},8,["modelValue","items","rules","onUpdate:modelValue"])]),_:1}),e(n,{cols:"auto",class:"mb-0 pt-0"},{default:t(()=>[e(p,{onClick:r.openCustomerDialog,color:a.$cv("principal"),title:"nuevo cliente"},{default:t(()=>[e(g,{icon:"ri-user-add-line",class:"mr"})]),_:1},8,["onClick","color"])]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",sm:"12",md:"6"},{default:t(()=>[e(V,null,{default:t(()=>[e(w,{class:"mb-0 pb-2"},{default:t(()=>[e(_,{class:"mb-0 pb-0"},{default:t(()=>[e(n,{cols:"1",md:"1",class:"mb-0 pb-0 pt-2 d-none d-sm-flex"},{default:t(()=>[e(C,{icon:"ri-map-pin-line",class:"text-info mr-2",variant:"tonal"})]),_:1}),e(n,{cols:"1",md:"1",class:"mb-0 pt-5 ml-1"},{default:t(()=>[e(_t,{modelValue:l.order.shipping,"onUpdate:modelValue":s[2]||(s[2]=o=>l.order.shipping=o),"true-value":1,"false-value":0,color:"primary","hide-details":"",title:"Requiere Envío",onClick:s[3]||(s[3]=o=>r.toggleShipping(l.order))},null,8,["modelValue"])]),_:1}),e(n,{cols:"8",sm:"8",md:"8",class:"mb-0 pt-3"},{default:t(()=>[e(h,{modelValue:l.order.shipping_address,"onUpdate:modelValue":s[4]||(s[4]=o=>l.order.shipping_address=o),label:"Dirección de Entrega",rules:[o=>!!o||"Dirección de entrega es requerida"],disabled:!l.order.shipping},null,8,["modelValue","rules","disabled"])]),_:1}),e(n,{cols:"auto",md:"auto",class:"mb-0"},{default:t(()=>[e(p,{onClick:r.useCustomerAddress,color:a.$cv("principal"),title:"Usar del cliente"},{default:t(()=>[e(g,{icon:"ri-refresh-line",class:"mr-2"})]),_:1},8,["onClick","color"])]),_:1})]),_:1}),e(_,{class:"mb-0 pb-2"},{default:t(()=>[e(n,{cols:"1",md:"1",class:"mb-0 pb-0 pt-0 d-none d-sm-flex"},{default:t(()=>[e(C,{icon:"ri-truck-line",class:"text-info mr-2",variant:"tonal"})]),_:1}),e(n,{cols:"1",md:"1",class:"ml-1"}),e(n,{cols:"8",sm:"8",md:"8",class:"mb-0 pt-0"},{default:t(()=>[ne(e(h,{modelValue:l.order.delivery_date,"onUpdate:modelValue":s[5]||(s[5]=o=>l.order.delivery_date=o),label:"Fecha de Entrega",placeholder:"dd/mm/yyyy",clearable:"",onFocus:s[6]||(s[6]=o=>r.setDate(l.order.delivery_date)),disabled:!l.order.shipping},null,8,["modelValue","disabled"]),[[R,"##/##/####"]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(n,{cols:"12",sm:"12",md:"12"},{default:t(()=>[e(V,null,{default:t(()=>[e(w,{class:"mb-0 pb-3"},{default:t(()=>[e(_,{class:"mb-0 pb-0"},{default:t(()=>[e(n,{class:"mb-0 pb-0 pt-4 d-none d-sm-flex flex-grow-0"},{default:t(()=>[e(C,{icon:"ri-shopping-cart-line",class:"text-info mr-2",variant:"tonal",size:"40"})]),_:1}),e(n,{cols:"8",md:"5",class:"pt-5"},{default:t(()=>[e(W,{modelValue:l.newItem.product_id,"onUpdate:modelValue":[s[7]||(s[7]=o=>l.newItem.product_id=o),r.onProductChange],items:l.products,"item-title":"name","item-value":"id",label:"Seleccionar Producto",clearable:"",density:"compact"},{item:t(({props:o,item:c})=>[e(ve,{border:"info md"},{default:t(()=>[e(_e,fe(he(o)),{default:t(()=>[e(ye,{class:"text-caption"},{default:t(()=>[e(ht,{color:r.getProductStock(c.raw.id)>0?"success":"error"},{default:t(()=>[u("Stock: "+y(r.getProductStock(c.raw.id)),1)]),_:2},1032,["color"]),u(" Código: "+y(c.raw.code),1)]),_:2},1024)]),_:2},1040)]),_:2},1024)]),_:1},8,["modelValue","items","onUpdate:modelValue"])]),_:1}),e(n,{cols:"4",md:"1",class:"pr-0"},{default:t(()=>[i("div",{class:ee([l.newItem.product_id&&r.showStockWarning(l.newItem.product_id,l.newItem.quantity)?"bg-warning-2 rounded-lg":"","px-2 pt-2"])},[e(h,{modelValue:l.newItem.quantity,"onUpdate:modelValue":s[8]||(s[8]=o=>l.newItem.quantity=o),label:"Cant",type:"number",min:"1",rules:[o=>!!o||"Cantidad requerida",o=>o>0||"Debe ser mayor a 0"],density:"compact"},null,8,["modelValue","rules"]),i("div",Ot," En stock: "+y(r.getProductStock(l.newItem.product_id)),1)],2)]),_:1}),i("div",Rt,[l.newItem.product_id&&r.showStockWarning(l.newItem.product_id,l.newItem.quantity)?(D(),E(g,{key:0,icon:"ri-error-warning-fill",title:"Stock Insuficiente"})):$("",!0)]),e(n,{cols:"6",md:"2",class:"pt-5"},{default:t(()=>[e(h,{modelValue:l.newItem.unit_price,"onUpdate:modelValue":s[9]||(s[9]=o=>l.newItem.unit_price=o),label:"Precio Unitario",type:"number",step:"0.01",prefix:"$",rules:[o=>!!o||"Precio requerido",o=>o>0||"Debe ser mayor a 0"],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"6",md:"2",class:"pt-5"},{default:t(()=>[e(h,{"model-value":r.calculateItemTotal(),label:"Total",prefix:"$",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"])]),_:1}),e(n,{cols:"12",md:"1",class:"pt-5"},{default:t(()=>[e(p,{color:"primary",onClick:r.addItem,disabled:!r.canAddItem,block:""},{default:t(()=>[e(g,{icon:"ri-add-line"})]),_:1},8,["onClick","disabled"])]),_:1})]),_:1}),e(_,{class:"my-0"},{default:t(()=>[e(n,{cols:"12",sm:"12",md:"9"},{default:t(()=>[e(V,null,{default:t(()=>[i("div",qt,[i("div",Bt,[i("div",At,[i("h5",Et,[e(C,{icon:"ri-luggage-cart-line",class:"text-info mr-2",variant:"tonal"}),u("Productos agregados")])])])]),e(w,null,{default:t(()=>[i("div",Nt,[e(wt,{headers:l.itemHeaders,items:l.order.items,class:"elevation-1","no-data-text":"No hay productos agregados",density:"compact"},ut({"item.product_name":t(({item:o})=>{var c;return[u(y((c=r.getProductById(o.product_id))==null?void 0:c.name),1)]}),"item.unit_price":t(({item:o,index:c})=>[e(h,{modelValue:o.unit_price,"onUpdate:modelValue":b=>o.unit_price=b,type:"number",step:"0.01",prefix:"$",density:"compact","hide-details":"",onInput:b=>r.updateItemTotal(c),class:"ma-0 pa-0 text-sm"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),"item.quantity":t(({item:o,index:c})=>[e(h,{modelValue:o.quantity,"onUpdate:modelValue":b=>o.quantity=b,type:"number",min:"1",density:"compact","hide-details":"",onInput:b=>r.updateItemTotal(c),style:{width:"80px"}},null,8,["modelValue","onUpdate:modelValue","onInput"])]),"item.total_price":t(({item:o})=>[u(" $"+y(r.formatNumber(o.total_price)),1)]),"item.actions":t(({index:o})=>[e(k,{size:"small",color:"error",onClick:c=>r.removeItem(o)},{default:t(()=>[e(g,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])]),_:2},[l.showFooter?void 0:{name:"bottom",fn:t(()=>[]),key:"0"}]),1032,["headers","items"])])]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",sm:"12",md:"3"},{default:t(()=>[e(V,null,{default:t(()=>[i("div",zt,[i("div",Ht,[i("div",Mt,[i("h5",jt,[e(C,{icon:"ri-calculator-line",class:"text-info mr-2",variant:"tonal"}),u("Totales")])])])]),e(w,null,{default:t(()=>[e(_,null,{default:t(()=>[e(n,{cols:"12",md:"12"},{default:t(()=>[e(h,{modelValue:l.order.discount_amount,"onUpdate:modelValue":s[10]||(s[10]=o=>l.order.discount_amount=o),label:"Descuento",type:"number",step:"0.01",prefix:"$",onInput:r.calculateTotals,density:"compact",class:"number-end"},null,8,["modelValue","onInput"])]),_:1}),e(n,{cols:"12",md:"12"},{default:t(()=>[e(h,{modelValue:l.order.tax_amount,"onUpdate:modelValue":s[11]||(s[11]=o=>l.order.tax_amount=o),label:"Impuestos",type:"number",step:"0.01",prefix:"$",onInput:r.calculateTotals,density:"compact",class:"number-end"},null,8,["modelValue","onInput"])]),_:1})]),_:1}),e(re,{class:"my-4"}),e(_,null,{default:t(()=>[e(n,{cols:"12",md:"12"},{default:t(()=>[e(h,{"model-value":r.formatCurrency(l.order.subtotal),label:"Subtotal",readonly:"",variant:"outlined",density:"compact",class:"custom-bg-gray number-end"},null,8,["model-value"])]),_:1}),e(n,{cols:"12",md:"12"},{default:t(()=>[e(h,{"model-value":r.formatCurrency(l.order.discount_amount),label:"Descuento",readonly:"",variant:"outlined",density:"compact",class:"custom-bg-gray number-end"},{input:t(({props:o})=>[i("input",N(o,{class:"text-right",style:{"text-align":"right"}}),null,16)]),_:1},8,["model-value"])]),_:1}),e(n,{cols:"12",md:"12"},{default:t(()=>[e(h,{"model-value":r.formatCurrency(l.order.total_amount),label:"Total Final",readonly:"",variant:"outlined",class:"text-h6 custom-bg-gray number-end",density:"compact"},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(n,{cols:"12",sm:"12",md:"12"},{default:t(()=>[e(V,null,{default:t(()=>[i("div",Gt,[i("div",Lt,[i("div",Wt,[i("h5",Kt,[e(C,{icon:"ri-file-text-line",class:"text-info mr-2",variant:"tonal"}),u("Notas Adicionales")])])])]),e(w,null,{default:t(()=>[e(Dt,{modelValue:l.order.notes,"onUpdate:modelValue":s[12]||(s[12]=o=>l.order.notes=o),label:"Notas de la orden",rows:"2",style:{height:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(n,{cols:"12",class:"text-center"},{default:t(()=>[e(p,{color:"primary",variant:"outlined",class:"mr-4",onClick:s[13]||(s[13]=o=>a.$router.go(-1))},{default:t(()=>[e(g,{icon:"ri-close-circle-line",class:"mr-2"}),u(" Cancelar ")]),_:1}),e(p,{color:"primary",class:"mr-4",onClick:s[14]||(s[14]=o=>a.$router.push({path:"order-search"}))},{default:t(()=>[e(g,{icon:"ri-shopping-bag-line",class:"mr-2"}),u(" Ordenes ")]),_:1}),e(p,{color:"primary",onClick:r.createOrder,loading:l.creatingOrder,disabled:!r.canCreateOrder},{default:t(()=>[e(g,{icon:"ri-save-line",class:"mr-2"}),u(" Crear Orden ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])),e(ae,{modelValue:l.customerDialog,"onUpdate:modelValue":s[22]||(s[22]=o=>l.customerDialog=o),"max-width":"600px"},{default:t(()=>[e(V,null,{default:t(()=>[e(se,{color:"primary"},{default:t(()=>[e(p,{icon:"ri-close-line",color:"white",onClick:r.closeCustomerDialog},null,8,["onClick"]),e(le,null,{default:t(()=>[u("Nuevo Cliente")]),_:1})]),_:1}),e(te,{ref:"customerForm",modelValue:l.validCustomer,"onUpdate:modelValue":s[21]||(s[21]=o=>l.validCustomer=o)},{default:t(()=>[e(w,null,{default:t(()=>[e(Pt,null,{default:t(()=>[e(_,null,{default:t(()=>[e(n,{cols:"12",sm:"6"},{default:t(()=>[e(h,{modelValue:l.newCustomer.address,"onUpdate:modelValue":s[16]||(s[16]=o=>l.newCustomer.address=o),label:"Dirección",rules:[o=>!!o||"Dirección es requerida"],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:t(()=>[e(h,{modelValue:l.newCustomer.phone,"onUpdate:modelValue":s[17]||(s[17]=o=>l.newCustomer.phone=o),label:"Teléfono",rules:[o=>!!o||"Teléfono es requerido"],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:t(()=>[e(h,{modelValue:l.newCustomer.name,"onUpdate:modelValue":s[18]||(s[18]=o=>l.newCustomer.name=o),label:"Nombre",density:"compact"},null,8,["modelValue"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:t(()=>[e(W,{modelValue:l.newCustomer.locality_id,"onUpdate:modelValue":s[19]||(s[19]=o=>l.newCustomer.locality_id=o),items:l.localities,"item-title":"name","item-value":"id",label:"Localidad",clearable:"",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:t(()=>[e(h,{modelValue:l.newCustomer.email,"onUpdate:modelValue":s[20]||(s[20]=o=>l.newCustomer.email=o),label:"Email",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(oe,null,{default:t(()=>[e(ie),e(p,{variant:"outlined",color:"primary",onClick:r.closeCustomerDialog},{default:t(()=>[u(" Cancelar ")]),_:1},8,["onClick"]),e(p,{color:"white",class:"bg-primary",onClick:r.saveCustomer,loading:l.savingCustomer},{default:t(()=>[u(" Guardar Cliente ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(ae,{modelValue:l.paymentDialog,"onUpdate:modelValue":s[25]||(s[25]=o=>l.paymentDialog=o),"max-width":"580px",persistent:""},{default:t(()=>[e(V,{class:"rounded-lg"},{default:t(()=>[e(se,{color:"primary",density:"compact"},{default:t(()=>[e(le,{class:"text-white font-weight-medium"},{default:t(()=>[e(p,{icon:"ri-close-line",color:"white",onClick:s[23]||(s[23]=o=>l.paymentDialog=!1)}),u(" Confirmación de Pago ")]),_:1}),e(ie),e(p,{icon:"",variant:"text",color:"white",onClick:s[24]||(s[24]=o=>l.paymentDialog=!1),class:"mr-1"},{default:t(()=>[e(g,null,{default:t(()=>[u("mdi-close")]),_:1})]),_:1})]),_:1}),e(w,{class:"px-4 pt-5 pb-2"},{default:t(()=>[i("div",Qt,[e(C,{color:"success-lighten-5",size:"56",class:"mb-3"},{default:t(()=>[e(g,{icon:"ri-checkbox-circle-fill",color:"success",size:"80"})]),_:1}),Xt,Yt]),e(V,{flat:"",border:"",class:"mb-4"},{default:t(()=>[e(w,{class:"pa-4"},{default:t(()=>{var o,c,b,q;return[i("div",Jt,[Zt,i("span",$t," #"+y((c=(o=l.createdOrder)==null?void 0:o.order)==null?void 0:c.order_number),1)]),i("div",ea,[ta,i("span",aa,y(r.formatCurrency((q=(b=l.createdOrder)==null?void 0:b.order)==null?void 0:q.total_amount)),1)])]}),_:1})]),_:1})]),_:1}),e(oe,{class:"px-4 pb-4 pt-0"},{default:t(()=>[e(_,null,{default:t(()=>[e(n,{cols:"12",md:"12",sm:"12",class:"pt-4 pb-0 my-0"},{default:t(()=>[e(p,{variant:"outlined",color:"primary",onClick:r.finishOrder,block:"",class:"text-capitalize mr-2"},{default:t(()=>[e(g,{icon:"mdi-check",class:"mr-1"}),u(" Finalizar sin pago ")]),_:1},8,["onClick"])]),_:1}),e(n,{cols:"12",md:"12",sm:"12",class:"pt-1 pb-2 my-0"},{default:t(()=>[e(p,{color:"white",onClick:r.openPaymentForm,block:"",class:"bg-primary text-capitalize"},{default:t(()=>[e(g,{icon:"mdi-cash-plus",class:"mr-1"}),u(" Registrar Pago ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ae,{modelValue:l.paymentFormDialog,"onUpdate:modelValue":s[27]||(s[27]=o=>l.paymentFormDialog=o),"max-width":"600px",persistent:""},{default:t(()=>[e(V,{class:"rounded-lg"},{default:t(()=>[e(se,{color:"primary",density:"compact",class:"ml-0 pl-0"},{default:t(()=>[e(le,{class:"text-h6 font-weight-medium text-white"},{default:t(()=>[e(p,{icon:"ri-close-line",color:"white",onClick:r.closePaymentForm},null,8,["onClick"]),u(" Registrar Pago ")]),_:1}),e(ie),e(p,{icon:"",variant:"text",color:"white",onClick:r.closePaymentForm},{default:t(()=>[e(g,null,{default:t(()=>[u("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),e(te,{ref:"paymentForm",modelValue:l.validPayment,"onUpdate:modelValue":s[26]||(s[26]=o=>l.validPayment=o)},{default:t(()=>[e(w,{class:"px-4 pt-4 pb-2"},{default:t(()=>[e(V,{flat:"",class:"border",color:"surface"},{default:t(()=>[e(pt,{class:"py-2"},{default:t(()=>[e(ft,{class:"text-subtitle-1 font-weight-medium d-flex align-center"},{default:t(()=>[e(C,{icon:"ri-money-dollar-circle-line",class:"text-primary mr-2",variant:"tonal"}),u(" Resumen de Pagos ")]),_:1})]),_:1}),e(re),e(w,{class:"px-2 py-3"},{default:t(()=>{var o,c;return[i("div",sa,[i("div",la,[oa,i("span",ra,y(r.formatCurrency((c=(o=l.createdOrder)==null?void 0:o.order)==null?void 0:c.total_amount)),1)]),i("div",ia,[na,i("span",da,y(r.formatCurrency(l.totalPaid)),1)]),i("div",ua,[ca,i("span",{class:ee(["font-weight-medium",r.pendingAmount>0?"text-error":"text-success"])},y(r.formatCurrency(r.pendingAmount)),3)]),e(re,{class:"my-1"}),i("div",ma,[pa,i("span",fa,y(r.formatCurrency(l.change)),1)])])]}),_:1})]),_:1}),i("div",ha,[(D(),E(O,{ref:"paymentsRow",key:l.keyPayments,modulo:"pagos",onUpdateTotal:r.updateTotal},null,8,["onUpdateTotal"]))])]),_:1}),e(oe,{class:"px-4 pb-4 pt-2"},{default:t(()=>[e(_,null,{default:t(()=>[e(n,{cols:"12",md:"12",sm:"12",class:"pt-4 pb-0 my-0"},{default:t(()=>[e(p,{variant:"outlined",color:"primary",onClick:r.closePaymentForm,class:"text-capitalize",block:""},{default:t(()=>[u(" Cancelar ")]),_:1},8,["onClick"])]),_:1}),e(n,{cols:"12",md:"12",sm:"12",class:"pt-1 my-0 pb-2"},{default:t(()=>[e(p,{onClick:r.savePayment,loading:l.savingPayment,disabled:!l.validPayment,color:"white",class:"bg-primary text-capitalize",block:""},{default:t(()=>[l.savingPayment?(D(),Z(U,{key:1},[u(" Procesando... ")],64)):(D(),Z(U,{key:0},[e(g,{icon:"mdi-check-circle-outline",class:"mr-1"}),u(" Confirmar Pago ")],64))]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(mt,{modelValue:l.snackbar,"onUpdate:modelValue":s[29]||(s[29]=o=>l.snackbar=o),color:l.snackbarColor,timeout:4e3},{action:t(({attrs:o})=>[e(p,N({text:""},o,{onClick:s[28]||(s[28]=c=>l.snackbar=!1)}),{default:t(()=>[u(" Cerrar ")]),_:2},1040)]),default:t(()=>[u(y(l.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])],64)}const Ma=ct(St,[["render",_a]]);export{Ma as default};

import{_ as Q}from"./PaymentsRow-B9Po7Lk0.js";import{_ as Y}from"./DateRangeField-rHtEFvtq.js";import{ac as W,e as b,w as t,v as X,o as _,b as e,a as o,V as h,a3 as g,H as c,t as d,c as v,l as C,n as D,a0 as O,k as M,F as T,x as Z,y as $}from"./main-D-FNcJ5Q.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as w,c as F,V as S,d as I,b as U}from"./VCard-B9H2nVrW.js";import{V as te}from"./VDataTable-Dm3sGLe9.js";import{a as R,V as f}from"./VRow-Ccs27aI9.js";import{V as se}from"./VTextField-Cxefcz0w.js";import{V}from"./VAutocomplete-DztI00yR.js";import{V as N,e as P,a as z,b as k,c as E}from"./VChip-BHUHjEql.js";import{V as B}from"./VDialog-B_5yp4IB.js";import{a as j,b as G,V as ae}from"./VSnackbar-VJSLefhp.js";import{V as H}from"./VForm-BQmVpmiY.js";import{V as L}from"./VAvatar-yRb2AyES.js";import{V as A}from"./VDivider-D4qvZZu2.js";import{V as q}from"./VSpacer-DOVH59ZK.js";import"./VImg-LIdzWOkd.js";import"./VSelect-iYd76WP_.js";import"./forwardRefs-C-GTDzx5.js";import"./VOverlay-Du9Mdrcw.js";import"./easing-DY7PVvcf.js";import"./lazy-beIlw_aA.js";import"./VCheckboxBtn-BGEB4GOz.js";import"./VTable-D0vxZhBM.js";import"./index-BnInBex3.js";import"./ssrBoot-BsWm5Mof.js";const re={components:{DateRangeField:Y},data(){return{keyPayments:1,validPayment:!1,savingPayment:!1,change:0,totalPaid:0,payment:{amount:0,payment_method_id:null,notes:""},dateRange:{start:null,end:null},dateOrderRange:{start:null,end:null},defaultDateRange:{},loading:!1,search:"",customers:[],sellers:[],selectedSeller:null,paymentStatuses:[],shipmentStatuses:[],selectedCustomer:null,selectedPaymentStatus:null,selectedShipmentStatus:null,selectedOrder:null,movementDialog:!1,paymentFormDialog:!1,validMovement:!1,savingMovement:!1,movement:{status_id:null},snackbar:!1,snackbarText:"",snackbarColor:"success",headers:[{title:"",key:"actions",sortable:!1,align:"left",width:"0px",cellProps:{class:"actions-cell"}},{title:"Orden",key:"order_number",width:"60px"},{title:"Fecha",key:"order_date",align:"center",width:"60px"},{title:"Cliente",key:"customer",width:"70%"},{title:"Total",key:"total_amount",align:"end"},{title:"Pagado",key:"total_paid",align:"end"},{title:"Vendedor",key:"seller_name",width:"10%"},{title:"Fecha Entrega",key:"delivery_date",align:"center",width:"100px"},{title:"Estados",key:"payment_status_id",align:"center"}],isAdmin:!1,createdOrder:{order:{}},pagination:{page:1,itemsPerPage:10,sortBy:[],sortDesc:[]},orders:{data:[],total:0,current_page:1,last_page:1},isInitialLoad:!0}},computed:{...W({userIsAdmin:"isAdmin"}),showHeaders(){return this.headers},pendingAmount(){return this.createdOrder&&this.totalPaid<this.createdOrder.order.total_amount?this.createdOrder.order.total_amount-this.totalPaid:0},movementFormTitle(){return this.selectedOrder?`Cambio de estado de orden ${this.selectedOrder.order_number}`:"Cambio de estado de orden"}},async created(){this.checkAdmin(),this.isAdmin&&this.headers.splice(5,0,{title:"Costo",key:"total_cost",align:"end"},{title:"Ganancia",key:"total_profit",align:"end"}),await this.loadData(),this.selectedShipmentStatus=this.getPendingShipmentStatus(),this.fetchData()},methods:{handleSelection(){setTimeout(()=>{this.$refs.autocompleteRef&&(this.$refs.autocompleteRef.blur(),this.$refs.autocompleteRef.focus())},100)},calculateTotalAmount(){return this.orders.data?this.orders.data.reduce((a,s)=>a+(parseFloat(s.total_amount)||0),0).toFixed(2):0},calculateTotalPaid(){return this.orders.data?this.orders.data.reduce((a,s)=>a+(parseFloat(s.total_paid)||0),0).toFixed(2):0},calculateTotalCost(){return this.orders.data?this.orders.data.reduce((a,s)=>a+(parseFloat(s.total_cost)||0),0).toFixed(2):0},calculateTotalProfit(){return this.orders.data?this.orders.data.reduce((a,s)=>a+(parseFloat(s.total_profit)||0),0).toFixed(2):0},calculateTotalProducts(){return this.orders.data?this.orders.data.reduce((a,s)=>a+(s.quantity_products||0),0):0},unsetInitialLoad(){this.isInitialLoad=!1},setDefaultDateRange(){const a=new Date().toISOString().split("T")[0],s=new Date;s.setDate(s.getDate()-60),this.defaultDateRange={start:s.toISOString().split("T")[0],end:a}},async updatePaymentStatus(a,s){if(s.id!==a.payment_status.id){if(s.id==5){alert("esta intentando cancelar una orden");return}try{this.loading=!0;const n=await this.$axios.post(`${this.$routes.orders}/${a.id}`,{data:{payment_status_id:s.id,_method:"PUT"}});a.payment_status=s,this.showSnackbar("Estado actualizado correctamente","success")}catch(n){console.error("Error al actualizar estado:",n),this.showSnackbar("Error al actualizar el estado","error"),this.fetchData()}finally{this.loading=!1}}},async updateShippingStatus(a,s){if(s.id!==a.shipment_status.id)try{this.loading=!0;const n=await this.$axios.post(`${this.$routes.orders}/${a.id}`,{data:{shipment_status_id:s.id}});a.shipment_status=s,this.showSnackbar("Estado actualizado correctamente","success")}catch(n){console.error("Error al actualizar estado:",n),this.showSnackbar("Error al actualizar el estado","error")}finally{this.loading=!1,this.fetchData()}},reset(){this.selectedCustomer=null,this.selectedPaymentStatus=null,this.search="",this.pagination.page=1,this.dateRange={start:null,end:null},this.dateOrderRange={start:null,end:null},this.$nextTick(()=>{this.$refs.dateDeliveryRange&&this.$refs.dateDeliveryRange.reset&&this.$refs.dateDeliveryRange.reset(),this.$refs.dateOrderRange&&this.$refs.dateOrderRange.reset&&this.$refs.dateOrderRange.reset()}),this.fetchData()},handlePaginationChange(a){this.pagination.page=a.page,this.pagination.itemsPerPage=a.itemsPerPage,this.pagination.sortBy=a.sortBy,this.pagination.sortDesc=a.sortDesc,this.fetchData()},async fetchData(){var a,s,n,u,r;this.loading=!0;try{if(!this.selectedShipmentStatus)return;console.log("selectedShipmentStatus:",this.selectedShipmentStatus);const i={order_number:this.search||void 0,customers:this.selectedCustomer||void 0,sellers:this.selectedSeller||void 0,payment_status_id:this.selectedPaymentStatus||void 0,shipment_status_id:this.selectedShipmentStatus||void 0,page:this.pagination.page,per_page:this.pagination.itemsPerPage,sort_by:this.pagination.sortBy.length?this.pagination.sortBy[0]:void 0,sort_order:(a=this.pagination.sortDesc)!=null&&a.length?this.pagination.sortDesc[0]?"desc":"asc":void 0};(s=this.dateRange)!=null&&s.start&&((n=this.dateRange)!=null&&n.end)&&(i.delivery_start_date=this.dateRange.start,i.delivery_end_date=this.dateRange.end),(u=this.dateOrderRange)!=null&&u.start&&((r=this.dateOrderRange)!=null&&r.end)&&(i.order_start_date=this.dateOrderRange.start,i.order_end_date=this.dateOrderRange.end),Object.keys(i).forEach(x=>i[x]===void 0&&delete i[x]);const[p]=await Promise.all([this.$axios.get(this.$routes.ordersSearch,{params:i})]);this.orders={data:p.data.data,total:p.data.total,current_page:p.data.current_page,last_page:p.data.last_page}}catch(i){console.error("Error fetching data:",i),this.showSnackbar("Error al cargar los datos","error")}finally{this.loading=!1}},async loadData(){this.loading=!0;try{const[a,s,n,u]=await Promise.all([this.$axios.get(this.$routes.customers),this.$axios.get(this.$routes.paymentStatuses),this.$axios.get(this.$routes.shipmentStatuses),this.$axios.get(this.$routes.usersList)]);this.customers=a.data.data,this.sellers=u.data.data,this.paymentStatuses=s.data.data.filter(r=>r.code!="cancelled"&&r.code!="refund"),this.shipmentStatuses=n.data.data.filter(r=>r.code!="cancelled")}catch(a){console.error("Error fetching data:",a),this.showSnackbar("Error al cargar los datos","error")}finally{this.loading=!1}},openPaymentForm(a){this.keyPayments=1,this.createdOrder.order=a,this.paymentFormDialog=!0},closePaymentForm(){this.createdOrder.order={},this.paymentFormDialog=!1},updateTotal(a){this.totalPaid=a,this.change=this.totalPaid>this.createdOrder.order.total_amount?this.totalPaid-this.createdOrder.order.total_amount:0},async validatePayments(a){if(a.length<=0)return"Debe incluir al menos una modalidad de pago";const s=new Set;a.reduce((n,u)=>n+parseFloat(u.amount),0);for(const n of a){if(!n.amount||!n.payment_method_id)return"Verifique la informacion de los pagos";s.add(n.payment_method_id.id)}return!0},async savePayment(){const a=await this.validatePayments(this.$refs.paymentsRow.newPayments);if(a!==!0)return this.showSnackbar(a,"error");this.savingPayment=!0;try{const s={order_id:this.createdOrder.order.id,payments:this.$refs.paymentsRow.newPayments};(await this.$axios.post(this.$routes.payments,s)).status==201&&(this.showSnackbar("Pago registrado exitosamente","success"),this.closePaymentForm(),this.fetchData())}catch(s){console.error("Error saving payment:",s),this.showSnackbar("Error al registrar el pago","error")}finally{this.savingPayment=!1}},checkAdmin(){this.isAdmin=this.userIsAdmin},validateStatusChange(a,s){if(!a)return"Debe seleccionar un estado";if(s==1){if(a===this.selectedOrder.payment_status_id)return"El estado de pago seleccionado es igual al estado de pago actual"}else if(a===this.selectedOrder.shipment_status_id)return"El estado de envio seleccionado es igual al estado de envio actual";return!0},normalizeDateToStartOfDay(a){const s=new Date(a);return s.setHours(0,0,0,0),s},normalizeDateToEndOfDay(a){const s=new Date(a);return s.setHours(23,59,59,999),s},parseDdMmYyyyToDate(a){if(!a)return null;const s=a.split(" ")[0],[n,u,r]=s.split("/").map(Number);return isNaN(n)||isNaN(u)||isNaN(r)?null:new Date(Date.UTC(r,u-1,n))},getCustomer(a){return a?a.firstname||a.lastname?`${a.firstname||""} ${a.lastname||""}`.trim():a.address||"Dirección no disponible":"Cliente no disponible"},formatCurrency(a){return a?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(a):"$0"},openMovementDialog(a){a?this.selectedOrder=a:this.selectedOrder=null,this.movementDialog=!0},closeMovementDialog(){var a;this.movementDialog=!1,(a=this.$refs.movementForm)==null||a.reset()},async saveMovement(){var s,n;if(await this.$refs.movementForm.validate()){this.savingMovement=!0;try{let u,r;u=`${this.$routes.orders}/${this.selectedOrder.id}`,r={data:{payment_status_id:this.movement.payment_status_id,shipment_status_id:this.movement.shipment_status_id}},await this.$axios.post(u,r),this.showSnackbar("Estado actualizado correctamente","success"),this.closeMovementDialog(),await this.fetchData()}catch(u){console.error("Error saving movement:",u),this.showSnackbar(((n=(s=u.response)==null?void 0:s.data)==null?void 0:n.message)||"Error al registrar el movimiento","error")}finally{this.savingMovement=!1}}},getStatusColor(a){return{[this.$paymentStatus.PENDING]:"warning",[this.$paymentStatus.PROCESS]:"warning",[this.$paymentStatus.PARTIAL_PAYMENT]:"warning",[this.$paymentStatus.PAID]:"success",[this.$paymentStatus.COMPLETED]:"success",[this.$paymentStatus.APPROVED]:"success"}[a.status.code]||"error"},getStatusCodeColor(a){return{[this.$paymentStatus.PENDING]:"warning",[this.$paymentStatus.PROCESS]:"warning",[this.$paymentStatus.PARTIAL_PAYMENT]:"warning",[this.$paymentStatus.PAID]:"success",[this.$paymentStatus.COMPLETED]:"success",[this.$paymentStatus.APPROVED]:"success"}[a]||"error"},getStatusCodeColorShipping(a){return{[this.$shipmentStatus.NOT_REQUIRED]:"success",[this.$shipmentStatus.DELIVERED]:"success",[this.$shipmentStatus.SHIPPED]:"success",[this.$shipmentStatus.READY_PICKUP]:"warning",[this.$shipmentStatus.PENDING]:"warning",[this.$shipmentStatus.IN_TRANSIT]:"warning",[this.$shipmentStatus.CANCEL]:"error",[this.$shipmentStatus.FAILED]:"error",[this.$shipmentStatus.RETURNED]:"error"}[a]||"error"},isPaid(a){return[this.$paymentStatus.PAID,this.$paymentStatus.COMPLETED,this.$paymentStatus.REJECTED,this.$paymentStatus.CANCEL,this.$paymentStatus.REFUND,this.$paymentStatus.RETURNED].includes(a.status.code)},formatDate(a){return new Date(a).toLocaleString()},formatDateGrid(a){if(!a)return"";const[s,n]=a.split(" ");return`${s} ${n||""}`},getDate(a){return a.toLocaleString().split(" ")[0]},showSnackbar(a,s){this.snackbarText=a,this.snackbarColor=s,this.snackbar=!0},getPendingShipmentStatus(){var s;return((s=this.shipmentStatuses.find(n=>n.code===this.$shipmentStatus.PENDING))==null?void 0:s.id)||null},async getDeliveryReport(a){try{this.loading=!0;const s=a==1?`${this.$routes.ordersDelivery}`:a==2?`${this.$routes.ordersCustomersDelivery}`:`${this.$routes.ordersDeliveryExcel}`,n={start_date:this.dateRange.start,end_date:this.dateRange.end,shipment_status_id:this.selectedShipmentStatus,customers:this.selectedCustomer,sellers:this.selectedSeller,order_number:this.search||void 0,payment_status_id:this.selectedPaymentStatus||void 0,shipping:1};if(a==3){const u=await this.$axios.get(s,{params:n,responseType:"blob"}),r=new Blob([u.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(r),p=document.createElement("a");p.href=i,p.setAttribute("download","reporte_entrega_productos.xlsx"),document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(i),document.body.removeChild(p)}else{const u=await this.$axios.get(s,{params:n,responseType:"blob"}),r=new Blob([u.data],{type:"application/pdf"}),i=window.URL.createObjectURL(r),p=document.createElement("a");p.target="_blank",p.href=i,document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(i),document.body.removeChild(p)}}catch(s){console.error("Error generando reporte:",s),this.showSnackbar("Error al generar el reporte","error")}finally{this.loading=!1}},async editOrder(a){try{this.loading=!0,this.$router.push({path:"/order-create",query:{edit:!0,orderId:a.id}})}catch(s){console.error("Error al obtener datos de la orden:",s),this.showSnackbar("Error al cargar la orden para edición","error")}finally{this.loading=!1}},async showRemito(a){try{this.loading=!0;const n=await this.$axios.get(`${this.$routes.orders}/remito/${a.id}`,{responseType:"blob"});var s=new Blob([n.data],{type:"application/pdf"});const u=window.URL.createObjectURL(s,{oneTimeOnly:!0}),r=document.createElement("a");r.target="_blank",r.href=u,document.body.appendChild(r),r.click()}catch(n){console.error("Error generando factura:",n),this.showSnackbar("Error al generar la factura","error")}finally{this.loading=!1}},async showRemitoComanda(a){try{this.loading=!0;const n=await this.$axios.get(`${this.$routes.orders}/remito-comanda/${a.id}`,{responseType:"blob"});var s=new Blob([n.data],{type:"application/pdf"});const u=window.URL.createObjectURL(s,{oneTimeOnly:!0}),r=document.createElement("a");r.target="_blank",r.href=u,document.body.appendChild(r),r.click()}catch(n){console.error("Error generando factura:",n),this.showSnackbar("Error al generar la factura","error")}finally{this.loading=!1}}}},y=a=>(Z("data-v-c09ad875"),a=a(),$(),a),le={class:"d-flex flex-column",style:{"min-width":"250px","flex-grow":"1"}},ie=y(()=>o("h2",{class:"text-h5 mb-1"},"Entregas Pendientes",-1)),oe={class:"text-caption text-medium-emphasis d-flex align-center"},ne=y(()=>o("span",{style:{"white-space":"normal"}}," Ordenes pendientes de entrega, puedes buscar por número de orden, cliente, estado de pago y fecha de entrega. ",-1)),de={class:"d-flex flex-wrap ga-2",style:{"flex-shrink":"0"}},ce={class:"d-flex align-center mx-0 px-0",style:{width:"100px"}},me={class:"d-flex flex-column text-start"},ue={class:"d-block font-weight-medium text-high-emphasis text-truncate"},he={class:"d-flex flex-column text-start"},pe={class:"d-block font-weight-medium text-high-emphasis text-truncate"},fe={class:"d-flex flex-column"},_e={class:"font-weight-medium",style:{width:"80px"}},ge={class:"text-disabled",style:{width:"80px"}},ye={key:0},xe={class:"text-right text-error"},ve={class:"text-right text-success"},be={class:"d-flex flex-column align-center gap-0"},Ce={class:"d-flex justify-center align-center gap-0 px-0 mx-0"},we={class:"bg-grey-lighten-4 font-weight-bold",style:{background:"#ccc"}},Se=["colspan"],ke={class:"d-flex align-center mx-0 px-0",style:{width:"100px"}},Pe={class:"d-flex flex-column text-start"},De={class:"d-block font-weight-medium text-high-emphasis text-truncate"},Re={key:0,class:"text-right"},Ve={key:1,class:"text-right"},Ee={class:"text-right"},Oe={class:"text-right"},Te=y(()=>o("td",{class:"text-right"},null,-1)),Fe=y(()=>o("td",{class:"text-right"},null,-1)),Ae=y(()=>o("td",{class:"text-right"},null,-1)),Ie=y(()=>o("span",null,"Detalles de la Orden",-1)),Ue={class:"d-flex flex-wrap gap-2 ml-3"},Ne={class:"d-flex flex-column"},ze={class:"text-caption text-medium-emphasis"},Le={class:"font-weight-medium"},Me={class:"d-flex flex-column"},Be={class:"text-caption text-medium-emphasis"},je={class:"font-weight-medium"},Ge={class:"d-flex flex-column"},He={class:"text-caption text-medium-emphasis"},qe={class:"font-weight-medium"},Ye=y(()=>o("small",{class:"text-caption"},"items",-1)),Je={class:"d-flex flex-column"},Ke={class:"text-caption text-medium-emphasis"},Qe={class:"font-weight-medium text-success"},We=y(()=>o("span",null,"Información del Cliente",-1)),Xe={class:"d-flex flex-column"},Ze={class:"text-caption text-medium-emphasis"},$e={class:"font-weight-medium"},et={class:"d-flex flex-column"},tt={class:"text-caption text-medium-emphasis"},st={class:"font-weight-medium"},at={class:"d-flex flex-column"},rt={class:"text-caption text-medium-emphasis"},lt={class:"font-weight-medium"},it={key:0,class:"text-primary text-caption"},ot={class:"d-flex flex-column gap-2"},nt={class:"d-flex justify-space-between"},dt=y(()=>o("span",{class:"text-caption text-medium-emphasis"},"Total Orden:",-1)),ct={class:"font-weight-medium"},mt={class:"d-flex justify-space-between"},ut=y(()=>o("span",{class:"text-caption text-medium-emphasis"},"Total Pagado:",-1)),ht={class:"font-weight-medium text-primary"},pt={class:"d-flex justify-space-between"},ft=y(()=>o("span",{class:"text-caption text-medium-emphasis"},"Saldo Pendiente:",-1)),_t={class:"d-flex justify-space-between"},gt=y(()=>o("span",{class:"text-caption text-medium-emphasis"},"Vuelto:",-1)),yt={class:"font-weight-medium text-success"},xt={class:"mt-4"};function vt(a,s,n,u,r,i){const p=Y,x=X("IconBtn"),J=Q;return _(),b(w,null,{default:t(()=>[e(F,{class:"d-flex flex-wrap align-center justify-space-between ga-2"},{default:t(()=>[o("div",le,[ie,o("div",oe,[e(h,{icon:"ri-information-line",size:"16",class:"mr-1"}),ne])]),o("div",de,[e(g,{color:"success",variant:"outlined",onClick:s[0]||(s[0]=l=>i.getDeliveryReport(3)),"prepend-icon":"ri-file-excel-line",size:"small"},{default:t(()=>[c(" Por Producto ")]),_:1}),e(g,{color:"error",variant:"outlined",onClick:s[1]||(s[1]=l=>i.getDeliveryReport(1)),"prepend-icon":"ri-file-pdf-2-line",size:"small"},{default:t(()=>[c(" Por Producto ")]),_:1}),e(g,{color:"error",variant:"outlined",onClick:s[2]||(s[2]=l=>i.getDeliveryReport(2)),"prepend-icon":"ri-file-pdf-2-line",size:"small"},{default:t(()=>[c(" Por Cliente ")]),_:1})])]),_:1}),e(S,{class:"d-flex px-2"},{default:t(()=>[e(te,{headers:i.showHeaders,items:r.orders.data||[],class:"text-no-wrap striped-table",loading:r.loading,"items-per-page":r.pagination.itemsPerPage,page:r.pagination.page,"items-length":r.orders.total||0,"onUpdate:options":i.handlePaginationChange},{top:t(()=>[e(w,{flat:"",color:"white"},{default:t(()=>[e(S,{class:"mx-0 px-0"},{default:t(()=>[e(R,{dense:"",class:"mx-0 px-0"},{default:t(()=>[e(f,{cols:"12",md:"1"},{default:t(()=>[e(se,{modelValue:r.search,"onUpdate:modelValue":s[3]||(s[3]=l=>r.search=l),label:"N° orden",placeholder:"Número de orden",density:"compact",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[e(V,{modelValue:r.selectedSeller,"onUpdate:modelValue":s[4]||(s[4]=l=>r.selectedSeller=l),items:r.sellers,"item-title":r.sellers.name?"name":"email","item-value":"id",label:"Vendedores",clearable:"",class:"mt-0",density:"compact"},null,8,["modelValue","items","item-title"])]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[e(V,{modelValue:r.selectedCustomer,"onUpdate:modelValue":[s[5]||(s[5]=l=>r.selectedCustomer=l),i.handleSelection],items:r.customers,"item-title":r.customers.firstname?"firstname":"address","item-value":"id",label:"Clientes",multiple:"",clearable:"",class:"mt-0",density:"compact",ref:"autocompleteRef"},null,8,["modelValue","items","item-title","onUpdate:modelValue"])]),_:1}),e(f,{cols:"12",md:"2"},{default:t(()=>[e(V,{modelValue:r.selectedPaymentStatus,"onUpdate:modelValue":s[6]||(s[6]=l=>r.selectedPaymentStatus=l),items:r.paymentStatuses,"item-title":"name","item-value":"id",label:"Estado pago",density:"compact",clearable:"","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[e(p,{ref:"dateDeliveryRange",modelValue:r.dateRange,"onUpdate:modelValue":s[7]||(s[7]=l=>r.dateRange=l),label:"Fecha entrega",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,{class:"justify-end"},{default:t(()=>[e(g,{variant:"outlined",color:"primary",onClick:i.reset},{default:t(()=>[c(" Reset ")]),_:1},8,["onClick"]),e(g,{variant:"outlined",color:"white",class:"bg-primary",onClick:s[8]||(s[8]=l=>{i.unsetInitialLoad(),i.fetchData()}),loading:r.loading},{default:t(()=>[c(" Buscar ")]),_:1},8,["loading"])]),_:1})]),_:1})]),"item.order_number":t(({item:l})=>[o("div",ce,[o("div",me,[o("span",ue,d(l.order_number),1),o("small",null,"Productos: "+d(l.quantity_products),1)])])]),"item.customer":t(({item:l})=>[o("div",he,[o("span",pe,d(l.customer.address),1),o("small",null,d(i.getCustomer(l.customer))+", "+d(l.customer.telephone),1)])]),"item.order_date":t(({item:l})=>[o("div",fe,[o("span",_e,d(i.formatDateGrid(l.order_date.split(" ")[0])),1),o("small",ge,d(l.order_date.split(" ")[1]||""),1)])]),"item.delivery_date":t(({item:l})=>[l.shipping&&l.delivery_date?(_(),v("div",ye,d(i.getDate(l.delivery_date)),1)):C("",!0)]),"item.total_cost":t(({item:l})=>[o("div",xe,[o("strong",null,d(i.formatCurrency(l.total_cost)),1)])]),"item.total_profit":t(({item:l})=>[o("div",ve,[o("strong",null,d(i.formatCurrency(l.total_profit)),1)])]),"item.total_amount":t(({item:l})=>[o("div",{class:D(l.total_profit>0?"text-right text-success":"text-right text-error")},[o("strong",null,d(i.formatCurrency(l.total_amount)),1)],2)]),"item.total_paid":t(({item:l})=>[o("div",{class:D(l.total_paid>0?l.total_paid<l.total_amount?"text-right text-warning":"text-right text-success":"text-right text-error")},[o("strong",null,d(i.formatCurrency(l.total_paid)),1)],2)]),"item.payment_status_id":t(({item:l})=>[o("div",be,[e(N,{"offset-y":""},{activator:t(({props:m})=>[e(P,O(m,{color:i.getStatusCodeColor(l.payment_status.code),"prepend-icon":"ri-money-dollar-circle-line",density:"comfortable",class:"my-1 status-chip",style:{width:"150px"}}),{default:t(()=>[c(d(l.payment_status.name)+" ",1),e(h,{icon:"ri-arrow-down-s-line",class:"ml-1"})]),_:2},1040,["color"])]),default:t(()=>[e(z,{density:"compact",class:"py-0"},{default:t(()=>[(_(!0),v(T,null,M(r.paymentStatuses,m=>(_(),b(k,{key:m.id,onClick:K=>i.updatePaymentStatus(l,m),class:"pa-0"},{default:t(()=>[e(P,{color:i.getStatusCodeColor(m.code),"prepend-icon":"ri-money-dollar-circle-line",density:"comfortable",class:D(["ma-1 status-option",`selected-status ${m.id===l.payment_status.id?"selected-status":""}`]),style:{width:"150px"}},{default:t(()=>[c(d(m.name)+" ",1),m.id===l.payment_status.id?(_(),b(h,{key:0,icon:"ri-check-line",class:"ml-1"})):C("",!0)]),_:2},1032,["color","class"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024),e(N,{"offset-y":""},{activator:t(({props:m})=>[e(P,O(m,{color:i.getStatusCodeColorShipping(l.shipment_status.code),"prepend-icon":"ri-truck-line",density:"comfortable",class:"my-1 status-chip",style:{width:"150px"}}),{default:t(()=>[c(d(l.shipment_status.name)+" ",1),e(h,{icon:"ri-arrow-down-s-line",class:"ml-1"})]),_:2},1040,["color"])]),default:t(()=>[e(z,{density:"compact",class:"py-0"},{default:t(()=>[(_(!0),v(T,null,M(r.shipmentStatuses,m=>(_(),b(k,{key:m.id,onClick:K=>i.updateShippingStatus(l,m),class:"pa-0"},{default:t(()=>[e(P,{color:i.getStatusCodeColorShipping(m.code),"prepend-icon":"ri-truck-line",density:"comfortable",class:D(["ma-1 status-option",`selected-status ${m.id===l.shipment_status.id?"selected-status":""}`]),style:{width:"150px"}},{default:t(()=>[c(d(m.name)+" ",1),m.id===l.shipment_status.id?(_(),b(h,{key:0,icon:"ri-check-line",class:"ml-1"})):C("",!0)]),_:2},1032,["color","class"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)])]),"item.actions":t(({item:l})=>[o("div",Ce,[e(N,{"offset-y":"",transition:"scale-transition"},{activator:t(({props:m})=>[e(x,O({size:"small"},m),{default:t(()=>[e(h,{icon:"ri-more-2-fill"})]),_:2},1040)]),default:t(()=>[e(z,null,{default:t(()=>[e(k,{onClick:m=>i.editOrder(l)},{default:t(()=>[e(E,null,{default:t(()=>[e(x,{size:"small",class:"my-1",title:"Editar"},{default:t(()=>[e(h,{icon:"ri-pencil-line"})]),_:1}),c("Editar ")]),_:1})]),_:2},1032,["onClick"]),e(k,{onClick:m=>i.showRemito(l)},{default:t(()=>[e(E,null,{default:t(()=>[e(x,{size:"small",class:"my-1",title:"Remito"},{default:t(()=>[e(h,{icon:"ri-file-pdf-2-line"})]),_:1}),c("Remito ")]),_:1})]),_:2},1032,["onClick"]),e(k,{onClick:m=>i.showRemitoComanda(l)},{default:t(()=>[e(E,null,{default:t(()=>[e(x,{size:"small",class:"my-1",title:"Comanda"},{default:t(()=>[e(h,{icon:"ri-file-pdf-2-line"})]),_:1}),c("Comanda ")]),_:1})]),_:2},1032,["onClick"]),e(k,{onClick:m=>i.openMovementDialog(l)},{default:t(()=>[e(E,null,{default:t(()=>[e(x,{size:"small",class:"my-1",title:"Cambiar el estado de la orden",onClick:m=>i.openMovementDialog(l)},{default:t(()=>[e(h,{icon:"ri-swap-box-line"})]),_:2},1032,["onClick"]),c("Cambiar estado ")]),_:2},1024)]),_:2},1032,["onClick"]),i.isPaid(l)?C("",!0):(_(),b(k,{key:0,onClick:m=>i.openPaymentForm(l)},{default:t(()=>[e(E,null,{default:t(()=>[e(x,{size:"small",class:"my-1",title:"Registrar Pago",onClick:m=>i.openPaymentForm(l)},{default:t(()=>[e(h,{icon:"ri-money-dollar-circle-line"})]),_:2},1032,["onClick"]),c("Registrar Pago ")]),_:2},1024)]),_:2},1032,["onClick"]))]),_:2},1024)]),_:2},1024)])]),tfoot:t(()=>[o("tfoot",null,[o("tr",we,[o("td",{colspan:i.showHeaders.length-(this.isAdmin?7:5),class:"text-right"},[o("div",ke,[o("div",Pe,[o("span",De,"Facturas Totales: "+d(r.orders.data.length),1),o("small",null,"Productos Totales: "+d(i.calculateTotalProducts()),1)])])],8,Se),this.isAdmin?(_(),v("td",Re,d(i.formatCurrency(i.calculateTotalCost())),1)):C("",!0),this.isAdmin?(_(),v("td",Ve,d(i.formatCurrency(i.calculateTotalProfit())),1)):C("",!0),o("td",Ee,d(i.formatCurrency(i.calculateTotalAmount())),1),o("td",Oe,d(i.formatCurrency(i.calculateTotalPaid())),1),Te,Fe,Ae])])]),_:1},8,["headers","items","loading","items-per-page","page","items-length","onUpdate:options"]),e(B,{modelValue:r.movementDialog,"onUpdate:modelValue":s[12]||(s[12]=l=>r.movementDialog=l),"max-width":"800px",persistent:""},{default:t(()=>[e(w,{class:"rounded-lg"},{default:t(()=>[e(j,{color:"primary",density:"compact"},{default:t(()=>[e(G,{class:"text-white font-weight-medium"},{default:t(()=>[e(g,{icon:"",variant:"text",color:"white",onClick:i.closeMovementDialog},{default:t(()=>[e(h,null,{default:t(()=>[c("ri-close-line")]),_:1})]),_:1},8,["onClick"]),c(" "+d(i.movementFormTitle),1)]),_:1})]),_:1}),e(H,{ref:"movementForm",modelValue:r.validMovement,"onUpdate:modelValue":s[11]||(s[11]=l=>r.validMovement=l)},{default:t(()=>[e(S,{class:"px-4 pt-4 pb-2"},{default:t(()=>[e(w,{flat:"",border:"",class:"mb-4",color:"primary-lighten-5"},{default:t(()=>[e(U,{class:"py-0 mt-2"},{default:t(()=>[e(F,{class:"d-flex align-center"},{default:t(()=>[e(L,{icon:"ri-inbox-unarchive-line",class:"text-info mr-2",variant:"tonal"}),Ie,o("div",Ue,[e(P,{color:i.getStatusCodeColor(r.selectedOrder.payment_status.code),size:"small",class:"font-weight-medium"},{default:t(()=>[e(h,{icon:"ri-money-dollar-circle-line",class:"mr-1"}),c(" "+d(r.selectedOrder.payment_status.name),1)]),_:1},8,["color"]),e(P,{color:i.getStatusCodeColorShipping(r.selectedOrder.shipment_status.code),size:"small",class:"font-weight-medium"},{default:t(()=>[e(h,{icon:"ri-truck-line",class:"mr-1"}),c(" "+d(r.selectedOrder.shipment_status.name),1)]),_:1},8,["color"])])]),_:1})]),_:1}),e(A,{class:"my-1"}),e(S,null,{default:t(()=>[e(R,{dense:""},{default:t(()=>[e(f,{cols:"6",sm:"3"},{default:t(()=>[o("div",Ne,[o("span",ze,[e(h,{icon:"ri-hashtag",size:"14",class:"mr-1"}),c(" Número ")]),o("span",Le,d(r.selectedOrder.order_number),1)])]),_:1}),e(f,{cols:"6",sm:"3"},{default:t(()=>[o("div",Me,[o("span",Be,[e(h,{icon:"ri-calendar-line",size:"14",class:"mr-1"}),c(" Fecha ")]),o("span",je,d(r.selectedOrder.order_date),1)])]),_:1}),e(f,{cols:"6",sm:"3"},{default:t(()=>[o("div",Ge,[o("span",He,[e(h,{icon:"ri-archive-line",size:"14",class:"mr-1"}),c(" Productos ")]),o("span",qe,[c(d(r.selectedOrder.quantity_products)+" ",1),Ye])])]),_:1}),e(f,{cols:"6",sm:"3"},{default:t(()=>[o("div",Je,[o("span",Ke,[e(h,{icon:"ri-money-dollar-circle-line",size:"14",class:"mr-1"}),c(" Total ")]),o("span",Qe,d(i.formatCurrency(r.selectedOrder.total_amount)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{flat:"",border:"",class:"mb-4",color:"grey-lighten-4"},{default:t(()=>[e(U,{class:"py-0 mt-2"},{default:t(()=>[e(F,{class:"d-flex align-center"},{default:t(()=>[e(L,{icon:"ri-user-line",class:"text-info mr-2",variant:"tonal"}),We]),_:1})]),_:1}),e(A,{class:"my-1"}),e(S,null,{default:t(()=>[e(R,{dense:""},{default:t(()=>[e(f,{cols:"12",md:"4"},{default:t(()=>[o("div",Xe,[o("span",Ze,[e(h,{icon:"ri-user-3-line",size:"14",class:"mr-1"}),c(" Nombre ")]),o("span",$e,d(r.selectedOrder.customer.firstname)+" "+d(r.selectedOrder.customer.lastname),1)])]),_:1}),e(f,{cols:"12",md:"4"},{default:t(()=>[o("div",et,[o("span",tt,[e(h,{icon:"ri-map-pin-line",size:"14",class:"mr-1"}),c(" Dirección ")]),o("span",st,d(r.selectedOrder.customer.address||"No especificada"),1)])]),_:1}),e(f,{cols:"12",md:"4"},{default:t(()=>[o("div",at,[o("span",rt,[e(h,{icon:"ri-phone-line",size:"14",class:"mr-1"}),c(" Contacto ")]),o("span",lt,d(r.selectedOrder.customer.telephone||"Sin teléfono"),1),r.selectedOrder.customer.email?(_(),v("span",it,[e(h,{icon:"ri-mail-line",size:"12",class:"mr-1"}),c(" "+d(r.selectedOrder.customer.email),1)])):C("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),e(R,null,{default:t(()=>[e(f,{cols:"12",md:"6",sm:"6"},{default:t(()=>[e(V,{modelValue:r.movement.payment_status_id,"onUpdate:modelValue":s[9]||(s[9]=l=>r.movement.payment_status_id=l),items:r.paymentStatuses,"item-title":"name","item-value":"id",label:"Estado del pago",rules:[i.validateStatusChange(r.movement.payment_status_id,1)],variant:"outlined",class:"mt-2",clearable:""},null,8,["modelValue","items","rules"])]),_:1}),e(f,{cols:"12",md:"6",sm:"6"},{default:t(()=>[e(V,{modelValue:r.movement.shipment_status_id,"onUpdate:modelValue":s[10]||(s[10]=l=>r.movement.shipment_status_id=l),items:r.shipmentStatuses,"item-title":"name","item-value":"id",label:"Estado de la entrega",rules:[i.validateStatusChange(r.movement.shipment_status_id,2)],variant:"outlined",class:"mt-2",clearable:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(q),e(g,{variant:"outlined",color:"primary",onClick:i.closeMovementDialog},{default:t(()=>[c(" Cancelar ")]),_:1},8,["onClick"]),e(g,{color:"white",class:"bg-primary",onClick:i.saveMovement,loading:r.savingMovement,disabled:!r.validMovement},{default:t(()=>[c(" Actualizar Estado ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(B,{modelValue:r.paymentFormDialog,"onUpdate:modelValue":s[14]||(s[14]=l=>r.paymentFormDialog=l),"max-width":"600px",persistent:""},{default:t(()=>[e(w,{class:"rounded-lg"},{default:t(()=>[e(j,{color:"primary",density:"compact",class:"ml-0 pl-0"},{default:t(()=>[e(G,{class:"text-h6 font-weight-medium text-white"},{default:t(()=>[e(g,{icon:"ri-close-line",color:"white",onClick:i.closePaymentForm},null,8,["onClick"]),c(" Registrar Pago ")]),_:1}),e(q),e(g,{icon:"",variant:"text",color:"white",onClick:i.closePaymentForm},{default:t(()=>[e(h,null,{default:t(()=>[c("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),e(H,{ref:"paymentForm",modelValue:r.validPayment,"onUpdate:modelValue":s[13]||(s[13]=l=>r.validPayment=l)},{default:t(()=>[e(S,{class:"px-4 pt-4 pb-2"},{default:t(()=>[e(w,{flat:"",class:"border",color:"surface"},{default:t(()=>[e(U,{class:"py-2"},{default:t(()=>[e(F,{class:"text-subtitle-1 font-weight-medium d-flex align-center"},{default:t(()=>[e(L,{icon:"ri-money-dollar-circle-line",class:"text-primary mr-2",variant:"tonal"}),c(" Resumen de Pagos ")]),_:1})]),_:1}),e(A),e(S,{class:"px-2 py-3"},{default:t(()=>{var l,m;return[o("div",ot,[o("div",nt,[dt,o("span",ct,d(i.formatCurrency((m=(l=r.createdOrder)==null?void 0:l.order)==null?void 0:m.total_amount)),1)]),o("div",mt,[ut,o("span",ht,d(i.formatCurrency(r.totalPaid)),1)]),o("div",pt,[ft,o("span",{class:D(["font-weight-medium",i.pendingAmount>0?"text-error":"text-success"])},d(i.formatCurrency(i.pendingAmount)),3)]),e(A,{class:"my-1"}),o("div",_t,[gt,o("span",yt,d(i.formatCurrency(r.change)),1)])])]}),_:1})]),_:1}),o("div",xt,[(_(),b(J,{ref:"paymentsRow",key:r.keyPayments,modulo:"pagos",records:r.createdOrder.order.payment,onUpdateTotal:i.updateTotal},null,8,["records","onUpdateTotal"]))])]),_:1}),e(I,{class:"px-4 pb-4 pt-2"},{default:t(()=>[e(R,null,{default:t(()=>[e(f,{cols:"12",md:"12",sm:"12",class:"pt-4 pb-0 my-0"},{default:t(()=>[e(g,{variant:"outlined",color:"primary",onClick:i.closePaymentForm,class:"text-capitalize",block:""},{default:t(()=>[c(" Cancelar ")]),_:1},8,["onClick"])]),_:1}),e(f,{cols:"12",md:"12",sm:"12",class:"pt-1 my-0 pb-2"},{default:t(()=>[e(g,{onClick:i.savePayment,loading:r.savingPayment,disabled:!r.validPayment,color:"white",class:"bg-primary text-capitalize",block:""},{default:t(()=>[r.savingPayment?(_(),v(T,{key:1},[c(" Procesando... ")],64)):(_(),v(T,{key:0},[e(h,{icon:"mdi-check-circle-outline",class:"mr-1"}),c(" Confirmar Pago ")],64))]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(ae,{modelValue:r.snackbar,"onUpdate:modelValue":s[16]||(s[16]=l=>r.snackbar=l),color:r.snackbarColor,timeout:3e3},{action:t(({attrs:l})=>[e(g,O({text:""},l,{onClick:s[15]||(s[15]=m=>r.snackbar=!1)}),{default:t(()=>[c(" Cerrar ")]),_:2},1040)]),default:t(()=>[c(d(r.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})]),_:1})}const Jt=ee(re,[["render",vt],["__scopeId","data-v-c09ad875"]]);export{Jt as default};

import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as A,V as H,d as ye}from"./VCard-oA43mCUQ.js";import{V as x}from"./VDataTable-DRwEG-Yj.js";import{a as $,V as h}from"./VRow-AVNT4Fjs.js";import{m as ve,a as Ve,u as Ie,V as ee,f as be,b as ke,c as Ce,d as S}from"./VTextField-14vKUckL.js";import{a as N,b as we,c as _e,V as Fe}from"./VSnackbar-DPbTtfJ-.js";import{e as j}from"./VChip-DvbpHd9I.js";import{V as Pe}from"./VDialog-Bm5tqQlv.js";import{K as $e,aw as Se,R as Le,U as Be,al as Ue,j as V,ax as te,r as E,s as ze,Y as De,an as Re,b as i,a0 as L,F as z,a8 as Ae,aq as He,v as Ne,o as d,e as k,w as l,au as Ee,k as ae,c as p,t as f,l as I,a as T,a3 as C,V as U,H as b}from"./main-6HS7PTJx.js";import{V as Te}from"./VForm-Ctfiwbxw.js";import{V as Me}from"./VContainer-BOcEkfQZ.js";import{f as je}from"./forwardRefs-C-GTDzx5.js";import{V as M}from"./VImg-CJi0y7Bu.js";import{V as Oe}from"./VSpacer-DwD1_B4m.js";import{V as qe}from"./VSwitch-BrI_Z2K3.js";import"./VAvatar-Dnt_eiFM.js";import"./VOverlay-VWEB6O8i.js";import"./easing-DY7PVvcf.js";import"./lazy-DPeCttaz.js";import"./VCheckboxBtn-DLKPEDuX.js";import"./VTable-CvnvDvK2.js";import"./VDivider-BWGTVc8_.js";import"./index-BIA3VFyu.js";import"./ssrBoot-X87m8hUn.js";const We=$e({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,showSize:{type:[Boolean,Number],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(e)},...ve({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:e=>Se(e).every(a=>a!=null&&typeof a=="object")},...Ve({clearable:!0})},"VFileInput"),Ge=Le()({name:"VFileInput",inheritAttrs:!1,props:We(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,a){let{attrs:s,emit:g,slots:m}=a;const{t:o}=Be(),u=Ue(e,"modelValue"),{isFocused:t,focus:n,blur:w}=Ie(e),O=V(()=>typeof e.showSize!="boolean"?e.showSize:void 0),q=V(()=>(u.value??[]).reduce((r,c)=>{let{size:_=0}=c;return r+_},0)),W=V(()=>te(q.value,O.value)),D=V(()=>(u.value??[]).map(r=>{const{name:c="",size:_=0}=r;return e.showSize?`${c} (${te(_,O.value)})`:c})),ie=V(()=>{var c;const r=((c=u.value)==null?void 0:c.length)??0;return e.showSize?o(e.counterSizeString,r,W.value):o(e.counterString,r)}),G=E(),J=E(),v=E(),le=V(()=>t.value||e.active),K=V(()=>["plain","underlined"].includes(e.variant));function R(){var r;v.value!==document.activeElement&&((r=v.value)==null||r.focus()),t.value||n()}function se(r){Y(r)}function re(r){g("mousedown:control",r)}function Y(r){var c;(c=v.value)==null||c.click(),g("click:control",r)}function oe(r){r.stopPropagation(),R(),Ae(()=>{u.value=[],He(e["onClick:clear"],r)})}return ze(u,r=>{(!Array.isArray(r)||!r.length)&&v.value&&(v.value.value="")}),De(()=>{const r=!!(m.counter||e.counter),c=!!(r||m.details),[_,de]=Re(s),{modelValue:rt,...ne}=ee.filterProps(e),ue=be(e);return i(ee,L({ref:G,modelValue:u.value,"onUpdate:modelValue":F=>u.value=F,class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-input--plain-underlined":K.value},e.class],style:e.style,"onClick:prepend":se},_,ne,{centerAffix:!K.value,focused:t.value}),{...m,default:F=>{let{id:B,isDisabled:P,isDirty:Q,isReadonly:X,isValid:ce}=F;return i(ke,L({ref:J,"prepend-icon":e.prependIcon,onMousedown:re,onClick:Y,"onClick:clear":oe,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},ue,{id:B.value,active:le.value||Q.value,dirty:Q.value,disabled:P.value,focused:t.value,error:ce.value===!1}),{...m,default:me=>{var Z;let{props:{class:pe,...fe}}=me;return i(z,null,[i("input",L({ref:v,type:"file",readonly:X.value,disabled:P.value,multiple:e.multiple,name:e.name,onClick:y=>{y.stopPropagation(),X.value&&y.preventDefault(),R()},onChange:y=>{if(!y.target)return;const he=y.target;u.value=[...he.files??[]]},onFocus:R,onBlur:w},fe,de),null),i("div",{class:pe},[!!((Z=u.value)!=null&&Z.length)&&(m.selection?m.selection({fileNames:D.value,totalBytes:q.value,totalBytesReadable:W.value}):e.chips?D.value.map(y=>i(j,{key:y,size:"small",color:e.color},{default:()=>[y]})):D.value.join(", "))])])}})},details:c?F=>{var B,P;return i(z,null,[(B=m.details)==null?void 0:B.call(m,F),r&&i(z,null,[i("span",null,null),i(Ce,{active:!!((P=u.value)!=null&&P.length),value:ie.value},m.counter)])])}:void 0})}),je({},G,J,v)}}),Je={data:()=>({title:"Productos",route:"products",dialog:!1,snackbar:!1,text:"Registro Insertado",color:"success",timeout:4e3,search:"",imagePreview:"",valid:!0,headers:[],desserts:[],categories:[],brands:[],priceLists:[],editedIndex:-1,vista:!1,editedItem:{id:"",name:"",code:"",category_id:null,brand_id:null,purchase_price:"",sale_price:"",image:"",imageFiles:[],active:1,price_lists:{}},defaultItem:{id:"",name:"",code:"",category_id:null,brand_id:null,purchase_price:"",sale_price:"",image:"",imageFiles:[],active:1,price_lists:{}},selectedHeaders:[],priceListHeaders:[{title:"Lista de Precios",key:"name",sortable:!1},{title:"Precio de Venta",key:"sale_price",sortable:!1,width:"200px"}]}),computed:{priceListsWithPrices(){return this.priceLists.map(e=>({...e,sale_price:this.editedItem.price_lists[e.id]||0}))},formTitle(){return this.editedIndex===-1?"Registrar Producto":"Editar Producto"},showHeaders(){return this.headers.filter(e=>this.selectedHeaders.includes(e))},filteredDesserts(){if(!this.search)return this.desserts;const e=this.search.toLowerCase();return this.desserts.filter(a=>{var s;return a.name.toLowerCase().includes(e)||((s=a.code)==null?void 0:s.toLowerCase().includes(e))})}},created(){this.$initialize(),this.loadInitialData()},watch:{dialog(e){e||this.closeDialog()}},methods:{getImageInputValue(){return this.editedItem.imageFiles&&this.editedItem.imageFiles.length>0?this.editedItem.imageFiles:this.editedItem.image?[new File([],this.getImageName(),{type:"image/*"})]:[]},getImageName(){if(!this.editedItem.image)return"";const e=this.editedItem.image.split("/");return e.length>0?e.pop():""},async loadCategories(){try{const e=await this.$axios.get(this.$routes.categories);this.categories=e.data.data}catch(e){console.error("Error cargando categorías:",e)}finally{}},async loadBrands(){try{const e=await this.$axios.get(this.$routes.brands);this.brands=e.data.data}catch(e){console.error("Error cargando marcas:",e)}},async loadInitialData(){await this.loadPriceLists(),this.buildHeaders(),this.selectedHeaders=this.headers,this.loadCategories(),this.loadBrands(),this.$initialize()},buildHeaders(){const e=this.priceLists.map(s=>({title:`Lista ${s.name}`,key:`price_list_${s.id}`,sortable:!1})),a=[{title:"Acciones",key:"actions",value:"actions",sortable:!1,width:"150px"},{title:"Cód.",filterable:!0,key:"code",width:"50px",class:"column-code"},{title:"Nombre",filterable:!0,key:"name"},{title:"Imagen",key:"image",sortable:!1}];(this.$is("superadmin")||this.$is("bebidas-admin")||this.$is("petshop-admin"))&&a.push({title:"Precio Compra",key:"purchase_price"}),this.headers=[...a,...e,{title:"Estado",key:"active",width:"150px"}]},async loadPriceLists(){try{const e=await this.$axios.get(this.$routes.priceLists);this.priceLists=e.data.data}catch(e){console.error("Error loading price lists:",e)}},async editItem(e){this.editedIndex=e;try{const s=(await this.$axios.get(`api/${this.route}/${e}`)).data.data;this.editedItem.price_lists={},s.price_lists.length>0&&s.price_lists.forEach(g=>{this.editedItem.price_lists[g.id]=g.pivot.sale_price}),Object.assign(this.editedItem,{id:s.id,name:s.name,code:s.code,category_id:s.category_id,brand_id:s.brand_id,purchase_price:s.purchase_price,sale_price:s.sale_price,image:s.image,imageFiles:[],active:s.active}),this.priceLists.forEach(g=>{this.editedItem.price_lists[g.id]||(this.editedItem.price_lists[g.id]=null)}),this.imagePreview=null,this.dialog=!0}catch(a){console.error("Error al editar:",a)}},async saveProduct(){try{const e=new FormData;for(const a in this.editedItem)this.editedItem[a]!==null&&this.editedItem[a]!==""&&(a==="price_lists"?e.append(a,JSON.stringify(this.editedItem[a])):a==="imageFiles"&&this.editedItem.imageFiles[0]?e.append("image",this.editedItem.imageFiles[0]):a!=="id"&&a!=="image"&&a!=="imageFiles"&&e.append(a,this.editedItem[a]));this.editedItem.id?(e.append("_method","PUT"),await this.$axios.post(`api/${this.route}/${this.editedItem.id}`,e)):await this.$axios.post(`api/${this.route}`,e),this.closeDialog(),this.$initialize(),this.showSnackbar("Registro guardado con éxito.")}catch(e){console.error("Error al guardar:",e),this.showSnackbar("Error al guardar el registro.","error")}},closeDialog(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1,this.imagePreview=""})},getSalePriceForDefaultList(e){const a=e.price_lists.find(s=>s.is_default);return a?a.pivot.sale_price:e.sale_price},formatCurrency(e){return e?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0"},handleImageUpload(e){var s;const a=(s=e.target.files)==null?void 0:s[0];this.imagePreview=a?URL.createObjectURL(a):""},clearImage(){this.editedItem.image="",this.editedItem.imageFiles=[],this.imagePreview=""},showSnackbar(e,a="success"){this.text=e,this.color=a,this.snackbar=!0},filterDessertName(e){return e.name.toLowerCase().includes(this.dessertName.toLowerCase())},filterByName(e){return this.$filterBy(e,"name")},filterByActive(e){return this.$filterBy(e,"active")}}},Ke={key:1,class:"grey--text caption"},Ye={key:0},Qe={key:1},Xe={key:1},Ze={key:0},xe={key:1},et={key:0},tt={key:0},at={key:1},it={class:"d-flex flex-wrap gap-1 align-center",style:{"min-width":"120px"}},lt=["innerHTML"];function st(e,a,s,g,m,o){const u=Ne("IconBtn");return d(),k(A,{title:"Administración de "+e.title},{default:l(()=>[i(H,{class:"d-flex px-2"},{default:l(()=>[i(x,{headers:o.showHeaders,items:o.filteredDesserts,search:e.search,class:"text-no-wrap striped-table"},Ee({top:l(()=>[i(A,{flat:"",color:"white"},{default:l(()=>[i(H,null,{default:l(()=>[i($,null,{default:l(()=>[i(h,{sm:"4",class:"pl-0 pt-20 py-2"},{default:l(()=>[i(S,{modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=t=>e.search=t),"append-icon":"ri-search-line",label:"Busqueda de "+e.title},null,8,["modelValue","label"])]),_:1}),i(h,{sm:"4",class:"pt-20 py-2"},{default:l(()=>[i(N,{modelValue:e.selectedHeaders,"onUpdate:modelValue":a[1]||(a[1]=t=>e.selectedHeaders=t),items:e.headers,label:"Columnas Visibles",multiple:"","return-object":""},{selection:l(({item:t,index:n})=>[n<2?(d(),k(j,{key:0},{default:l(()=>[T("span",null,f(t.title),1)]),_:2},1024)):I("",!0),n===2?(d(),p("span",Ke," (otras "+f(e.selectedHeaders.length-2)+"+) ",1)):I("",!0)]),_:1},8,["modelValue","items"])]),_:1}),i(h,{sm:"1",class:"pt-20 py-2"},{default:l(()=>[i(Pe,{modelValue:e.dialog,"onUpdate:modelValue":a[11]||(a[11]=t=>e.dialog=t),"max-width":"50%"},{activator:l(({props:t})=>[i(C,L(t,{color:e.$cv("principal"),size:"x-large",title:"Registrar "+e.title,onClick:e.openDialog}),{default:l(()=>[i(U,{size:"large",icon:"ri-add-circle-line"})]),_:2},1040,["color","title","onClick"])]),default:l(()=>[i(A,null,{default:l(()=>[i(we,{color:e.$cv("principal")},{default:l(()=>[i(C,{icon:"ri-close-line",color:"white",onClick:a[2]||(a[2]=t=>e.dialog=!1)}),i(_e,null,{default:l(()=>[b(f(o.formTitle),1)]),_:1})]),_:1},8,["color"]),i(Te,{ref:"form",modelValue:e.valid,"onUpdate:modelValue":a[9]||(a[9]=t=>e.valid=t)},{default:l(()=>[i(H,null,{default:l(()=>[i(Me,{class:"py-0 my-0"},{default:l(()=>[i($,{class:"py-0 my-0"},{default:l(()=>[i(h,{cols:"12",sm:"6"},{default:l(()=>[i(S,{modelValue:e.editedItem.name,"onUpdate:modelValue":a[3]||(a[3]=t=>e.editedItem.name=t),label:"Nombre",required:"",density:"compact"},null,8,["modelValue"])]),_:1}),i(h,{cols:"12",sm:"6"},{default:l(()=>[i(S,{modelValue:e.editedItem.code,"onUpdate:modelValue":a[4]||(a[4]=t=>e.editedItem.code=t),label:"Código",density:"compact"},null,8,["modelValue"])]),_:1}),i(h,{cols:"12",sm:"6"},{default:l(()=>[i(N,{modelValue:e.editedItem.category_id,"onUpdate:modelValue":a[5]||(a[5]=t=>e.editedItem.category_id=t),items:e.categories,"item-title":"name","item-value":"id",label:"Categoría",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),i(h,{cols:"12",sm:"6"},{default:l(()=>[i(N,{modelValue:e.editedItem.brand_id,"onUpdate:modelValue":a[6]||(a[6]=t=>e.editedItem.brand_id=t),items:e.brands,"item-title":"name","item-value":"id",label:"Marca",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),i($,{class:"py-0 my-0"},{default:l(()=>[i(h,{cols:"12",sm:"12"},{default:l(()=>[i(S,{modelValue:e.editedItem.purchase_price,"onUpdate:modelValue":a[7]||(a[7]=t=>e.editedItem.purchase_price=t),modelModifiers:{number:!0},label:"Precio de Compra",type:"number",density:"compact",prefix:"$"},null,8,["modelValue"])]),_:1})]),_:1}),i($,{class:"py-0 my-0"},{default:l(()=>[i(h,{cols:"12"},{default:l(()=>[i(x,{headers:e.priceListHeaders,items:o.priceListsWithPrices,"hide-default-footer":!0,class:"elevation-1"},{"item.name":l(({item:t})=>[b(f(t.name),1)]),"item.sale_price":l(({item:t})=>[i(S,{modelValue:e.editedItem.price_lists[t.id],"onUpdate:modelValue":n=>e.editedItem.price_lists[t.id]=n,modelModifiers:{number:!0},label:"Precio",type:"number",density:"compact",prefix:"$","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),bottom:l(()=>[]),_:1},8,["headers","items"])]),_:1})]),_:1}),i($,null,{default:l(()=>[i(h,{cols:"12"},{default:l(()=>[i(Ge,{modelValue:e.editedItem.imageFiles,"onUpdate:modelValue":a[8]||(a[8]=t=>e.editedItem.imageFiles=t),label:"Imagen del Producto","prepend-icon":"ri-image-line",accept:"image/*",onChange:o.handleImageUpload,clearable:!0,"show-size":!0,"truncate-length":15,"model-value":o.getImageInputValue(),density:"compact"},{selection:l(({file:t})=>[t?(d(),p("span",Ye,f(t.name),1)):e.editedItem.image?(d(),p("span",Qe,f(o.getImageName()),1)):I("",!0)]),_:1},8,["modelValue","onChange","model-value"]),e.editedItem.image&&typeof e.editedItem.image=="string"?(d(),k(C,{key:0,color:"error",size:"x-large",onClick:o.clearImage,class:"mt-2"},{default:l(()=>[i(U,{icon:"ri-delete-bin-line",class:"mr-1"})]),_:1},8,["onClick"])):I("",!0),e.imagePreview?(d(),k(M,{key:1,src:e.imagePreview,"max-height":"150",contain:"",class:"mt-2"},null,8,["src"])):I("",!0),e.editedItem.image?(d(),k(M,{key:2,src:"storage/products/"+e.editedItem.image,"max-height":"150",contain:"",class:"mt-2"},null,8,["src"])):I("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(ye,null,{default:l(()=>[i(Oe),i(C,{text:"",onClick:a[10]||(a[10]=t=>e.dialog=!1)},{default:l(()=>[b("Cancelar")]),_:1}),i(C,{class:"bg-primary",color:"white",onClick:o.saveProduct},{default:l(()=>[b("Guardar")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),"item.image":l(({item:t})=>[t.image?(d(),k(M,{key:0,src:"/storage/products/"+t.image,"max-height":"50","max-width":"50",contain:""},null,8,["src"])):(d(),p("span",Xe))]),"item.purchase_price":l(({item:t})=>[b(f(o.formatCurrency(t.purchase_price)),1)]),"item.sale_price":l(({item:t})=>[t.price_lists&&t.price_lists.length>0?(d(),p("span",Ze,f(o.formatCurrency(o.getSalePriceForDefaultList(t))),1)):(d(),p("span",xe,f(o.formatCurrency(t.sale_price)),1))]),"item.active":l(({item:t})=>[i(j,{color:e.$resolveStatusVariant(t.active).color,density:"comfortable"},{default:l(()=>[b(f(e.$resolveStatusVariant(t.active).text),1)]),_:2},1032,["color"])]),"item.actions":l(({item:t})=>[T("div",it,[i(u,{size:"small",class:"my-1",title:"Editar",onClick:n=>o.editItem(t.id)},{default:l(()=>[i(U,{icon:"ri-pencil-line"})]),_:2},1032,["onClick"]),i(qe,{modelValue:t.active,"onUpdate:modelValue":n=>t.active=n,"true-value":1,"false-value":0,color:"primary","hide-details":"",title:"Activar o Inactivar",onClick:n=>e.$toggleActive(t)},null,8,["modelValue","onUpdate:modelValue","onClick"]),i(u,{size:"small",title:"Eliminar",class:"my-1",onClick:n=>e.deleteItem(t.id,t.name)},{default:l(()=>[i(U,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])])]),_:2},[ae(e.priceLists,t=>({name:`item.price_list_${t.id}`,fn:l(({item:n})=>[n.price_lists&&n.price_lists.length>0?(d(),p("span",et,[(d(!0),p(z,null,ae(n.price_lists,w=>(d(),p("span",{key:w.id},[w.id===t.id?(d(),p("span",tt,f(o.formatCurrency(w.pivot.sale_price)),1)):I("",!0)]))),128))])):(d(),p("span",at," $0.00 "))])}))]),1032,["headers","items","search"]),i(Fe,{modelValue:e.snackbar,"onUpdate:modelValue":a[13]||(a[13]=t=>e.snackbar=t),bottom:!0,color:e.color,timeout:e.timeout},{action:l(({attrs:t})=>[i(C,L({dark:"",text:""},t,{onClick:a[12]||(a[12]=n=>e.snackbar=!1)}),{default:l(()=>[b("Cerrar")]),_:2},1040)]),default:l(()=>[T("div",{innerHTML:e.text},null,8,lt)]),_:1},8,["modelValue","color","timeout"])]),_:1})]),_:1},8,["title"])}const Bt=ge(Je,[["render",st]]);export{Bt as default};

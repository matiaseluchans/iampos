import{r as _,j as E,an as S,ap as U,s as J,o as $,e as B,w as a,b as e,H as T,t as k,a2 as q,V as F,ao as oe,u as L,a as D,G as ie,v as ue,l as K,c as Q,$ as ce}from"./main-DOucTeTc.js";import{a as j,V as O,d as ne}from"./VCard-BZ4rU-iA.js";import{b as de,c as pe,a as me,V as ve}from"./VSnackbar-DomS3EVk.js";import{V as W}from"./VSpacer-DRVxq8PH.js";import{V as fe}from"./VForm-C4sJc7XK.js";import{a as Y,V as x}from"./VRow-Ir3wg7QB.js";import{V as P}from"./VTextField-2ruvtwyY.js";import{V as ye}from"./VTextarea-BEcfH4C2.js";import{V as Z}from"./VSwitch-BA0jDN5K.js";import{V as X}from"./VAlert-Dspz5fOI.js";import{V as _e}from"./VDialog-BEsC9W0L.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as he}from"./VDataTable-DpdSlkcl.js";import{V as Te}from"./filter-FbS_J5vu.js";import{e as H}from"./VChip-Dd9kPkn6.js";import"./VAvatar-CfLGKvOU.js";import"./VImg-CfnnTD9W.js";import"./forwardRefs-C-GTDzx5.js";import"./VCheckboxBtn-BC80PW81.js";import"./index-D5A_Hox7.js";import"./VOverlay-Ejijsbhx.js";import"./easing-DY7PVvcf.js";import"./lazy-DBukmiYt.js";import"./VTable-ivgGpSdg.js";import"./VDivider-ChX3vsGx.js";import"./ssrBoot-BIumrUOr.js";function ee(){const m=_([]),V=_(null),s=_(!1),n=_(null),z=async(i={})=>{var d,u;s.value=!0,n.value=null;try{const r=await S.get(U.resourceTypes,{params:i});return m.value=r.data.data||r.data,m.value}catch(r){throw n.value=((u=(d=r.response)==null?void 0:d.data)==null?void 0:u.message)||"Error al cargar los tipos de recurso",r}finally{s.value=!1}},N=async i=>{var d,u;s.value=!0,n.value=null;try{const r=await S.get(`${U.resourceTypes}/${i}`);return V.value=r.data.data||r.data,V.value}catch(r){throw n.value=((u=(d=r.response)==null?void 0:d.data)==null?void 0:u.message)||"Error al cargar el tipo de recurso",r}finally{s.value=!1}},M=async i=>{var d,u;s.value=!0,n.value=null;try{const r=await S.post(U.resourceTypes,i),f=r.data.data||r.data;return m.value.push(f),f}catch(r){throw n.value=((u=(d=r.response)==null?void 0:d.data)==null?void 0:u.message)||"Error al crear el tipo de recurso",r}finally{s.value=!1}},I=async(i,d)=>{var u,r;s.value=!0,n.value=null;try{const f=await S.put(`${U.resourceTypes}/${i}`,d),c=f.data.data||f.data,p=m.value.findIndex(h=>h.id===i);return p!==-1&&(m.value[p]=c),V.value&&V.value.id===i&&(V.value=c),c}catch(f){throw n.value=((r=(u=f.response)==null?void 0:u.data)==null?void 0:r.message)||"Error al actualizar el tipo de recurso",f}finally{s.value=!1}},o=async i=>{var d,u;s.value=!0,n.value=null;try{return await S.delete(`${U.resourceTypes}/${i}`),m.value=m.value.filter(r=>r.id!==i),V.value&&V.value.id===i&&(V.value=null),!0}catch(r){throw n.value=((u=(d=r.response)==null?void 0:d.data)==null?void 0:u.message)||"Error al eliminar el tipo de recurso",r}finally{s.value=!1}},y=async i=>{var d,u;s.value=!0,n.value=null;try{const r=await S.patch(`${U.resourceTypes}/${i}/soft-delete`),f=r.data.data||r.data,c=m.value.findIndex(p=>p.id===i);return c!==-1&&(m.value[c]=f),f}catch(r){throw n.value=((u=(d=r.response)==null?void 0:d.data)==null?void 0:u.message)||"Error al eliminar el tipo de recurso",r}finally{s.value=!1}},C=async i=>{var d,u;s.value=!0,n.value=null;try{const r=await S.patch(`${U.resourceTypes}/${i}/restore`),f=r.data.data||r.data;return m.value.push(f),f}catch(r){throw n.value=((u=(d=r.response)==null?void 0:d.data)==null?void 0:u.message)||"Error al restaurar el tipo de recurso",r}finally{s.value=!1}},w=E(()=>m.value.filter(i=>!i.deleted_at)),b=E(()=>m.value.filter(i=>i.deleted_at));return{resourceTypes:m,resourceType:V,loading:s,error:n,activeResourceTypes:w,deletedResourceTypes:b,fetchResourceTypes:z,fetchResourceType:N,createResourceType:M,updateResourceType:I,deleteResourceType:o,softDeleteResourceType:y,restoreResourceType:C,reset:()=>{m.value=[],V.value=null,n.value=null,s.value=!1}}}const ge=D("div",{class:"text-caption"},[D("strong",null,"Capacidad Compartida:"),T(" Múltiples reservas pueden usar el mismo recurso simultáneamente, compartiendo la capacidad total disponible. ")],-1),xe=D("div",{class:"text-caption"},[D("strong",null,"Capacidad Individual:"),T(" Cada recurso solo puede ser usado por una reserva a la vez. ")],-1),Ce={__name:"ResourceTypeForm",props:{modelValue:{type:Boolean,default:!1},resourceType:{type:Object,default:null},mode:{type:String,default:"create",validator:m=>["create","edit"].includes(m)}},emits:["update:modelValue","saved","cancel"],setup(m,{emit:V}){const s=m,n=V,{createResourceType:z,updateResourceType:N,loading:M,error:I}=ee(),o=_({name:"",description:"",is_shared_capacity:!1,max_capacity_per_reservation:null}),y=_({}),C=_(null),w={required:c=>!!c||"Este campo es requerido"},b=E({get:()=>s.modelValue,set:c=>n("update:modelValue",c)}),g=E(()=>o.value.name&&o.value.name.trim()!==""),i=E(()=>o.value.is_shared_capacity?"Múltiples reservas pueden compartir el mismo recurso":"Cada recurso es exclusivo para una reserva"),d=E(()=>o.value.is_shared_capacity?o.value.max_capacity_per_reservation?`Máximo ${o.value.max_capacity_per_reservation} participantes por reserva`:"Sin límite de capacidad por reserva":"Para capacidad individual, este campo generalmente es 1");J(()=>s.resourceType,c=>{c?o.value={name:c.name||"",description:c.description||"",is_shared_capacity:c.is_shared_capacity||!1,max_capacity_per_reservation:c.max_capacity_per_reservation||null}:u()}),J(()=>s.modelValue,c=>{c&&s.resourceType?o.value={name:s.resourceType.name||"",description:s.resourceType.description||"",is_shared_capacity:s.resourceType.is_shared_capacity||!1,max_capacity_per_reservation:s.resourceType.max_capacity_per_reservation||null}:c||u()});const u=()=>{o.value={name:"",description:"",is_shared_capacity:!1,max_capacity_per_reservation:null},y.value={}},r=()=>{b.value=!1,n("cancel")},f=async()=>{var c;if(g.value){y.value={};try{const p={...o.value,max_capacity_per_reservation:o.value.max_capacity_per_reservation?parseInt(o.value.max_capacity_per_reservation):null};s.mode==="create"?await z(p):await N(s.resourceType.id,p),n("saved"),r()}catch(p){((c=p.response)==null?void 0:c.status)===422?y.value=p.response.data.errors||{}:y.value.general=[I.value||"Error al guardar el tipo de recurso"]}}};return(c,p)=>($(),B(_e,{modelValue:b.value,"onUpdate:modelValue":p[4]||(p[4]=h=>b.value=h),"max-width":"600",persistent:""},{default:a(()=>[e(j,null,{default:a(()=>[e(de,{color:m.mode==="create"?"primary":"secondary",density:"compact"},{default:a(()=>[e(pe,{class:"text-white"},{default:a(()=>[T(k(m.mode==="create"?"Nuevo Tipo de Recurso":"Editar Tipo de Recurso"),1)]),_:1}),e(W),e(q,{icon:"",color:"white",onClick:r},{default:a(()=>[e(F,null,{default:a(()=>[T("ri-close-line")]),_:1})]),_:1})]),_:1},8,["color"]),e(O,{class:"pt-4"},{default:a(()=>[e(fe,{onSubmit:oe(f,["prevent"]),ref_key:"formRef",ref:C},{default:a(()=>[e(Y,null,{default:a(()=>[e(x,{cols:"12"},{default:a(()=>[e(P,{modelValue:o.value.name,"onUpdate:modelValue":p[0]||(p[0]=h=>o.value.name=h),label:"Nombre *",variant:"outlined",rules:[w.required],"error-messages":y.value.name},null,8,["modelValue","rules","error-messages"])]),_:1}),e(x,{cols:"12"},{default:a(()=>[e(ye,{modelValue:o.value.description,"onUpdate:modelValue":p[1]||(p[1]=h=>o.value.description=h),label:"Descripción",variant:"outlined",rows:"3","error-messages":y.value.description},null,8,["modelValue","error-messages"])]),_:1}),e(x,{cols:"12",md:"6"},{default:a(()=>[e(Z,{modelValue:o.value.is_shared_capacity,"onUpdate:modelValue":p[2]||(p[2]=h=>o.value.is_shared_capacity=h),label:"Capacidad Compartida",color:"primary",messages:i.value,"hide-details":""},null,8,["modelValue","messages"])]),_:1}),e(x,{cols:"12",md:"6"},{default:a(()=>[e(P,{modelValue:o.value.max_capacity_per_reservation,"onUpdate:modelValue":p[3]||(p[3]=h=>o.value.max_capacity_per_reservation=h),label:"Capacidad Máxima por Reserva",type:"number",variant:"outlined",min:1,hint:d.value,"persistent-hint":"","error-messages":y.value.max_capacity_per_reservation},null,8,["modelValue","hint","error-messages"])]),_:1}),o.value.is_shared_capacity?($(),B(x,{key:0,cols:"12"},{default:a(()=>[e(X,{type:"info",variant:"tonal",density:"compact"},{default:a(()=>[ge]),_:1})]),_:1})):($(),B(x,{key:1,cols:"12"},{default:a(()=>[e(X,{type:"info",variant:"tonal",density:"compact"},{default:a(()=>[xe]),_:1})]),_:1}))]),_:1}),e(ne,{class:"px-0"},{default:a(()=>[e(W),e(q,{variant:"outlined",onClick:r,disabled:L(M)},{default:a(()=>[T(" Cancelar ")]),_:1},8,["disabled"]),e(q,{color:"primary",type:"submit",loading:L(M),disabled:!g.value},{default:a(()=>[T(k(m.mode==="create"?"Crear":"Actualizar"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},be={key:1,class:"grey--text caption"},we={key:1,class:"text-disabled"},Re={class:"d-flex flex-wrap gap-1 align-center",style:{"min-width":"120px"}},ke=["innerHTML"],$e={__name:"ResourceTypeList",setup(m){const{resourceTypes:V,loading:s,error:n,fetchResourceTypes:z,updateResourceType:N,deleteResourceType:M}=ee(),I=_(""),o=_(null),y=_(!1),C=_([]),w=_("create"),b=_(null),g=_({show:!1,message:"",color:"success"}),i=_([{title:"Acciones",key:"actions",sortable:!1},{title:"Nombre",key:"name"},{title:"Descripción",key:"description"},{title:"Tipo Capacidad",key:"is_shared_capacity"},{title:"Capacidad Máx.",key:"max_capacity_per_reservation"},{title:"Recursos",key:"resources_count"},{title:"Estado",key:"active"}]);C.value=[...i.value];const d=_([{title:"Capacidad Compartida",value:!0},{title:"Capacidad Individual",value:!1}]),u=E(()=>C.value),r=E(()=>{let l=V.value;return o.value!==null&&(l=l.filter(v=>v.is_shared_capacity===o.value)),l}),f=async()=>{try{await z({include:"resources_count"})}catch{A("Error al cargar los tipos de recurso","error")}},c=()=>{b.value=null,w.value="create",y.value=!0},p=l=>{b.value={...l},w.value="edit",y.value=!0},h=async l=>{if(confirm(`¿Está seguro que desea eliminar el tipo de recurso "${l.name}"?${l.resources_count>0?`

Este tipo de recurso tiene ${l.resources_count} recursos asociados.`:""}`))try{await M(l.id),A("Tipo de recurso eliminado exitosamente","success")}catch{A(n.value||"Error al eliminar el tipo de recurso","error")}},ae=async l=>{try{const v=await N(l.id,{...l,active:l.active});A(`Tipo de recurso ${l.active?"activado":"inactivado"} exitosamente`,"success")}catch{l.active=!l.active,A(n.value||"Error al cambiar el estado","error")}},re=()=>{y.value=!1,f(),A(w.value==="create"?"Tipo de recurso creado exitosamente":"Tipo de recurso actualizado exitosamente","success")},te=l=>l?"success":"info",le=l=>l.deleted_at?"error":l.active?"success":"warning",se=l=>l.deleted_at?"Eliminado":l.active?"Activo":"Inactivo",A=(l,v="success")=>{g.value={show:!0,message:l,color:v}};return ie(()=>{f()}),(l,v)=>{const G=ue("IconBtn");return $(),B(j,{title:"Administración de Tipos de Recurso"},{default:a(()=>[e(O,{class:"d-flex px-2"},{default:a(()=>[e(he,{headers:u.value,items:r.value,search:I.value,loading:L(s),class:"text-no-wrap striped-table"},{top:a(()=>[e(j,{flat:"",color:"white"},{default:a(()=>[e(O,null,{default:a(()=>[e(Y,null,{default:a(()=>[e(x,{sm:"4",class:"pl-0 pt-20 py-2"},{default:a(()=>[e(P,{modelValue:I.value,"onUpdate:modelValue":v[0]||(v[0]=t=>I.value=t),"append-icon":"ri-search-line",label:"Búsqueda de Tipos de Recurso"},null,8,["modelValue"])]),_:1}),e(x,{sm:"3",class:"pt-20 py-2"},{default:a(()=>[e(Te,{modelValue:o.value,"onUpdate:modelValue":v[1]||(v[1]=t=>o.value=t),items:d.value,label:"Tipo de Capacidad",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1}),e(x,{sm:"4",class:"pt-20 py-2"},{default:a(()=>[e(me,{modelValue:C.value,"onUpdate:modelValue":v[2]||(v[2]=t=>C.value=t),items:i.value,label:"Columnas Visibles",multiple:"","return-object":""},{selection:a(({item:t,index:R})=>[R<2?($(),B(H,{key:0},{default:a(()=>[D("span",null,k(t.title),1)]),_:2},1024)):K("",!0),R===2?($(),Q("span",be,"(otras "+k(C.value.length-2)+"+)",1)):K("",!0)]),_:1},8,["modelValue","items"])]),_:1}),e(x,{sm:"1",class:"pt-20 py-2"},{default:a(()=>[e(q,{onClick:c,color:l.$cv("principal"),size:"x-large",title:"Registrar Tipo de Recurso"},{default:a(()=>[e(F,{size:"large",icon:"ri-add-circle-line"})]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1})]),"item.is_shared_capacity":a(({item:t})=>[e(H,{color:te(t.is_shared_capacity),density:"comfortable"},{default:a(()=>[T(k(t.is_shared_capacity?"Compartida":"Individual"),1)]),_:2},1032,["color"])]),"item.max_capacity_per_reservation":a(({item:t})=>[t.max_capacity_per_reservation?($(),B(H,{key:0,color:"primary",variant:"outlined",density:"comfortable"},{default:a(()=>[T(k(t.max_capacity_per_reservation),1)]),_:2},1024)):($(),Q("span",we,"Sin límite"))]),"item.resources_count":a(({item:t})=>[e(H,{color:"info",density:"comfortable"},{default:a(()=>[T(k(t.resources_count||0),1)]),_:2},1024)]),"item.active":a(({item:t})=>[e(H,{color:le(t),density:"comfortable"},{default:a(()=>[T(k(se(t)),1)]),_:2},1032,["color"])]),"item.actions":a(({item:t})=>[D("div",Re,[e(G,{size:"small",title:"Editar",onClick:R=>p(t)},{default:a(()=>[e(F,{icon:"ri-pencil-line"})]),_:2},1032,["onClick"]),e(Z,{modelValue:t.active,"onUpdate:modelValue":R=>t.active=R,"true-value":!0,"false-value":!1,color:"primary","hide-details":"",title:"Activar o Inactivar",onChange:R=>ae(t)},null,8,["modelValue","onUpdate:modelValue","onChange"]),e(G,{size:"small",title:"Eliminar",onClick:R=>h(t)},{default:a(()=>[e(F,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])])]),_:1},8,["headers","items","search","loading"]),e(Ce,{modelValue:y.value,"onUpdate:modelValue":v[3]||(v[3]=t=>y.value=t),"resource-type":b.value,mode:w.value,onSaved:re,onCancel:v[4]||(v[4]=t=>y.value=!1)},null,8,["modelValue","resource-type","mode"]),e(ve,{modelValue:g.value.show,"onUpdate:modelValue":v[6]||(v[6]=t=>g.value.show=t),color:g.value.color,timeout:3e3},{action:a(({attrs:t})=>[e(q,ce({dark:"",text:""},t,{onClick:v[5]||(v[5]=R=>g.value.show=!1)}),{default:a(()=>[T(" Cerrar ")]),_:2},1040)]),default:a(()=>[D("div",{innerHTML:g.value.message},null,8,ke)]),_:1},8,["modelValue","color"])]),_:1})]),_:1})}}},aa=Ve($e,[["__scopeId","data-v-0409f05a"]]);export{aa as default};

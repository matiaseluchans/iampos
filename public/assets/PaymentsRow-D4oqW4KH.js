import{_ as g}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as x,a as f}from"./VRow-DH7aR9kf.js";import{o as n,e as o,w as i,b as k,a3 as c,H as _,l as d,ae as w,a as u,V as P,c as h,t as p,a0 as V}from"./main-G7GggmvP.js";import{V as b}from"./VDataTable-BZeOkjMV.js";import{e as E}from"./VChip-CjnngcFM.js";import{a as C}from"./VSnackbar-nnY25wgc.js";import{V as v}from"./VTextField-C2daNm2f.js";const I={name:"PaymentsRow",props:{modulo:String,records:{type:Array,default(){return[]}},pendingAmount:Number},emits:["update-total"],data:()=>({showFooter:!1,paymentMethods:[],newPayments:[],existingPayments:[],route:"payments",headers:[{title:"",key:"actions",align:"center",width:"120px"},{title:"Id",key:"index",align:" d-none"},{title:"Método de pago",key:"payment_method_id",align:"center"},{title:"Importe",key:"amount",align:"center"}],keyTablePayments:0}),computed:{payments(){return[...this.existingPayments,...this.newPayments]},totalLocal(){const e=this.existingPayments.reduce((s,r)=>s+Number(r.amount||0),0),a=this.newPayments.reduce((s,r)=>s+Number(r.amount||0),0);return e+a}},watch:{totalLocal(e){this.$emit("update-total",e)},records:{immediate:!0,handler(e){e.length>0&&(this.existingPayments=e.map((a,s)=>({...a,index:s,isExisting:!0})))}}},created(){this.loadData(),this.records.length===0&&this.add()},methods:{getPaymentMethodName(e){const a=this.paymentMethods.find(s=>s.id===e);return a?a.name:"Método no encontrado"},formatCurrency(e){return e?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0"},onlyNumberInput(e){const a=String.fromCharCode(e.keyCode);/[0-9.]/.test(a)||e.preventDefault()},setImporte(e){e.amount=this.pendingAmount},add(){const e=this.payments.length;this.newPayments.push({payment_method_id:"",amount:"",index:e,isExisting:!1})},remove(e){if(e.isExisting)return;let a=e.index,s=this.newPayments.findIndex(r=>r.index===a);this.newPayments.splice(s,1),this.newPayments.forEach((r,y)=>{r.index=this.existingPayments.length+y})},reset(){this.newPayments=[]},resetRow(e){const a=this.newPayments.find(s=>s.index===e);a&&(a.payment_method_id="",a.amount="")},async loadData(){try{const[e]=await Promise.all([this.$axios.get(this.$routes.paymentMethods)]);this.paymentMethods=e.data.data||e.data}catch(e){console.error("Error loading data:",e),this.showSnackbar("Error al cargar los datos","error")}}}},N={class:"d-flex gap-0 px-0 mx-0 justify-center"},M={class:"d-flex justify-center"},A={key:1,class:"text-medium-emphasis"},R={key:1,class:"text-medium-emphasis"};function $(e,a,s,r,y,l){return n(),o(f,{dense:"",align:"center"},{default:i(()=>[k(x,{cols:"12",md:"12",sm:"12",class:"text-center"},{default:i(()=>[e.newPayments.length==0?(n(),o(c,{key:0,color:"primary",size:"small",title:"Agregar Pago",onClick:a[0]||(a[0]=t=>l.add())},{default:i(()=>[_(" Agregar Pago ")]),_:1})):d("",!0),(n(),o(b,{headers:e.headers,items:l.payments,key:e.keyTablePayments,"hide-default-footer":!0},w({"item.actions":i(({item:t})=>[u("div",N,[t.isExisting?d("",!0):(n(),o(c,{key:0,color:"success",size:"small",title:"Set Pago",onClick:m=>l.setImporte(t),variant:"tonal",icon:"ri-money-dollar-circle-line"},null,8,["onClick"])),t.isExisting?d("",!0):(n(),o(c,{key:1,color:"error",size:"small",title:"Eliminar Pago",onClick:m=>l.remove(t),variant:"tonal",icon:"ri-subtract-line"},null,8,["onClick"])),t.isExisting?d("",!0):(n(),o(c,{key:2,color:"warning",size:"small",title:"Reset",icon:"ri-refresh-line",variant:"tonal",onClick:m=>l.resetRow(t.index)},null,8,["onClick"])),t.isExisting?d("",!0):(n(),o(c,{key:3,color:"primary",size:"small",title:"Agregar Pago",onClick:a[1]||(a[1]=m=>l.add()),variant:"tonal",icon:"ri-add-line"})),t.isExisting?(n(),o(E,{key:4,icon:"ri-lock-line",color:"primary",class:"ml-1"},{default:i(()=>[t.isExisting?(n(),o(P,{key:0,icon:"ri-lock-line",color:"disabled",class:"ml-1"})):d("",!0)]),_:2},1024)):d("",!0)])]),"item.payment_method_id":i(({item:t})=>[u("div",M,[t.isExisting?(n(),h("span",A,p(l.getPaymentMethodName(t.payment_method_id)),1)):(n(),o(C,{key:0,class:"mx-auto",items:e.paymentMethods,"item-value":"id","item-title":"name",label:t.payment_method_id?"":"Método de Pago",modelValue:t.payment_method_id,"onUpdate:modelValue":m=>t.payment_method_id=m,rules:[e.$rulesRequerido],"return-object":"",density:"compact","hide-details":"",style:{"max-width":"350px"}},null,8,["items","label","modelValue","onUpdate:modelValue","rules"]))])]),"item.amount":i(({item:t})=>[t.isExisting?(n(),h("span",R," $"+p(t.amount),1)):(n(),o(v,{key:0,class:"text-left",modelValue:t.amount,"onUpdate:modelValue":m=>t.amount=m,label:t.amount?"":"Importe",rules:[e.$rulesRequerido],required:"",density:"compact","hide-details":"",onKeypress:l.onlyNumberInput},null,8,["modelValue","onUpdate:modelValue","label","rules","onKeypress"]))]),"item.data-table-row":i(({props:t})=>[u("tr",V({class:t.item.isExisting?"existing-payment-row":"new-payment-row"},t),null,16)]),_:2},[e.showFooter?void 0:{name:"bottom",fn:i(()=>[]),key:"0"}]),1032,["headers","items"]))]),_:1})]),_:1})}const j=g(I,[["render",$],["__scopeId","data-v-4d66066d"]]);export{j as _};

import{_ as F}from"./DateRangeField-BSlMRueB.js";import{ab as T,e as E,w as a,v as I,o as L,b as e,a as o,V as u,a2 as _,H as m,t as c,n as k,$ as A,x as U,y as B}from"./main-BvtcRX0q.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as D,c as P,V as w,d as V,b as z}from"./VCard-C6su_7G9.js";import{V as R}from"./VDataTable-DQtNQhVW.js";import{a as v,V as b}from"./VRow-CO8ZPJ7K.js";import{a as N,b as G,c as O,V as H}from"./VSnackbar-DHyaFap7.js";import{V as M}from"./VAvatar-8GIpnYiE.js";import{V as W}from"./VDialog-CxjQ0V4g.js";import{V as q}from"./VDivider-0rVQKNCI.js";import{V as J}from"./VSpacer-Bm2UjFNg.js";import"./VTextField-BXesk2-K.js";import"./index-DnXV62NZ.js";import"./VImg-DQRa1Rkg.js";import"./easing-DY7PVvcf.js";import"./forwardRefs-C-GTDzx5.js";import"./filter-D_KiCgrr.js";import"./VChip-BRlvQMd1.js";import"./VOverlay-BHQIf58K.js";import"./lazy-oGgeQylh.js";import"./ssrBoot-Bpxee0vD.js";import"./VCheckboxBtn-D2Ma7M0i.js";import"./VTable-DT1IbhFW.js";const K={components:{DateRangeField:F},data(){return{loading:!1,detailLoading:!1,headers:[{title:"DÃ­a",key:"date",align:"left",width:"120px"},{title:"MÃ©todo de Pago",key:"payment_method",align:"left"},{title:"Monto",key:"amount",align:"end"},{title:"Acciones",key:"actions",sortable:!1,align:"center",width:"80px"}],detailHeaders:[{title:"Fecha Pago",key:"payment_date",align:"left",width:"150px"},{title:"ID Orden",key:"order_number",align:"left",width:"100px"},{title:"Cliente",key:"customer",align:"left"},{title:"Monto",key:"amount",align:"end"}],paymentsSummary:{data:[],total:0,current_page:1,last_page:1},paymentDetails:[],selectedPayment:{},paymentMethods:[],selectedPaymentMethod:null,detailDialog:!1,pagination:{page:1,itemsPerPage:10,sortBy:[],sortDesc:[]},dateRange:{start:null,end:null},defaultDateRange:{},snackbar:!1,snackbarText:"",snackbarColor:"success",isInitialLoad:!0,exportLoading:!1}},computed:{...T({userIsAdmin:"isAdmin"})},async created(){this.setDefaultDateRange(),await this.loadPaymentMethods(),await this.fetchData()},methods:{async exportToExcel(){var t,n;this.exportLoading=!0;try{const r={start_date:(t=this.dateRange)==null?void 0:t.start,end_date:(n=this.dateRange)==null?void 0:n.end,payment_methods:this.selectedPaymentMethod};Object.keys(r).forEach(d=>r[d]===void 0&&delete r[d]);const p=await this.$axios.get("/api/payments-summary/export-excel",{params:r,responseType:"blob"}),s=new Blob([p.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(s),h=document.createElement("a");h.href=i;const g=p.headers["content-disposition"];let l="resumen_pagos.xlsx";if(g){console.log("ðŸ“ Content-Disposition header:",g);let d="resumen_pagos.xlsx";const S=[/filename="([^"]+)"/,/filename=([^;]+)/,/filename\*=UTF-8''([^;]+)/];for(const x of S){const f=g.match(x);if(f&&f[1]){d=f[1],console.log("âœ… Filename capturado con patrÃ³n:",x,"-",d);break}}if(d==="resumen_pagos.xlsx"){const x=g.split(";");for(const f of x)if(f.trim().startsWith("filename")){const C=f.split("=")[1];if(C){d=C.trim().replace(/"/g,""),console.log("âœ… Filename capturado manualmente:",d);break}}}try{d.includes("%")&&(d=decodeURIComponent(d),console.log("âœ… Filename decodificado:",d))}catch{console.warn("âš ï¸ No se pudo decodificar el filename:",d)}console.log("ðŸ“„ Filename final:",d),h.setAttribute("download",d),document.body.appendChild(h),h.click(),h.remove(),window.URL.revokeObjectURL(i)}this.showSnackbar("Excel exportado exitosamente","success")}catch(r){console.error("Error exporting to Excel:",r),this.showSnackbar("Error al exportar el Excel","error")}finally{this.exportLoading=!1}},setDefaultDateRange(){const t=new Date,n=new Date;n.setDate(n.getDate()-30),this.defaultDateRange={start:n,end:t},this.isInitialLoad&&(this.dateRange={...this.defaultDateRange})},async loadPaymentMethods(){try{const t=await this.$axios.get(this.$routes.paymentMethods);this.paymentMethods=t.data.data||[]}catch(t){console.error("Error loading payment methods:",t),this.paymentMethods=[]}},async fetchData(){var t,n;this.loading=!0;try{const r={page:this.pagination.page,per_page:this.pagination.itemsPerPage,start_date:(t=this.dateRange)==null?void 0:t.start,end_date:(n=this.dateRange)==null?void 0:n.end,payment_methods:this.selectedPaymentMethod};Object.keys(r).forEach(s=>r[s]===void 0&&delete r[s]);const p=await this.$axios.get(this.$routes.paymentsSummary,{params:r});this.paymentsSummary={data:p.data.data,total:p.data.total,current_page:p.data.current_page,last_page:p.data.last_page},this.isInitialLoad=!1}catch(r){console.error("Error fetching payments summary:",r),this.showSnackbar("Error al cargar el resumen de pagos","error")}finally{this.loading=!1}},resetFilters(){this.dateRange={start:null,end:null},this.selectedPaymentMethod=null,this.pagination.page=1,this.$nextTick(()=>{this.$refs.dateRangeField&&this.$refs.dateRangeField.reset&&this.$refs.dateRangeField.reset()}),this.fetchData()},async showPaymentDetails(t){this.selectedPayment=t,this.detailLoading=!0,this.detailDialog=!0;try{const n={date:t.date,payment_method_id:t.payment_method_id},r=await this.$axios.get(this.$routes.paymentsDetail,{params:n});this.paymentDetails=r.data.data}catch(n){console.error("Error fetching payment details:",n),this.showSnackbar("Error al cargar el detalle de pagos","error")}finally{this.detailLoading=!1}},closeDetailDialog(){this.detailDialog=!1,this.selectedPayment={},this.paymentDetails=[]},handlePaginationChange(t){this.pagination.page=t.page,this.pagination.itemsPerPage=t.itemsPerPage,this.pagination.sortBy=t.sortBy,this.pagination.sortDesc=t.sortDesc,this.fetchData()},calculateTotalAmount(){return this.paymentsSummary.data?this.paymentsSummary.data.reduce((t,n)=>t+(parseFloat(n.amount)||0),0).toFixed(2):0},formatCurrency(t){return t?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(t):"$0"},formatDateGrid(t){if(!t)return"";const[n,r,p]=t.split("-");return`${p}/${r}/${n}`},formatDateTime(t){return t?new Date(t).toLocaleString("es-AR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):""},getColorAmount(t){return Math.sign(t)===1?"text-success":"text-error"},getPaymentMethodColor(t){return{cash:"success",card:"primary",transfer:"info",digital:"warning",mercadopago:"primary",debit:"info",credit:"warning"}[t]||"secondary"},getPaymentMethodIcon(t){return{cash:"ri-money-dollar-circle-line",card:"ri-bank-card-line",transfer:"ri-exchange-funds-line",digital:"ri-smartphone-line",mercadopago:"ri-smartphone-line",debit:"ri-bank-card-line",credit:"ri-bank-card-line"}[t]||"ri-money-dollar-circle-line"},showSnackbar(t,n){this.snackbarText=t,this.snackbarColor=n,this.snackbar=!0}}},y=t=>(U("data-v-db14c8d0"),t=t(),B(),t),Q={class:"d-flex flex-column",style:{"min-width":"250px","flex-grow":"1"}},X=y(()=>o("h2",{class:"text-h5 mb-1"},"Resumen de Pagos",-1)),Y={class:"text-caption text-medium-emphasis d-flex align-center"},Z=y(()=>o("span",{style:{"white-space":"normal"}}," Resumen diario de pagos agrupados por dÃ­a y mÃ©todo de pago ",-1)),$={class:"d-flex flex-column"},ee={class:"font-weight-medium"},te={class:"d-flex align-center"},ae={class:"d-flex justify-center align-center"},se={class:"bg-grey-lighten-4 font-weight-bold",style:{background:"#ccc"}},oe=y(()=>o("td",{class:"text-left"},null,-1)),ne=y(()=>o("td",{class:"text-left"},"Total General",-1)),le={class:"text-right"},ie=y(()=>o("td",{class:"text-right"},null,-1)),re=y(()=>o("span",null,"Resumen del Grupo",-1)),de={class:"d-flex flex-column"},ce={class:"text-caption text-medium-emphasis"},me={class:"font-weight-medium"},pe={class:"d-flex flex-column"},ue={class:"text-caption text-medium-emphasis"},he={class:"font-weight-medium"},ge={class:"d-flex flex-column"},fe={class:"text-caption text-medium-emphasis"},_e={class:"d-flex flex-column"},ye={class:"font-weight-medium"},xe={class:"font-weight-medium"},be={class:"d-flex flex-column text-start"},De={class:"d-block font-weight-medium text-high-emphasis text-truncate"},we={class:"text-disabled"};function ke(t,n,r,p,s,i){const h=F,g=I("IconBtn");return L(),E(D,null,{default:a(()=>[e(P,{class:"d-flex flex-wrap align-center justify-space-between ga-2"},{default:a(()=>[o("div",Q,[X,o("div",Y,[e(u,{icon:"ri-information-line",size:"16",class:"mr-1"}),Z])])]),_:1}),e(w,{class:"d-flex px-2"},{default:a(()=>[e(R,{headers:s.headers,items:s.paymentsSummary.data||[],class:"text-no-wrap striped-table border-0",loading:s.loading,"items-per-page":s.pagination.itemsPerPage,page:s.pagination.page,"items-length":s.paymentsSummary.total||0,"onUpdate:options":i.handlePaginationChange},{top:a(()=>[e(D,{flat:"",color:"white"},{default:a(()=>[e(w,{class:"mx-0 px-0"},{default:a(()=>[e(v,{dense:"",class:"mx-0 px-0"},{default:a(()=>[e(b,{cols:"12",md:"6",sm:"12",class:"pl-0 pt-0"},{default:a(()=>[e(h,{class:"mt-0",ref:"dateRangeField",modelValue:s.dateRange,"onUpdate:modelValue":n[0]||(n[0]=l=>s.dateRange=l),modelLabel:"Fecha de Pago"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6",sm:"12",class:"pl-0 pt-1"},{default:a(()=>[e(N,{modelValue:s.selectedPaymentMethod,"onUpdate:modelValue":n[1]||(n[1]=l=>s.selectedPaymentMethod=l),items:s.paymentMethods,"item-title":"name","item-value":"id",label:"MÃ©todo de Pago",clearable:"",class:"mt-0",density:"compact",multiple:"",chips:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(V,{class:"justify-end"},{default:a(()=>[e(_,{variant:"outlined",color:"primary",onClick:i.resetFilters},{default:a(()=>[m(" Reset ")]),_:1},8,["onClick"]),e(_,{variant:"outlined",color:"white",onClick:i.fetchData,loading:s.loading,class:"bg-primary"},{default:a(()=>[m(" Buscar ")]),_:1},8,["onClick","loading"]),e(_,{color:"success",variant:"outlined",onClick:i.exportToExcel,loading:s.exportLoading,disabled:!s.paymentsSummary.data||s.paymentsSummary.data.length===0},{default:a(()=>[e(u,{icon:"ri-file-excel-2-line",class:"mr-2"}),m(" Exportar Excel ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),"item.date":a(({item:l})=>[o("div",$,[o("span",ee,c(i.formatDateGrid(l.date)),1)])]),"item.payment_method":a(({item:l})=>[o("div",te,[e(M,{color:i.getPaymentMethodColor(l.payment_method),variant:"tonal",size:"32",class:"mr-2"},{default:a(()=>[e(u,{icon:i.getPaymentMethodIcon(l.payment_method)},null,8,["icon"])]),_:2},1032,["color"]),o("span",null,c(l.payment_method_name),1)])]),"item.amount":a(({item:l})=>[o("div",{class:k(["text-right",i.getColorAmount(l.amount)])},[o("strong",null,c(i.formatCurrency(l.amount)),1)],2)]),"item.actions":a(({item:l})=>[o("div",ae,[e(g,{size:"small",onClick:d=>i.showPaymentDetails(l),title:"Ver detalle"},{default:a(()=>[e(u,{icon:"ri-eye-line"})]),_:2},1032,["onClick"])])]),tfoot:a(()=>[o("tfoot",null,[o("tr",se,[oe,ne,o("td",le,c(i.formatCurrency(i.calculateTotalAmount())),1),ie])])]),_:1},8,["headers","items","loading","items-per-page","page","items-length","onUpdate:options"]),e(W,{modelValue:s.detailDialog,"onUpdate:modelValue":n[2]||(n[2]=l=>s.detailDialog=l),"max-width":"800px",persistent:""},{default:a(()=>[e(D,{class:"rounded-lg"},{default:a(()=>[e(G,{color:"primary",density:"compact"},{default:a(()=>[e(O,{class:"text-white font-weight-medium"},{default:a(()=>[e(_,{icon:"",variant:"text",color:"white",onClick:i.closeDetailDialog},{default:a(()=>[e(u,null,{default:a(()=>[m("ri-close-line")]),_:1})]),_:1},8,["onClick"]),m(" Detalle de Pagos - "+c(s.selectedPayment.date)+" - "+c(s.selectedPayment.payment_method_name),1)]),_:1})]),_:1}),e(w,{class:"px-4 pt-4 pb-2"},{default:a(()=>[e(D,{flat:"",border:"",class:"mb-4",color:"primary-lighten-5"},{default:a(()=>[e(z,{class:"py-0 mt-2"},{default:a(()=>[e(P,{class:"d-flex align-center"},{default:a(()=>[e(M,{icon:"ri-money-dollar-circle-line",class:"text-info mr-2",variant:"tonal"}),re]),_:1})]),_:1}),e(q,{class:"my-1"}),e(w,null,{default:a(()=>[e(v,{dense:""},{default:a(()=>[e(b,{cols:"6",sm:"4"},{default:a(()=>[o("div",de,[o("span",ce,[e(u,{icon:"ri-calendar-line",size:"14",class:"mr-1"}),m(" Fecha ")]),o("span",me,c(i.formatDateGrid(s.selectedPayment.date)),1)])]),_:1}),e(b,{cols:"6",sm:"4"},{default:a(()=>[o("div",pe,[o("span",ue,[e(u,{icon:"ri-bank-card-line",size:"14",class:"mr-1"}),m(" MÃ©todo de Pago ")]),o("span",he,c(s.selectedPayment.payment_method_name),1)])]),_:1}),e(b,{cols:"6",sm:"4"},{default:a(()=>[o("div",ge,[o("span",fe,[e(u,{icon:"ri-money-dollar-circle-line",size:"14",class:"mr-1"}),m(" Total ")]),o("span",{class:k(["font-weight-medium",i.getColorAmount(s.selectedPayment.amount)])},c(i.formatCurrency(s.selectedPayment.amount)),3)])]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{headers:s.detailHeaders,items:s.paymentDetails,class:"text-no-wrap striped-table border",loading:s.detailLoading,"items-per-page":"5",page:s.pagination.page},{"item.payment_date":a(({item:l})=>[o("div",_e,[o("span",ye,c(i.formatDateTime(l.payment_date)),1)])]),"item.order_number":a(({item:l})=>[o("span",xe,"#"+c(l.order_number),1)]),"item.customer":a(({item:l})=>[o("div",be,[o("span",De,c(l.customer_name),1),o("small",we,c(l.customer_contact),1)])]),"item.amount":a(({item:l})=>[o("div",{class:k(["text-right",i.getColorAmount(l.amount)])},[o("strong",null,c(i.formatCurrency(l.amount)),1)],2)]),_:1},8,["headers","items","loading","page"])]),_:1}),e(V,null,{default:a(()=>[e(J),e(_,{variant:"outlined",color:"primary",onClick:i.closeDetailDialog},{default:a(()=>[m(" Cerrar ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(H,{modelValue:s.snackbar,"onUpdate:modelValue":n[4]||(n[4]=l=>s.snackbar=l),color:s.snackbarColor,timeout:3e3},{action:a(({attrs:l})=>[e(_,A({text:""},l,{onClick:n[3]||(n[3]=d=>s.snackbar=!1)}),{default:a(()=>[m(" Cerrar ")]),_:2},1040)]),default:a(()=>[m(c(s.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})]),_:1})}const Je=j(K,[["render",ke],["__scopeId","data-v-db14c8d0"]]);export{Je as default};

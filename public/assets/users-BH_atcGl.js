import{a as L}from"./avatar-1-BeeGmpGQ.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as V,V as w,d as A}from"./VCard-C4ovO3Xn.js";import{V as E}from"./VDataTable-BLZgC8uG.js";import{a as k,V as d}from"./VRow-1IsH-HXB.js";import{d as h}from"./VTextField-DkY_PXxT.js";import{a as C,b as S,c as j,V as H}from"./VSnackbar-DYX9Ldxv.js";import{e as v}from"./VChip-Dk80kfPr.js";import{V as z}from"./VDialog-D0HQfBvj.js";import{v as B,o as i,e as n,w as s,b as l,a as m,t as c,l as y,c as U,a3 as u,a0 as P,V as g,H as p,au as N,k as q,F as D}from"./main-6un_LZV3.js";import{V as R}from"./VSpacer-pNpvz9cS.js";import{V as G}from"./VForm-BroPHNre.js";import{V as M}from"./VContainer-C0DfHo0K.js";import{V as b}from"./VAvatar-GilCUASU.js";import{V as O}from"./VDivider-CbpsEDfw.js";import{V as J}from"./VTooltip-BgCceFVS.js";import{V as K}from"./VSwitch-AwbuqzRS.js";import"./VImg-DVuj2CJR.js";import"./forwardRefs-C-GTDzx5.js";import"./VOverlay-D_por6rs.js";import"./easing-DY7PVvcf.js";import"./lazy-7v_vxMTA.js";import"./VCheckboxBtn-B7YgUxzS.js";import"./VTable-CLNiyE_V.js";import"./index-yGNNQEqj.js";import"./ssrBoot-IhPJnLOu.js";var W={};const Q={data:()=>({imagePreview:null,imageFile:null,avatar:L,title:"Usuarios",route:"users",dialog:!1,snackbar:!1,text:"Registro Insertado",color:"success",timeout:4e3,search:"",valid:!0,showPassword:!1,headers:[{title:"Acciones",key:"actions",value:"actions",sortable:!1,width:"150px"},{title:"Imagen",key:"image",sortable:!1,width:"100px"},{title:"Nombre",filterable:!0,key:"name"},{title:"Email",filterable:!0,key:"email"},{title:"Tenant",key:"tenant.name",width:"100px",width:"100px"},{title:"Roles",key:"roles",sortable:!1},{title:"Estado",key:"active",width:"150px"}],desserts:[],editedIndex:-1,tenants:[],roles:[],editedItem:{id:"",name:"",email:"",password:"",tenant_id:null,roles:[],active:1,image:""},defaultItem:{id:"",name:"",email:"",password:"",tenant_id:null,roles:[],active:1,image:""},selectedHeaders:[],emailRules:[e=>!!e||"Email es requerido",e=>/.+@.+\..+/.test(e)||"Email debe ser válido"],passwordRules:[e=>!!e||"Contraseña es requerida",e=>e&&e.length>=8||"Mínimo 8 caracteres"],rolesLoading:!1}),watch:{dialog(e){e||this.close()},"editedItem.tenant_id":{handler(e){this.dialog&&(this.loadRoles(e),this.editedItem.roles=[])},immediate:!1}},created(){this.initialize(),this.selectedHeaders=this.headers,this.loadTenants()},computed:{formTitle(){return this.editedIndex===-1?"Registrar Usuario":"Editar Usuario"},showHeaders(){return this.headers.filter(e=>this.selectedHeaders.includes(e))},filteredDesserts(){if(!this.search)return this.desserts;const e=this.search.toLowerCase();return this.desserts.filter(a=>a.name.toLowerCase().includes(e)||a.email.toLowerCase().includes(e)||a.tenant&&a.tenant.name.toLowerCase().includes(e))}},methods:{async initialize(){try{const e=await this.$axios.get(this.$routes[this.route]);this.desserts=e.data.data}catch(e){console.error("Error cargando usuarios:",e)}},async loadTenants(){try{const e=await this.$axios.get(this.$routes.tenants);this.tenants=e.data.data}catch(e){console.error("Error cargando tenants:",e)}},async loadRoles(e){this.rolesLoading=!0;try{if(!e)return this.roles=[],Promise.resolve();const a=await this.$axios.get(`${this.$routes.roles}?tenant_id=${e}`);return this.roles=a.data.data,Promise.resolve()}catch(a){return console.error("Error cargando roles:",a),Promise.reject(a)}finally{this.rolesLoading=!1}},handleImageUpload(e){var f;const a=(f=e.target.files)==null?void 0:f[0];this.imagePreview=a?URL.createObjectURL(a):""},handleFileUpload(e){const a=e.target.files[0];if(!a)return;if(!["image/jpeg","image/png","image/gif","image/jpg"].includes(a.type)){this.showSnackbar("Formato de imagen no válido. Use JPG, PNG o GIF.","error");return}if(a.size>800*1024){this.showSnackbar("La imagen es demasiado grande (máx. 800KB)","error");return}this.editedItem.imageFile=a;const I=new FileReader;I.onload=T=>{this.imagePreview=T.target.result},I.readAsDataURL(a)},resetAvatar(){this.imagePreview=null,this.imageFile=null,this.editedItem.image=null,this.$refs.fileInput&&(this.$refs.fileInput.value="")},getImageUrl(e){return e?e.startsWith("http")?e:`${W.VUE_APP_API_URL||""}/storage/users/${e}`:""},async editItem(e){this.editedIndex=e.id,this.editedItem=Object.assign({},e),console.log(this.editedIndex),console.log(this.editedItem),e.image?this.imagePreview=this.getImageUrl(e.image):this.imagePreview=null,this.dialog=!0,await this.$nextTick(),this.loadRoles(e.tenant_id).then(()=>{this.editedItem.roles=this.roles.filter(a=>e.roles.some(f=>f.id===a.id))})},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1,this.imagePreview=null,this.resetAvatar()})},showSnackbar(e,a){this.text=e,this.color=a,this.snackbar=!0},getTenantColor(e){return e.tenant?["primary","secondary","success","info","warning","error"][e.tenant.id]:"grey"},getRandomColor(e){return["primary","secondary","success","info","warning","error"][e.roles[0].id]}}},X={key:1,class:"grey--text caption"},Y={class:"d-flex flex-column justify-center gap-5"},Z={class:"d-flex flex-wrap gap-2"},_=m("span",{class:"d-none d-sm-block"},"Subir foto",-1),x=m("span",{class:"d-none d-sm-block"},"Restablecer",-1),ee=m("p",{class:"text-body-1 mb-0"}," Formatos permitidos: JPG, GIF o PNG. Tamaño máximo 800KB ",-1),ae=m("span",null,"Seleccione un tenant primero",-1),te={key:1},le={class:"d-flex flex-wrap gap-1 align-center",style:{"min-width":"120px"}},se=["innerHTML"];function ie(e,a,f,I,T,r){const $=B("IconBtn");return i(),n(V,{title:"Administración de "+e.title},{default:s(()=>[l(w,{class:"d-flex px-2"},{default:s(()=>[l(E,{headers:r.showHeaders,items:r.filteredDesserts,search:e.search,class:"text-no-wrap striped-table"},{top:s(()=>[l(V,{flat:"",color:"white"},{default:s(()=>[l(w,null,{default:s(()=>[l(k,null,{default:s(()=>[l(d,{sm:"4",class:"pl-0 pt-20 py-2"},{default:s(()=>[l(h,{modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=t=>e.search=t),"append-icon":"ri-search-line",label:"Busqueda de "+e.title},null,8,["modelValue","label"])]),_:1}),l(d,{sm:"4",class:"pt-20 py-2"},{default:s(()=>[l(C,{modelValue:e.selectedHeaders,"onUpdate:modelValue":a[1]||(a[1]=t=>e.selectedHeaders=t),items:e.headers,label:"Columnas Visibles",multiple:"","return-object":""},{selection:s(({item:t,index:o})=>[o<2?(i(),n(v,{key:0},{default:s(()=>[m("span",null,c(t.title),1)]),_:2},1024)):y("",!0),o===2?(i(),U("span",X," (otras "+c(e.selectedHeaders.length-2)+"+) ",1)):y("",!0)]),_:1},8,["modelValue","items"])]),_:1}),l(d,{sm:"1",class:"pt-20 py-2"},{default:s(()=>[l(z,{modelValue:e.dialog,"onUpdate:modelValue":a[16]||(a[16]=t=>e.dialog=t),"max-width":"500px"},{activator:s(({props:t})=>[l(u,P(t,{color:e.$cv("principal"),size:"x-large",title:"Registrar "+e.title}),{default:s(()=>[l(g,{size:"large",icon:"ri-add-circle-line"})]),_:2},1040,["color","title"])]),default:s(()=>[l(V,null,{default:s(()=>[l(S,{color:e.$cv("principal")},{default:s(()=>[l(u,{icon:"ri-close-line",color:"white",onClick:a[2]||(a[2]=t=>e.dialog=!1)}),l(j,null,{default:s(()=>[p(c(r.formTitle),1)]),_:1}),l(R)]),_:1},8,["color"]),l(G,{ref:"form",modelValue:e.valid,"onUpdate:modelValue":a[15]||(a[15]=t=>e.valid=t)},{default:s(()=>[l(w,null,{default:s(()=>[l(M,{class:"py-0"},{default:s(()=>[l(k,{class:"py-0"},{default:s(()=>[l(d,{cols:"12"},{default:s(()=>[l(V,null,{default:s(()=>[l(w,{class:"d-flex"},{default:s(()=>[!e.imagePreview&&!e.editedItem.image?(i(),n(b,{key:0,rounded:"lg",size:"100",class:"me-6",image:e.avatar},null,8,["image"])):e.imagePreview?(i(),n(b,{key:1,rounded:"lg",size:"100",class:"me-6",image:e.imagePreview},null,8,["image"])):e.editedItem.image?(i(),n(b,{key:2,rounded:"lg",size:"100",class:"me-6",image:r.getImageUrl(e.editedItem.image)},null,8,["image"])):y("",!0),m("div",Y,[m("div",Z,[l(u,{color:"primary",onClick:a[3]||(a[3]=t=>e.$refs.fileInput.click())},{default:s(()=>[l(g,{icon:"ri-upload-cloud-line",class:"d-sm-none"}),_]),_:1}),m("input",{ref:"fileInput",type:"file",name:"image",accept:".jpeg,.png,.jpg,.gif",hidden:"",onChange:a[4]||(a[4]=(...t)=>r.handleFileUpload&&r.handleFileUpload(...t))},null,544),l(u,{color:"error",variant:"outlined",onClick:r.resetAvatar},{default:s(()=>[x,l(g,{icon:"ri-refresh-line",class:"d-sm-none"})]),_:1},8,["onClick"])]),ee])]),_:1}),l(O)]),_:1})]),_:1}),l(d,{cols:"12",sm:"12"},{default:s(()=>[l(k,{class:"py-0"},{default:s(()=>[l(d,{cols:"12",sm:"12"},{default:s(()=>[l(h,{modelValue:e.editedItem.name,"onUpdate:modelValue":a[5]||(a[5]=t=>e.editedItem.name=t),label:"Nombre",required:"",rules:[t=>!!t||"Nombre es requerido"]},null,8,["modelValue","rules"])]),_:1}),l(d,{cols:"12",sm:"12"},{default:s(()=>[l(h,{modelValue:e.editedItem.email,"onUpdate:modelValue":a[6]||(a[6]=t=>e.editedItem.email=t),label:"Email",required:"",rules:e.emailRules},null,8,["modelValue","rules"])]),_:1}),l(d,{cols:"12",sm:"12"},{default:s(()=>[l(C,{modelValue:e.editedItem.tenant_id,"onUpdate:modelValue":a[7]||(a[7]=t=>e.editedItem.tenant_id=t),items:e.tenants,"item-title":"name","item-value":"id",label:"Tenant",required:"",rules:[t=>!!t||"Tenant es requerido"]},null,8,["modelValue","items","rules"])]),_:1}),l(d,{cols:"12"},{default:s(()=>[l(C,{modelValue:e.editedItem.roles,"onUpdate:modelValue":a[8]||(a[8]=t=>e.editedItem.roles=t),items:e.roles,"item-title":"name","item-value":"id",label:"Rol",disabled:!e.editedItem.tenant_id,loading:e.rolesLoading,clearable:"",rules:[t=>!!t||"Rol es requerido"]},N({_:2},[e.editedItem.tenant_id?void 0:{name:"prepend-inner",fn:s(()=>[l(J,{location:"bottom"},{activator:s(({props:t})=>[l(g,P(t,{icon:"ri-information-line"}),null,16)]),default:s(()=>[ae]),_:1})]),key:"0"}]),1032,["modelValue","items","disabled","loading","rules"])]),_:1}),l(d,{cols:"12",sm:"12"},{default:s(()=>[e.editedIndex===-1?(i(),n(h,{key:0,modelValue:e.editedItem.password,"onUpdate:modelValue":a[9]||(a[9]=t=>e.editedItem.password=t),label:"Contraseña",type:e.showPassword?"text":"password","append-icon":e.showPassword?"ri-eye-line":"ri-eye-off-line","onClick:append":a[10]||(a[10]=t=>e.showPassword=!e.showPassword),rules:e.passwordRules},null,8,["modelValue","type","append-icon","rules"])):(i(),n(h,{key:1,modelValue:e.editedItem.password,"onUpdate:modelValue":a[11]||(a[11]=t=>e.editedItem.password=t),label:"Nueva Contraseña (dejar en blanco para no cambiar)",type:e.showPassword?"text":"password","append-icon":e.showPassword?"ri-eye-line":"ri-eye-off-line","onClick:append":a[12]||(a[12]=t=>e.showPassword=!e.showPassword)},null,8,["modelValue","type","append-icon"]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(A,null,{default:s(()=>[l(R),l(u,{variant:"outlined",color:"primary",onClick:a[13]||(a[13]=t=>e.dialog=!1)},{default:s(()=>[p("Cancelar")]),_:1}),l(u,{class:"bg-primary",color:"white",onClick:a[14]||(a[14]=t=>e.$saveUser())},{default:s(()=>[p("Guardar")]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),"item.active":s(({item:t})=>[l(v,{color:e.$resolveStatusVariant(t.active).color,density:"comfortable"},{default:s(()=>[p(c(e.$resolveStatusVariant(t.active).text),1)]),_:2},1032,["color"])]),"item.image":s(({item:t})=>[t.image?(i(),n(b,{key:0,image:r.getImageUrl(t.image),"max-height":"50","max-width":"50",contain:""},null,8,["image"])):(i(),U("span",te))]),"item.tenant.name":s(({item:t})=>[t.tenant?(i(),n(v,{key:0,class:"ma-1",color:r.getTenantColor(t)},{default:s(()=>[p(c(t.tenant.name),1)]),_:2},1032,["color"])):y("",!0)]),"item.roles":s(({item:t})=>[(i(!0),U(D,null,q(t.roles,o=>(i(),n(v,{key:o.id,class:"ma-1",color:r.getRandomColor(t)},{default:s(()=>[p(c(o.name),1)]),_:2},1032,["color"]))),128))]),"item.actions":s(({item:t})=>[m("div",le,[l($,{size:"small",class:"my-1",title:"Editar",onClick:o=>r.editItem(t)},{default:s(()=>[l(g,{icon:"ri-pencil-line"})]),_:2},1032,["onClick"]),l(K,{modelValue:t.active,"onUpdate:modelValue":o=>t.active=o,"true-value":1,"false-value":0,color:"primary","hide-details":"",title:"Activar o Inactivar",onClick:o=>e.$toggleActive(t)},null,8,["modelValue","onUpdate:modelValue","onClick"]),l($,{size:"small",title:"Eliminar",class:"my-1",onClick:o=>e.$deleteItem(t)},{default:s(()=>[l(g,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])])]),_:1},8,["headers","items","search"]),l(H,{modelValue:e.snackbar,"onUpdate:modelValue":a[18]||(a[18]=t=>e.snackbar=t),bottom:!0,color:e.color,timeout:e.timeout},{action:s(({attrs:t})=>[l(u,P({dark:"",text:""},t,{onClick:a[17]||(a[17]=o=>e.snackbar=!1)}),{default:s(()=>[p("Cerrar")]),_:2},1040)]),default:s(()=>[m("div",{innerHTML:e.text},null,8,se)]),_:1},8,["modelValue","color","timeout"])]),_:1})]),_:1},8,["title"])}const Ae=F(Q,[["render",ie]]);export{Ae as default};

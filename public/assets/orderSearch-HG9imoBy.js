import{_ as Q}from"./PaymentsRow-DRbppTgL.js";import{_ as J}from"./DateRangeField-CishFrYf.js";import{at as W,v as X,o as p,e as v,w as t,b as e,a as l,V as h,a3 as g,H as d,t as c,c as b,l as k,n as E,a0 as O,k as B,F as T,x as Z,y as $}from"./main-DeyJ3Yy4.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as C,c as I,V as w,d as A,b as U}from"./VCard-BeaIFLN5.js";import{V as te}from"./VDataTable-CY7VGB_y.js";import{a as V,V as f}from"./VRow-zu13_Jyq.js";import{d as se}from"./VTextField-zGpYlx5m.js";import{a as R,b as j,c as G,V as ae}from"./VSnackbar-uQFr5XBQ.js";import{V as L,e as D,a as M,b as P,c as F}from"./VChip-C7nZB9fv.js";import{V as H}from"./VDialog-ROF2-oxb.js";import{V as Y}from"./VForm-0XUPjltB.js";import{V as z}from"./VAvatar-EUupNyHB.js";import{V as N}from"./VDivider-YiL7etEf.js";import{V as q}from"./VSpacer-B6Jhnuqe.js";import"./VImg-CBQKPB9Q.js";import"./forwardRefs-C-GTDzx5.js";import"./VOverlay-C17Imch_.js";import"./easing-DY7PVvcf.js";import"./lazy-2m7JQlYx.js";import"./VCheckboxBtn-Bcwa9W5g.js";import"./VTable-DkHM5ktc.js";import"./index-B8yE8-tp.js";import"./ssrBoot-B68Wim3J.js";const ie={components:{DateRangeField:J},data(){return{keyPayments:1,validPayment:!1,savingPayment:!1,change:0,totalPaid:0,payment:{amount:0,payment_method_id:null,notes:""},dateRange:{start:null,end:null},dateOrderRange:{start:null,end:null},defaultDateRange:{},loading:!1,search:"",customers:[],paymentStatuses:[],shipmentStatuses:[],selectedCustomer:null,selectedPaymentStatus:null,selectedShipmentStatus:null,selectedOrder:null,movementDialog:!1,paymentFormDialog:!1,validMovement:!1,savingMovement:!1,movement:{status_id:null},snackbar:!1,snackbarText:"",snackbarColor:"success",headers:[{title:"",key:"actions",sortable:!1,align:"left",width:"40px"},{title:"Orden",key:"order_number",width:"60px"},{title:"Fecha",key:"order_date",align:"center",width:"60px"},{title:"Cliente",key:"customer",width:"70%"},{title:"Estados",key:"payment_status_id",align:"center"},{title:"Fecha Entrega",key:"delivery_date",align:"center",width:"100px"},{title:"Total",key:"total_amount",align:"end"}],isAdmin:!1,createdOrder:{order:{}},pagination:{page:1,itemsPerPage:10,sortBy:[],sortDesc:[]},orders:{data:[],total:0,current_page:1,last_page:1},isInitialLoad:!0}},computed:{...W({userIsAdmin:"isAdmin"}),showHeaders(){return this.headers},pendingAmount(){return this.createdOrder&&this.totalPaid<this.createdOrder.order.total_amount?this.createdOrder.order.total_amount-this.totalPaid:0},movementFormTitle(){return this.selectedOrder?`Cambio de estado de orden ${this.selectedOrder.order_number}`:"Cambio de estado de orden"}},async created(){this.checkAdmin(),this.isAdmin&&this.headers.splice(4,0,{title:"Costo",key:"total_cost",align:"end"},{title:"Ganancia",key:"total_profit",align:"end"}),this.isInitialLoad&&this.setDefaultDateRange(),await this.loadData()},methods:{unsetInitialLoad(){this.isInitialLoad=!1},setDefaultDateRange(){const a=new Date().toISOString().split("T")[0],i=new Date;i.setDate(i.getDate()-60),this.defaultDateRange={start:i.toISOString().split("T")[0],end:a}},async updatePaymentStatus(a,i){if(i.id!==a.payment_status.id)try{this.loading=!0;const n=await this.$axios.post(`${this.$routes.orders}/${a.id}`,{data:{payment_status_id:i.id},_method:"PUT"});a.payment_status=i,this.showSnackbar("Estado actualizado correctamente","success")}catch(n){console.error("Error al actualizar estado:",n),this.showSnackbar("Error al actualizar el estado","error"),this.fetchData()}finally{this.loading=!1}},async updateShippingStatus(a,i){if(i.id!==a.shipment_status.id)try{this.loading=!0;const n=await this.$axios.post(`${this.$routes.orders}/${a.id}`,{data:{shipment_status_id:i.id},_method:"PUT"});a.shipment_status=i,this.showSnackbar("Estado actualizado correctamente","success")}catch(n){console.error("Error al actualizar estado:",n),this.showSnackbar("Error al actualizar el estado","error"),this.fetchData()}finally{this.loading=!1}},reset(){this.selectedCustomer=null,this.selectedPaymentStatus=null,this.selectedShipmentStatus=null,this.search="",this.pagination.page=1,this.dateRange={start:null,end:null},this.dateOrderRange={start:null,end:null},this.$nextTick(()=>{this.$refs.dateDeliveryRange&&this.$refs.dateDeliveryRange.reset&&this.$refs.dateDeliveryRange.reset(),this.$refs.dateOrderRange&&this.$refs.dateOrderRange.reset&&this.$refs.dateOrderRange.reset()}),this.fetchData()},handlePaginationChange(a){this.pagination.page=a.page,this.pagination.itemsPerPage=a.itemsPerPage,this.pagination.sortBy=a.sortBy,this.pagination.sortDesc=a.sortDesc,this.fetchData()},async fetchData(){var a,i,n,u,s;this.loading=!0;try{const o={order_number:this.search||void 0,customers:this.selectedCustomer||void 0,payment_status_id:this.selectedPaymentStatus||void 0,shipment_status_id:this.selectedShipmentStatus||void 0,page:this.pagination.page,per_page:this.pagination.itemsPerPage,sort_by:this.pagination.sortBy.length?this.pagination.sortBy[0]:void 0,sort_order:(a=this.pagination.sortDesc)!=null&&a.length?this.pagination.sortDesc[0]?"desc":"asc":void 0};console.log("this.isInitialLoad"),console.log(this.isInitialLoad),this.isInitialLoad&&(o.order_start_date=this.defaultDateRange.start,o.order_end_date=this.defaultDateRange.end),(i=this.dateRange)!=null&&i.start&&((n=this.dateRange)!=null&&n.end)&&(o.delivery_start_date=this.dateRange.start,o.delivery_end_date=this.dateRange.end),(u=this.dateOrderRange)!=null&&u.start&&((s=this.dateOrderRange)!=null&&s.end)&&(o.order_start_date=this.dateOrderRange.start,o.order_end_date=this.dateOrderRange.end),Object.keys(o).forEach(_=>o[_]===void 0&&delete o[_]);const[y]=await Promise.all([this.$axios.get(this.$routes.ordersSearch,{params:o})]);this.orders={data:y.data.data,total:y.data.total,current_page:y.data.current_page,last_page:y.data.last_page}}catch(o){console.error("Error fetching data:",o),this.showSnackbar("Error al cargar los datos","error")}finally{this.loading=!1}},async loadData(){this.loading=!0;try{const[a,i,n]=await Promise.all([this.$axios.get(this.$routes.customers),this.$axios.get(this.$routes.paymentStatuses),this.$axios.get(this.$routes.shipmentStatuses)]);this.customers=a.data.data,this.paymentStatuses=i.data.data,this.shipmentStatuses=n.data.data}catch(a){console.error("Error fetching data:",a),this.showSnackbar("Error al cargar los datos","error")}finally{this.loading=!1}},openPaymentForm(a){this.keyPayments=1,this.createdOrder.order=a,this.paymentFormDialog=!0},closePaymentForm(){this.createdOrder.order={},this.paymentFormDialog=!1},updateTotal(a){this.totalPaid=a,console.log("total pagado:",this.totalPaid),this.change=this.totalPaid>this.createdOrder.order.total_amount?this.totalPaid-this.createdOrder.order.total_amount:0},async validatePayments(a){if(a.length<=0)return"Debe incluir al menos una modalidad de pago";const i=new Set;a.reduce((n,u)=>n+parseFloat(u.amount),0);for(const n of a){if(!n.amount||!n.payment_method_id)return"Verifique la informacion de los pagos";i.add(n.payment_method_id.id)}return!0},async savePayment(){const a=await this.validatePayments(this.$refs.paymentsRow.payments);if(a!==!0)return this.showSnackbar(a,"error");this.savingPayment=!0;try{const i={order_id:this.createdOrder.order.id,payments:this.$refs.paymentsRow.payments};(await this.$axios.post(this.$routes.payments,i)).status==201&&(this.showSnackbar("Pago registrado exitosamente","success"),this.closePaymentForm(),this.fetchData())}catch(i){console.error("Error saving payment:",i),this.showSnackbar("Error al registrar el pago","error")}finally{this.savingPayment=!1}},checkAdmin(){this.isAdmin=this.userIsAdmin},validateStatusChange(a,i){if(!a)return"Debe seleccionar un estado";if(i==1){if(a===this.selectedOrder.payment_status_id)return"El estado de pago seleccionado es igual al estado de pago actual"}else if(a===this.selectedOrder.shipment_status_id)return"El estado de envio seleccionado es igual al estado de envio actual";return!0},normalizeDateToStartOfDay(a){const i=new Date(a);return i.setHours(0,0,0,0),i},normalizeDateToEndOfDay(a){const i=new Date(a);return i.setHours(23,59,59,999),i},parseDdMmYyyyToDate(a){if(!a)return null;const i=a.split(" ")[0],[n,u,s]=i.split("/").map(Number);return isNaN(n)||isNaN(u)||isNaN(s)?null:new Date(Date.UTC(s,u-1,n))},getCustomer(a){return a?a.firstname||a.lastname?`${a.firstname||""} ${a.lastname||""}`.trim():a.address||"Dirección no disponible":"Cliente no disponible"},formatCurrency(a){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(a||0)},openMovementDialog(a){a?this.selectedOrder=a:this.selectedOrder=null,this.movementDialog=!0},closeMovementDialog(){var a;this.movementDialog=!1,(a=this.$refs.movementForm)==null||a.reset()},async saveMovement(){var i,n;if(await this.$refs.movementForm.validate()){this.savingMovement=!0;try{let u,s;u=`${this.$routes.orders}/${this.selectedOrder.id}`,s={data:{payment_status_id:this.movement.payment_status_id,shipment_status_id:this.movement.shipment_status_id},_method:"PUT"},await this.$axios.post(u,s),this.showSnackbar("Estado actualizado correctamente","success"),this.closeMovementDialog(),await this.fetchData()}catch(u){console.error("Error saving movement:",u),this.showSnackbar(((n=(i=u.response)==null?void 0:i.data)==null?void 0:n.message)||"Error al registrar el movimiento","error")}finally{this.savingMovement=!1}}},getStatusColor(a){return{[this.$paymentStatus.PENDING]:"warning",[this.$paymentStatus.PROCESS]:"warning",[this.$paymentStatus.PARTIAL_PAYMENT]:"warning",[this.$paymentStatus.PAID]:"success",[this.$paymentStatus.COMPLETED]:"success",[this.$paymentStatus.APPROVED]:"success"}[a.status.code]||"error"},getStatusCodeColor(a){return{[this.$paymentStatus.PENDING]:"warning",[this.$paymentStatus.PROCESS]:"warning",[this.$paymentStatus.PARTIAL_PAYMENT]:"warning",[this.$paymentStatus.PAID]:"success",[this.$paymentStatus.COMPLETED]:"success",[this.$paymentStatus.APPROVED]:"success"}[a]||"error"},getStatusCodeColorShipping(a){return{[this.$shipmentStatus.NOT_REQUIRED]:"success",[this.$shipmentStatus.DELIVERED]:"success",[this.$shipmentStatus.SHIPPED]:"success",[this.$shipmentStatus.READY_PICKUP]:"warning",[this.$shipmentStatus.PENDING]:"warning",[this.$shipmentStatus.IN_TRANSIT]:"warning",[this.$shipmentStatus.CANCEL]:"error",[this.$shipmentStatus.FAILED]:"error",[this.$shipmentStatus.RETURNED]:"error"}[a]||"error"},isPaid(a){return[this.$paymentStatus.PAID,this.$paymentStatus.COMPLETED,this.$paymentStatus.REJECTED,this.$paymentStatus.CANCEL,this.$paymentStatus.REFUND,this.$paymentStatus.RETURNED].includes(a.status.code)},formatDate(a){return new Date(a).toLocaleString()},formatDateGrid(a){if(!a)return"";const[i,n]=a.split(" ");return`${i} ${n||""}`},getDate(a){return a.toLocaleString().split(" ")[0]},showSnackbar(a,i){this.snackbarText=a,this.snackbarColor=i,this.snackbar=!0},async getDeliveryReport(a){var n;try{if(!this.dateRange.start||!this.dateRange.end){this.showSnackbar("Debe seleccionar un rango de fechas de entrega","error");return}const u=(n=this.shipmentStatuses.find(r=>r.id===this.selectedShipmentStatus))==null?void 0:n.code;if(!u){this.showSnackbar("Debe seleccionar el estado de envio Pendiente para generar el reporte","error");return}if(u!=this.$shipmentStatus.PENDING){this.showSnackbar("Debe seleccionar el estado de envio Pendiente para generar el reporte","error");return}this.loading=!0;const s=a==1?`${this.$routes.ordersDelivery}`:`${this.$routes.ordersCustomersDelivery}`,o={start_date:this.dateRange.start,end_date:this.dateRange.end,shipment_status_id:this.selectedShipmentStatus,customers:this.selectedCustomer},y=await this.$axios.get(s,{params:o,responseType:"blob"});var i=new Blob([y.data],{type:"application/pdf"});const _=window.URL.createObjectURL(i,{oneTimeOnly:!0}),S=document.createElement("a");S.target="_blank",S.href=_,document.body.appendChild(S),S.click()}catch(u){console.error("Error generando reporte:",u),this.showSnackbar("Error al generar la reporte","error")}finally{this.loading=!1}},async showRemito(a){try{this.loading=!0;const n=await this.$axios.get(`${this.$routes.orders}/remito/${a.id}`,{responseType:"blob"});var i=new Blob([n.data],{type:"application/pdf"});const u=window.URL.createObjectURL(i,{oneTimeOnly:!0}),s=document.createElement("a");s.target="_blank",s.href=u,document.body.appendChild(s),s.click()}catch(n){console.error("Error generando factura:",n),this.showSnackbar("Error al generar la factura","error")}finally{this.loading=!1}},async showRemitoComanda(a){try{this.loading=!0;const n=await this.$axios.get(`${this.$routes.orders}/remito-comanda/${a.id}`,{responseType:"blob"});var i=new Blob([n.data],{type:"application/pdf"});const u=window.URL.createObjectURL(i,{oneTimeOnly:!0}),s=document.createElement("a");s.target="_blank",s.href=u,document.body.appendChild(s),s.click()}catch(n){console.error("Error generando factura:",n),this.showSnackbar("Error al generar la factura","error")}finally{this.loading=!1}}}},x=a=>(Z("data-v-811dfc6f"),a=a(),$(),a),re={class:"d-flex flex-column",style:{"min-width":"250px","flex-grow":"1"}},oe=x(()=>l("h2",{class:"text-h5 mb-1"},"Órdenes",-1)),le={class:"text-caption text-medium-emphasis d-flex align-center"},ne=x(()=>l("span",{style:{"white-space":"normal"}}," Inicialmente se muestran las órdenes de los últimos 60 días ",-1)),de={class:"d-flex align-center mx-0 px-0",style:{width:"100px"}},ce={class:"d-flex flex-column text-start"},me={class:"d-block font-weight-medium text-high-emphasis text-truncate"},ue={key:0},he={class:"d-flex flex-column"},pe={class:"font-weight-medium",style:{width:"80px"}},fe={class:"text-disabled",style:{width:"80px"}},_e={key:0},ge={class:"text-right text-error"},ye={class:"text-right text-success"},xe={class:"d-flex flex-column align-center gap-0"},ve={class:"d-flex justify-center align-center gap-0 px-0 mx-0"},be=x(()=>l("span",null,"Detalles de la Orden",-1)),Ce={class:"d-flex flex-wrap gap-2 ml-3"},we={class:"d-flex flex-column"},Se={class:"text-caption text-medium-emphasis"},ke={class:"font-weight-medium"},De={class:"d-flex flex-column"},Pe={class:"text-caption text-medium-emphasis"},Ve={class:"font-weight-medium"},Re={class:"d-flex flex-column"},Ee={class:"text-caption text-medium-emphasis"},Oe={class:"font-weight-medium"},Te=x(()=>l("small",{class:"text-caption"},"items",-1)),Ie={class:"d-flex flex-column"},Fe={class:"text-caption text-medium-emphasis"},Ne={class:"font-weight-medium text-success"},Ae=x(()=>l("span",null,"Información del Cliente",-1)),Ue={class:"d-flex flex-column"},Le={class:"text-caption text-medium-emphasis"},Me={class:"font-weight-medium"},ze={class:"d-flex flex-column"},Be={class:"text-caption text-medium-emphasis"},je={class:"font-weight-medium"},Ge={class:"d-flex flex-column"},He={class:"text-caption text-medium-emphasis"},Ye={class:"font-weight-medium"},qe={key:0,class:"text-primary text-caption"},Je={class:"d-flex flex-column gap-2"},Ke={class:"d-flex justify-space-between"},Qe=x(()=>l("span",{class:"text-caption text-medium-emphasis"},"Total Orden:",-1)),We={class:"font-weight-medium"},Xe={class:"d-flex justify-space-between"},Ze=x(()=>l("span",{class:"text-caption text-medium-emphasis"},"Total Pagado:",-1)),$e={class:"font-weight-medium text-primary"},et={class:"d-flex justify-space-between"},tt=x(()=>l("span",{class:"text-caption text-medium-emphasis"},"Saldo Pendiente:",-1)),st={class:"d-flex justify-space-between"},at=x(()=>l("span",{class:"text-caption text-medium-emphasis"},"Vuelto:",-1)),it={class:"font-weight-medium text-success"},rt={class:"mt-4"};function ot(a,i,n,u,s,o){const y=J,_=X("IconBtn"),S=Q;return p(),v(C,null,{default:t(()=>[e(I,{class:"d-flex flex-wrap align-center justify-space-between ga-2"},{default:t(()=>[l("div",re,[oe,l("div",le,[e(h,{icon:"ri-information-line",size:"16",class:"mr-1"}),ne])])]),_:1}),e(w,{class:"d-flex px-2"},{default:t(()=>[e(te,{headers:o.showHeaders,items:s.orders.data||[],class:"text-no-wrap striped-table border-0",loading:s.loading,"items-per-page":s.pagination.itemsPerPage,page:s.pagination.page,"items-length":s.orders.total||0,"onUpdate:options":o.handlePaginationChange},{top:t(()=>[e(C,{flat:"",color:"white"},{default:t(()=>[e(w,{class:"mx-0 px-0"},{default:t(()=>[e(V,{dense:"",class:"mx-0 px-0"},{default:t(()=>[e(f,{cols:"12",md:"4",sm:"12",class:"pl-0 pt-0"},{default:t(()=>[e(se,{modelValue:s.search,"onUpdate:modelValue":i[0]||(i[0]=r=>s.search=r),label:"Número de Orden",class:"mt-0",density:"compact"},null,8,["modelValue"]),e(R,{modelValue:s.selectedCustomer,"onUpdate:modelValue":i[1]||(i[1]=r=>s.selectedCustomer=r),items:s.customers,"item-title":s.customers.firstname?"firstname":"address","item-value":"id",label:"Clientes",multiple:"",clearable:"",class:"mt-1",density:"compact"},null,8,["modelValue","items","item-title"])]),_:1}),e(f,{cols:"12",md:"4",sm:"12",class:"pl-0 pt-0"},{default:t(()=>[e(R,{modelValue:s.selectedPaymentStatus,"onUpdate:modelValue":i[2]||(i[2]=r=>s.selectedPaymentStatus=r),items:s.paymentStatuses,"item-title":"name","item-value":"id",label:"Estado del pago",clearable:"",class:"mt-0",density:"compact"},null,8,["modelValue","items"]),e(y,{class:"mt-0",ref:"dateOrderRange",modelValue:s.dateOrderRange,"onUpdate:modelValue":i[3]||(i[3]=r=>s.dateOrderRange=r),modelLabel:"Fecha Orden"},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"4",sm:"12",class:"pl-0 pt-0 py-0"},{default:t(()=>[e(R,{modelValue:s.selectedShipmentStatus,"onUpdate:modelValue":i[4]||(i[4]=r=>s.selectedShipmentStatus=r),items:s.shipmentStatuses,"item-title":"name","item-value":"id",label:"Estado entrega",clearable:"",class:"mt-0",density:"compact"},null,8,["modelValue","items"]),e(y,{class:"mt-0 py-0",ref:"dateDeliveryRange",modelValue:s.dateRange,"onUpdate:modelValue":i[5]||(i[5]=r=>s.dateRange=r),modelLabel:"Fecha entrega"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(A,{class:"justify-end"},{default:t(()=>[e(g,{variant:"outlined",color:"primary",onClick:o.reset},{default:t(()=>[d(" Reset ")]),_:1},8,["onClick"]),e(g,{variant:"outlined",color:"white",onClick:i[6]||(i[6]=r=>{o.unsetInitialLoad(),o.fetchData()}),loading:s.loading,class:"bg-primary"},{default:t(()=>[d(" Buscar ")]),_:1},8,["loading"])]),_:1})]),_:1})]),"item.order_number":t(({item:r})=>[l("div",de,[l("div",ce,[l("span",me,c(r.order_number),1),l("small",null,"Productos: "+c(r.quantity_products),1)])])]),"item.customer.firstname":t(({item:r})=>[r.customer.firstname?(p(),b("span",ue,c(r.customer.firstname+" "+r.customer.lastname),1)):k("",!0)]),"item.order_date":t(({item:r})=>[l("div",he,[l("span",pe,c(o.formatDateGrid(r.order_date.split(" ")[0])),1),l("small",fe,c(r.order_date.split(" ")[1]||""),1)])]),"item.delivery_date":t(({item:r})=>[r.shipping&&r.delivery_date?(p(),b("div",_e,c(o.getDate(r.delivery_date)),1)):k("",!0)]),"item.total_cost":t(({item:r})=>[l("div",ge,[l("strong",null,c(o.formatCurrency(r.total_cost)),1)])]),"item.total_profit":t(({item:r})=>[l("div",ye,[l("strong",null,c(o.formatCurrency(r.total_profit)),1)])]),"item.customer":t(({item:r})=>[l("strong",null,c(o.getCustomer(r.customer)),1)]),"item.total_amount":t(({item:r})=>[l("div",{class:E(r.total_profit>0?"text-right text-success":"text-right text-error")},[l("strong",null,c(o.formatCurrency(r.total_amount)),1)],2)]),"item.payment_status_id":t(({item:r})=>[l("div",xe,[e(L,{"offset-y":""},{activator:t(({props:m})=>[e(D,O(m,{color:o.getStatusCodeColor(r.payment_status.code),"prepend-icon":"ri-money-dollar-circle-line",density:"comfortable",class:"my-1 status-chip",style:{width:"150px"}}),{default:t(()=>[d(c(r.payment_status.name)+" ",1),e(h,{icon:"ri-arrow-down-s-line",class:"ml-1"})]),_:2},1040,["color"])]),default:t(()=>[e(M,{density:"compact",class:"py-0"},{default:t(()=>[(p(!0),b(T,null,B(s.paymentStatuses,m=>(p(),v(P,{key:m.id,onClick:K=>o.updatePaymentStatus(r,m),class:"pa-0"},{default:t(()=>[e(D,{color:o.getStatusCodeColor(m.code),"prepend-icon":"ri-money-dollar-circle-line",density:"comfortable",class:E(["ma-1 status-option",`selected-status ${m.id===r.payment_status.id?"selected-status":""}`]),style:{width:"150px"}},{default:t(()=>[d(c(m.name)+" ",1),m.id===r.payment_status.id?(p(),v(h,{key:0,icon:"ri-check-line",class:"ml-1"})):k("",!0)]),_:2},1032,["color","class"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024),e(L,{"offset-y":""},{activator:t(({props:m})=>[e(D,O(m,{color:o.getStatusCodeColorShipping(r.shipment_status.code),"prepend-icon":"ri-truck-line",density:"comfortable",class:"my-1 status-chip",style:{width:"150px"}}),{default:t(()=>[d(c(r.shipment_status.name)+" ",1),e(h,{icon:"ri-arrow-down-s-line",class:"ml-1"})]),_:2},1040,["color"])]),default:t(()=>[e(M,{density:"compact",class:"py-0"},{default:t(()=>[(p(!0),b(T,null,B(s.shipmentStatuses,m=>(p(),v(P,{key:m.id,onClick:K=>o.updateShippingStatus(r,m),class:"pa-0"},{default:t(()=>[e(D,{color:o.getStatusCodeColorShipping(m.code),"prepend-icon":"ri-truck-line",density:"comfortable",class:E(["ma-1 status-option",`selected-status ${m.id===r.shipment_status.id?"selected-status":""}`]),style:{width:"150px"}},{default:t(()=>[d(c(m.name)+" ",1),m.id===r.shipment_status.id?(p(),v(h,{key:0,icon:"ri-check-line",class:"ml-1"})):k("",!0)]),_:2},1032,["color","class"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)])]),"item.actions":t(({item:r})=>[l("div",ve,[e(L,{"offset-y":"",transition:"scale-transition"},{activator:t(({props:m})=>[e(_,O({size:"small"},m),{default:t(()=>[e(h,{icon:"ri-more-2-fill"})]),_:2},1040)]),default:t(()=>[e(M,null,{default:t(()=>[e(P,{onClick:m=>o.showRemito(r)},{default:t(()=>[e(F,null,{default:t(()=>[e(_,{size:"small",class:"my-1",title:"Remito"},{default:t(()=>[e(h,{icon:"ri-file-pdf-2-line"})]),_:1}),d("Remito ")]),_:1})]),_:2},1032,["onClick"]),e(P,{onClick:m=>o.showRemitoComanda(r)},{default:t(()=>[e(F,null,{default:t(()=>[e(_,{size:"small",class:"my-1",title:"Comanda"},{default:t(()=>[e(h,{icon:"ri-file-pdf-2-line"})]),_:1}),d("Comanda ")]),_:1})]),_:2},1032,["onClick"]),e(P,{onClick:m=>o.openMovementDialog(r)},{default:t(()=>[e(F,null,{default:t(()=>[e(_,{size:"small",class:"my-1",title:"Cambiar el estado de la orden",onClick:m=>o.openMovementDialog(r)},{default:t(()=>[e(h,{icon:"ri-swap-box-line"})]),_:2},1032,["onClick"]),d("Cambiar estado ")]),_:2},1024)]),_:2},1032,["onClick"]),o.isPaid(r)?k("",!0):(p(),v(P,{key:0,onClick:m=>o.openPaymentForm(r)},{default:t(()=>[e(F,null,{default:t(()=>[e(_,{size:"small",class:"my-1",title:"Registrar Pago",onClick:m=>o.openPaymentForm(r)},{default:t(()=>[e(h,{icon:"ri-money-dollar-circle-line"})]),_:2},1032,["onClick"]),d("Registrar Pago ")]),_:2},1024)]),_:2},1032,["onClick"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["headers","items","loading","items-per-page","page","items-length","onUpdate:options"]),e(H,{modelValue:s.movementDialog,"onUpdate:modelValue":i[10]||(i[10]=r=>s.movementDialog=r),"max-width":"800px",persistent:""},{default:t(()=>[e(C,{class:"rounded-lg"},{default:t(()=>[e(j,{color:"primary",density:"compact"},{default:t(()=>[e(G,{class:"text-white font-weight-medium"},{default:t(()=>[e(g,{icon:"",variant:"text",color:"white",onClick:o.closeMovementDialog},{default:t(()=>[e(h,null,{default:t(()=>[d("ri-close-line")]),_:1})]),_:1},8,["onClick"]),d(" "+c(o.movementFormTitle),1)]),_:1})]),_:1}),e(Y,{ref:"movementForm",modelValue:s.validMovement,"onUpdate:modelValue":i[9]||(i[9]=r=>s.validMovement=r)},{default:t(()=>[e(w,{class:"px-4 pt-4 pb-2"},{default:t(()=>[e(C,{flat:"",border:"",class:"mb-4",color:"primary-lighten-5"},{default:t(()=>[e(U,{class:"py-0 mt-2"},{default:t(()=>[e(I,{class:"d-flex align-center"},{default:t(()=>[e(z,{icon:"ri-inbox-unarchive-line",class:"text-info mr-2",variant:"tonal"}),be,l("div",Ce,[e(D,{color:o.getStatusCodeColor(s.selectedOrder.payment_status.code),size:"small",class:"font-weight-medium"},{default:t(()=>[e(h,{icon:"ri-money-dollar-circle-line",class:"mr-1"}),d(" "+c(s.selectedOrder.payment_status.name),1)]),_:1},8,["color"]),e(D,{color:o.getStatusCodeColorShipping(s.selectedOrder.shipment_status.code),size:"small",class:"font-weight-medium"},{default:t(()=>[e(h,{icon:"ri-truck-line",class:"mr-1"}),d(" "+c(s.selectedOrder.shipment_status.name),1)]),_:1},8,["color"])])]),_:1})]),_:1}),e(N,{class:"my-1"}),e(w,null,{default:t(()=>[e(V,{dense:""},{default:t(()=>[e(f,{cols:"6",sm:"3"},{default:t(()=>[l("div",we,[l("span",Se,[e(h,{icon:"ri-hashtag",size:"14",class:"mr-1"}),d(" Número ")]),l("span",ke,c(s.selectedOrder.order_number),1)])]),_:1}),e(f,{cols:"6",sm:"3"},{default:t(()=>[l("div",De,[l("span",Pe,[e(h,{icon:"ri-calendar-line",size:"14",class:"mr-1"}),d(" Fecha ")]),l("span",Ve,c(s.selectedOrder.order_date),1)])]),_:1}),e(f,{cols:"6",sm:"3"},{default:t(()=>[l("div",Re,[l("span",Ee,[e(h,{icon:"ri-archive-line",size:"14",class:"mr-1"}),d(" Productos ")]),l("span",Oe,[d(c(s.selectedOrder.quantity_products)+" ",1),Te])])]),_:1}),e(f,{cols:"6",sm:"3"},{default:t(()=>[l("div",Ie,[l("span",Fe,[e(h,{icon:"ri-money-dollar-circle-line",size:"14",class:"mr-1"}),d(" Total ")]),l("span",Ne,c(o.formatCurrency(s.selectedOrder.total_amount)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{flat:"",border:"",class:"mb-4",color:"grey-lighten-4"},{default:t(()=>[e(U,{class:"py-0 mt-2"},{default:t(()=>[e(I,{class:"d-flex align-center"},{default:t(()=>[e(z,{icon:"ri-user-line",class:"text-info mr-2",variant:"tonal"}),Ae]),_:1})]),_:1}),e(N,{class:"my-1"}),e(w,null,{default:t(()=>[e(V,{dense:""},{default:t(()=>[e(f,{cols:"12",md:"4"},{default:t(()=>[l("div",Ue,[l("span",Le,[e(h,{icon:"ri-user-3-line",size:"14",class:"mr-1"}),d(" Nombre ")]),l("span",Me,c(s.selectedOrder.customer.firstname)+" "+c(s.selectedOrder.customer.lastname),1)])]),_:1}),e(f,{cols:"12",md:"4"},{default:t(()=>[l("div",ze,[l("span",Be,[e(h,{icon:"ri-map-pin-line",size:"14",class:"mr-1"}),d(" Dirección ")]),l("span",je,c(s.selectedOrder.customer.address||"No especificada"),1)])]),_:1}),e(f,{cols:"12",md:"4"},{default:t(()=>[l("div",Ge,[l("span",He,[e(h,{icon:"ri-phone-line",size:"14",class:"mr-1"}),d(" Contacto ")]),l("span",Ye,c(s.selectedOrder.customer.telephone||"Sin teléfono"),1),s.selectedOrder.customer.email?(p(),b("span",qe,[e(h,{icon:"ri-mail-line",size:"12",class:"mr-1"}),d(" "+c(s.selectedOrder.customer.email),1)])):k("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),e(V,null,{default:t(()=>[e(f,{cols:"12",md:"6",sm:"6"},{default:t(()=>[e(R,{modelValue:s.movement.payment_status_id,"onUpdate:modelValue":i[7]||(i[7]=r=>s.movement.payment_status_id=r),items:s.paymentStatuses,"item-title":"name","item-value":"id",label:"Estado del pago",rules:[o.validateStatusChange(s.movement.payment_status_id,1)],variant:"outlined",class:"mt-2",clearable:""},null,8,["modelValue","items","rules"])]),_:1}),e(f,{cols:"12",md:"6",sm:"6"},{default:t(()=>[e(R,{modelValue:s.movement.shipment_status_id,"onUpdate:modelValue":i[8]||(i[8]=r=>s.movement.shipment_status_id=r),items:s.shipmentStatuses,"item-title":"name","item-value":"id",label:"Estado de la entrega",rules:[o.validateStatusChange(s.movement.shipment_status_id,2)],variant:"outlined",class:"mt-2",clearable:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(q),e(g,{variant:"outlined",color:"primary",onClick:o.closeMovementDialog},{default:t(()=>[d(" Cancelar ")]),_:1},8,["onClick"]),e(g,{color:"white",class:"bg-primary",onClick:o.saveMovement,loading:s.savingMovement,disabled:!s.validMovement},{default:t(()=>[d(" Actualizar Estado ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(H,{modelValue:s.paymentFormDialog,"onUpdate:modelValue":i[12]||(i[12]=r=>s.paymentFormDialog=r),"max-width":"600px",persistent:""},{default:t(()=>[e(C,{class:"rounded-lg"},{default:t(()=>[e(j,{color:"primary",density:"compact",class:"ml-0 pl-0"},{default:t(()=>[e(G,{class:"text-h6 font-weight-medium text-white"},{default:t(()=>[e(g,{icon:"ri-close-line",color:"white",onClick:o.closePaymentForm},null,8,["onClick"]),d(" Registrar Pago ")]),_:1}),e(q),e(g,{icon:"",variant:"text",color:"white",onClick:o.closePaymentForm},{default:t(()=>[e(h,null,{default:t(()=>[d("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),e(Y,{ref:"paymentForm",modelValue:s.validPayment,"onUpdate:modelValue":i[11]||(i[11]=r=>s.validPayment=r)},{default:t(()=>[e(w,{class:"px-4 pt-4 pb-2"},{default:t(()=>[e(C,{flat:"",class:"border",color:"surface"},{default:t(()=>[e(U,{class:"py-2"},{default:t(()=>[e(I,{class:"text-subtitle-1 font-weight-medium d-flex align-center"},{default:t(()=>[e(z,{icon:"ri-money-dollar-circle-line",class:"text-primary mr-2",variant:"tonal"}),d(" Resumen de Pagos ")]),_:1})]),_:1}),e(N),e(w,{class:"px-2 py-3"},{default:t(()=>{var r,m;return[l("div",Je,[l("div",Ke,[Qe,l("span",We,c(o.formatCurrency((m=(r=s.createdOrder)==null?void 0:r.order)==null?void 0:m.total_amount)),1)]),l("div",Xe,[Ze,l("span",$e,c(o.formatCurrency(s.totalPaid)),1)]),l("div",et,[tt,l("span",{class:E(["font-weight-medium",o.pendingAmount>0?"text-error":"text-success"])},c(o.formatCurrency(o.pendingAmount)),3)]),e(N,{class:"my-1"}),l("div",st,[at,l("span",it,c(o.formatCurrency(s.change)),1)])])]}),_:1})]),_:1}),l("div",rt,[(p(),v(S,{ref:"paymentsRow",key:s.keyPayments,records:s.createdOrder.order.payment,modulo:"pagos",onUpdateTotal:o.updateTotal},null,8,["records","onUpdateTotal"]))])]),_:1}),e(A,{class:"px-4 pb-4 pt-2"},{default:t(()=>[e(V,null,{default:t(()=>[e(f,{cols:"12",md:"12",sm:"12",class:"pt-4 pb-0 my-0"},{default:t(()=>[e(g,{variant:"outlined",color:"primary",onClick:o.closePaymentForm,class:"text-capitalize",block:""},{default:t(()=>[d(" Cancelar ")]),_:1},8,["onClick"])]),_:1}),e(f,{cols:"12",md:"12",sm:"12",class:"pt-1 my-0 pb-2"},{default:t(()=>[e(g,{onClick:o.savePayment,loading:s.savingPayment,disabled:!s.validPayment,color:"white",class:"bg-primary text-capitalize",block:""},{default:t(()=>[s.savingPayment?(p(),b(T,{key:1},[d(" Procesando... ")],64)):(p(),b(T,{key:0},[e(h,{icon:"mdi-check-circle-outline",class:"mr-1"}),d(" Confirmar Pago ")],64))]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(ae,{modelValue:s.snackbar,"onUpdate:modelValue":i[14]||(i[14]=r=>s.snackbar=r),color:s.snackbarColor,timeout:3e3},{action:t(({attrs:r})=>[e(g,O({text:""},r,{onClick:i[13]||(i[13]=m=>s.snackbar=!1)}),{default:t(()=>[d(" Cerrar ")]),_:2},1040)]),default:t(()=>[d(c(s.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})]),_:1})}const Ot=ee(ie,[["render",ot],["__scopeId","data-v-811dfc6f"]]);export{Ot as default};

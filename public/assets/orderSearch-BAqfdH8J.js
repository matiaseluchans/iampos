import{_ as W}from"./PaymentsRow-B9Po7Lk0.js";import{_ as Q}from"./DateRangeField-rHtEFvtq.js";import{o as p,e as b,w as s,b as e,a as o,a3 as _,af as B,V as u,H as c,t as d,u as X,ac as $,v as j,c as v,l as x,n as T,a0 as F,k as ee,F as U,x as te,y as se}from"./main-D-FNcJ5Q.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ae}from"./VImg-LIdzWOkd.js";import{c as E,V as w,d as A,a as k,b as L}from"./VCard-B9H2nVrW.js";import{V as N}from"./VDialog-B_5yp4IB.js";import{V as le}from"./VDataTable-Dm3sGLe9.js";import{a as P,V as f}from"./VRow-Ccs27aI9.js";import{V as re}from"./VTextField-Cxefcz0w.js";import{V}from"./VAutocomplete-DztI00yR.js";import{e as R,V as H,a as q,b as S,c as O}from"./VChip-BHUHjEql.js";import{a as G,b as Y,V as oe}from"./VSnackbar-VJSLefhp.js";import{V as J}from"./VForm-BQmVpmiY.js";import{V as M}from"./VAvatar-yRb2AyES.js";import{V as I}from"./VDivider-D4qvZZu2.js";import{V as K}from"./VSpacer-DOVH59ZK.js";import"./VOverlay-Du9Mdrcw.js";import"./easing-DY7PVvcf.js";import"./lazy-beIlw_aA.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-iYd76WP_.js";import"./VCheckboxBtn-BGEB4GOz.js";import"./VTable-D0vxZhBM.js";import"./index-BnInBex3.js";import"./ssrBoot-BsWm5Mof.js";const ie="/assets/logo1-Dqo9asqZ.png",ne={class:"container_header"},de={class:"one"},ce={class:"two"},me=["innerHTML"],ue=["innerHTML"],he={props:{value:{type:Boolean,default:!1},icon:{type:String,required:!0},color:{type:String,required:!0},title:{type:String,required:!0},info:{type:String,default:!1}},data(){return{dialog:this.value}},watch:{value(t){this.dialog=t},dialog(t){this.$emit("input",t)}},methods:{closeDialog(){this.dialog=!1,this.$emit("close")},confirm(){this.$emit("confirm"),this.closeDialog()}}},pe=Object.assign(he,{__name:"Confirm",setup(t){return(a,n)=>(p(),b(N,{modelValue:a.dialog,"onUpdate:modelValue":n[0]||(n[0]=m=>a.dialog=m),"max-width":"500px",persistent:""},{default:s(()=>[e(k,{class:"pa-4",style:{position:"relative"}},{default:s(()=>[o("div",ne,[o("div",de,[e(_,{class:"ml-3 mt-1",dark:"",elevation:"0",fab:"",icon:"","x-large":"",color:`${t.color}45`,style:B({pointerEvents:"none",background:`${t.color}45`})},{default:s(()=>[e(u,{color:t.color,class:"text-center",style:{"font-size":"30px","pointer-events":"none"}},{default:s(()=>[c(d(t.icon),1)]),_:1},8,["color"])]),_:1},8,["color","style"])]),o("div",ce,[e(ae,{"max-height":"100px","max-width":"100px",src:X(ie),cover:""},null,8,["src"])])]),e(E,{class:"headline"},{default:s(()=>[o("p",{class:"text-left capitalize-first custom-btn mt-2",style:{"font-weight":"500","font-size":"18px"},innerHTML:t.title},null,8,me)]),_:1}),e(w,null,{default:s(()=>[o("p",{style:{"font-weight":"400",color:"#7D7D7D"},class:"mt-4",innerHTML:t.info},null,8,ue)]),_:1}),e(A,{style:{background:"#F1F1F1"},class:"mt-4 pt-4 pb-4"},{default:s(()=>[e(_,{width:"47%",style:{backgroundColor:"white"},onClick:a.closeDialog,class:"capitalize-first custom-btn"},{default:s(()=>[c(" Cancelar ")]),_:1},8,["onClick"]),e(_,{width:"51%",color:"white",dark:"",onClick:a.confirm,style:B({backgroundColor:t.color}),class:"capitalize-first custom-btn"},{default:s(()=>[c(" Sí, estoy seguro ")]),_:1},8,["onClick","style"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),fe=Z(pe,[["__scopeId","data-v-ee7a9a56"]]),_e={components:{DateRangeField:Q,DialogConfirmar:fe},data(){return{keyPayments:1,validPayment:!1,savingPayment:!1,change:0,totalPaid:0,payment:{amount:0,payment_method_id:null,notes:""},dateRange:{start:null,end:null},dateOrderRange:{start:null,end:null},defaultDateRange:{},loading:!1,search:"",customers:[],sellers:[],selectedSeller:null,paymentStatuses:[],shipmentStatuses:[],selectedCustomer:null,selectedPaymentStatus:null,selectedShipmentStatus:null,selectedOrder:null,movementDialog:!1,paymentFormDialog:!1,validMovement:!1,savingMovement:!1,movement:{status_id:null},snackbar:!1,snackbarText:"",snackbarColor:"success",headers:[{title:"",key:"actions",sortable:!1,align:"left",width:"0px",cellProps:{class:"actions-cell"}},{title:"Orden",key:"order_number",width:"60px"},{title:"Fecha",key:"order_date",align:"center",width:"60px"},{title:"Cliente",key:"customer",width:"70%"},{title:"Total",key:"total_amount",align:"end"},{title:"Pagado",key:"total_paid",align:"end"},{title:"Vendedor",key:"seller_name",width:"10%"},{title:"Fecha Entrega",key:"delivery_date",align:"center",width:"100px"}],isAdmin:!1,createdOrder:{order:{}},pagination:{page:1,itemsPerPage:10,sortBy:[],sortDesc:[]},orders:{data:[],total:0,current_page:1,last_page:1},isInitialLoad:!0,dialogs:{cancelOrden:!1}}},computed:{...$({userIsAdmin:"isAdmin"}),showHeaders(){return this.headers},pendingAmount(){return this.createdOrder&&this.totalPaid<this.createdOrder.order.total_amount?this.createdOrder.order.total_amount-this.totalPaid:0},movementFormTitle(){return this.selectedOrder?`Cambio de estado de orden ${this.selectedOrder.order_number}`:"Cambio de estado de orden"}},async created(){this.checkAdmin(),this.isAdmin&&this.headers.splice(5,0,{title:"Costo",key:"total_cost",align:"end"},{title:"Ganancia",key:"total_profit",align:"end"}),(this.isAdmin||this.$is("petshop-user"))&&this.headers.push({title:"Estados",key:"payment_status_id",align:"center"}),this.isInitialLoad&&this.setDefaultDateRange(),await this.loadData()},methods:{handleSelection(){setTimeout(()=>{this.$refs.autocompleteRef&&(this.$refs.autocompleteRef.blur(),this.$refs.autocompleteRef.focus())},100)},closeDialog(t){this.dialogs[t]=!1,this.selectedOrder=null},dialogCancelOrden(t){if(!t){this.showSnackbar("No hay orden seleccionada para cancelar","error");return}console.log("Abriendo diálogo de cancelación para la orden:",t),this.selectedOrder=t,this.dialogs.cancelOrden=!0},async confirmCancelOrden(){console.log("Confirmando cancelación de orden:",this.selectedOrder);try{this.loading=!0;const t=await this.$axios.post(`${this.$routes.ordersCancel}/${this.selectedOrder.id}`,{data:{form:this.selectedOrder,_method:"PUT"}});this.showSnackbar("Se ha cancelado la orden","success")}catch(t){console.error("Error al actualizar estado:",t),this.showSnackbar("Error al actualizar el estado","error")}finally{this.closeDialog("cancelOrden"),this.loading=!1,this.fetchData()}},calculateTotalAmount(){return this.orders.data?this.orders.data.reduce((t,a)=>t+(parseFloat(a.total_amount)||0),0).toFixed(2):0},calculateTotalPaid(){return this.orders.data?this.orders.data.reduce((t,a)=>t+(parseFloat(a.total_paid)||0),0).toFixed(2):0},calculateTotalCost(){return this.orders.data?this.orders.data.reduce((t,a)=>t+(parseFloat(a.total_cost)||0),0).toFixed(2):0},calculateTotalProfit(){return this.orders.data?this.orders.data.reduce((t,a)=>t+(parseFloat(a.total_profit)||0),0).toFixed(2):0},calculateTotalProducts(){return this.orders.data?this.orders.data.reduce((t,a)=>t+(a.quantity_products||0),0):0},unsetInitialLoad(){this.isInitialLoad=!1},setDefaultDateRange(){const t=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()-60),this.defaultDateRange={start:a.toISOString().split("T")[0],end:t}},async updatePaymentStatus(t,a){if(a.id!==t.payment_status.id)try{this.loading=!0;const n=await this.$axios.post(`${this.$routes.orders}/${t.id}`,{data:{payment_status_id:a.id,_method:"PUT"}});t.payment_status=a,this.showSnackbar("Estado actualizado correctamente","success")}catch(n){console.error("Error al actualizar estado:",n),this.showSnackbar("Error al actualizar el estado","error"),this.fetchData()}finally{this.loading=!1}},async updateShippingStatus(t,a){if(a.id!==t.shipment_status.id)try{this.loading=!0;const n=await this.$axios.post(`${this.$routes.orders}/${t.id}`,{data:{shipment_status_id:a.id,_method:"PUT"}});t.shipment_status=a,this.showSnackbar("Estado actualizado correctamente","success")}catch(n){console.error("Error al actualizar estado:",n),this.showSnackbar("Error al actualizar el estado","error")}finally{this.loading=!1,this.fetchData()}},reset(){this.selectedCustomer=null,this.selectedSeller=null,this.selectedPaymentStatus=null,this.selectedShipmentStatus=null,this.search="",this.pagination.page=1,this.dateRange={start:null,end:null},this.dateOrderRange={start:null,end:null},this.$nextTick(()=>{this.$refs.dateDeliveryRange&&this.$refs.dateDeliveryRange.reset&&this.$refs.dateDeliveryRange.reset(),this.$refs.dateOrderRange&&this.$refs.dateOrderRange.reset&&this.$refs.dateOrderRange.reset()}),this.fetchData()},handlePaginationChange(t){this.pagination.page=t.page,this.pagination.itemsPerPage=t.itemsPerPage,this.pagination.sortBy=t.sortBy,this.pagination.sortDesc=t.sortDesc,this.fetchData()},async fetchData(){var t,a,n,m,l;this.loading=!0;try{const i={order_number:this.search||void 0,customers:this.selectedCustomer||void 0,sellers:this.selectedSeller||void 0,payment_status_id:this.selectedPaymentStatus||void 0,shipment_status_id:this.selectedShipmentStatus||void 0,page:this.pagination.page,per_page:this.pagination.itemsPerPage,sort_by:this.pagination.sortBy.length?this.pagination.sortBy[0]:void 0,sort_order:(t=this.pagination.sortDesc)!=null&&t.length?this.pagination.sortDesc[0]?"desc":"asc":void 0};console.log("this.isInitialLoad"),console.log(this.isInitialLoad),this.isInitialLoad&&(i.order_start_date=this.defaultDateRange.start,i.order_end_date=this.defaultDateRange.end),(a=this.dateRange)!=null&&a.start&&((n=this.dateRange)!=null&&n.end)&&(i.delivery_start_date=this.dateRange.start,i.delivery_end_date=this.dateRange.end),(m=this.dateOrderRange)!=null&&m.start&&((l=this.dateOrderRange)!=null&&l.end)&&(i.order_start_date=this.dateOrderRange.start,i.order_end_date=this.dateOrderRange.end),Object.keys(i).forEach(g=>i[g]===void 0&&delete i[g]);const[C]=await Promise.all([this.$axios.get(this.$routes.ordersSearch,{params:i})]);this.orders={data:C.data.data,total:C.data.total,current_page:C.data.current_page,last_page:C.data.last_page}}catch(i){console.error("Error fetching data:",i),this.showSnackbar("Error al cargar los datos","error")}finally{this.loading=!1}},async loadData(){this.loading=!0;try{const[t,a,n,m]=await Promise.all([this.$axios.get(this.$routes.customers),this.$axios.get(this.$routes.paymentStatuses),this.$axios.get(this.$routes.shipmentStatuses),this.$axios.get(this.$routes.usersList)]);this.customers=t.data.data,this.sellers=m.data.data,this.paymentStatuses=a.data.data.filter(l=>l.code!="cancelled"&&l.code!="refund"),this.shipmentStatuses=n.data.data.filter(l=>l.code!="cancelled")}catch(t){console.error("Error fetching data:",t),this.showSnackbar("Error al cargar los datos","error")}finally{this.loading=!1}},openPaymentForm(t){this.keyPayments=1,this.createdOrder.order=t,this.paymentFormDialog=!0},closePaymentForm(){this.createdOrder.order={},this.paymentFormDialog=!1},updateTotal(t){this.totalPaid=t,console.log("total pagado:",this.totalPaid),this.change=this.totalPaid>this.createdOrder.order.total_amount?this.totalPaid-this.createdOrder.order.total_amount:0},async validatePayments(t){if(console.log(t),t.length<=0)return"Debe incluir al menos una modalidad de pago";const a=new Set;t.reduce((n,m)=>n+parseFloat(m.amount),0);for(const n of t){if(!n.amount||!n.payment_method_id)return"Verifique la informacion de los pagos";a.add(n.payment_method_id.id)}return!0},async savePayment(){const t=await this.validatePayments(this.$refs.paymentsRow.newPayments);if(t!==!0)return this.showSnackbar(t,"error");this.savingPayment=!0;try{const a={order_id:this.createdOrder.order.id,payments:this.$refs.paymentsRow.newPayments};(await this.$axios.post(this.$routes.payments,a)).status==201&&(this.showSnackbar("Pago registrado exitosamente","success"),this.closePaymentForm(),this.fetchData())}catch(a){console.error("Error saving payment:",a),this.showSnackbar("Error al registrar el pago","error")}finally{this.savingPayment=!1}},checkAdmin(){this.isAdmin=this.userIsAdmin},validateStatusChange(t,a){if(!t)return"Debe seleccionar un estado";if(a==1){if(t===this.selectedOrder.payment_status_id)return"El estado de pago seleccionado es igual al estado de pago actual"}else if(t===this.selectedOrder.shipment_status_id)return"El estado de envio seleccionado es igual al estado de envio actual";return!0},normalizeDateToStartOfDay(t){const a=new Date(t);return a.setHours(0,0,0,0),a},normalizeDateToEndOfDay(t){const a=new Date(t);return a.setHours(23,59,59,999),a},parseDdMmYyyyToDate(t){if(!t)return null;const a=t.split(" ")[0],[n,m,l]=a.split("/").map(Number);return isNaN(n)||isNaN(m)||isNaN(l)?null:new Date(Date.UTC(l,m-1,n))},getCustomer(t){return t?t.firstname||t.lastname?`${t.firstname||""} ${t.lastname||""}`.trim():t.address||"Dirección no disponible":"Cliente no disponible"},formatCurrency(t){return t?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:0}).format(t):"$0"},openMovementDialog(t){t?this.selectedOrder=t:this.selectedOrder=null,this.movementDialog=!0},closeMovementDialog(){var t;this.movementDialog=!1,(t=this.$refs.movementForm)==null||t.reset()},async saveMovement(){var a,n;if(await this.$refs.movementForm.validate()){this.savingMovement=!0;try{let m,l;m=`${this.$routes.orders}/${this.selectedOrder.id}`,l={data:{payment_status_id:this.movement.payment_status_id,shipment_status_id:this.movement.shipment_status_id,_method:"PUT"}},await this.$axios.post(m,l),this.showSnackbar("Estado actualizado correctamente","success"),this.closeMovementDialog(),await this.fetchData()}catch(m){console.error("Error saving movement:",m),this.showSnackbar(((n=(a=m.response)==null?void 0:a.data)==null?void 0:n.message)||"Error al registrar el movimiento","error")}finally{this.savingMovement=!1}}},getStatusColor(t){return{[this.$paymentStatus.PENDING]:"warning",[this.$paymentStatus.PROCESS]:"warning",[this.$paymentStatus.PARTIAL_PAYMENT]:"warning",[this.$paymentStatus.PAID]:"success",[this.$paymentStatus.COMPLETED]:"success",[this.$paymentStatus.APPROVED]:"success"}[t.status.code]||"error"},getStatusCodeColor(t){return{[this.$paymentStatus.PENDING]:"warning",[this.$paymentStatus.PROCESS]:"warning",[this.$paymentStatus.PARTIAL_PAYMENT]:"warning",[this.$paymentStatus.PAID]:"success",[this.$paymentStatus.COMPLETED]:"success",[this.$paymentStatus.APPROVED]:"success"}[t]||"error"},getStatusCodeColorShipping(t){return{[this.$shipmentStatus.NOT_REQUIRED]:"success",[this.$shipmentStatus.DELIVERED]:"success",[this.$shipmentStatus.SHIPPED]:"success",[this.$shipmentStatus.READY_PICKUP]:"warning",[this.$shipmentStatus.PENDING]:"warning",[this.$shipmentStatus.IN_TRANSIT]:"warning",[this.$shipmentStatus.CANCEL]:"error",[this.$shipmentStatus.FAILED]:"error",[this.$shipmentStatus.RETURNED]:"error"}[t]||"error"},isPaid(t){return[this.$paymentStatus.PAID,this.$paymentStatus.COMPLETED,this.$paymentStatus.REJECTED,this.$paymentStatus.CANCEL,this.$paymentStatus.REFUND,this.$paymentStatus.RETURNED].includes(t.status.code)},formatDate(t){return new Date(t).toLocaleString()},formatDateGrid(t){if(!t)return"";const[a,n]=t.split(" ");return`${a} ${n||""}`},getDate(t){return t.toLocaleString().split(" ")[0]},showSnackbar(t,a){this.snackbarText=t,this.snackbarColor=a,this.snackbar=!0},async getDeliveryReport(t){var n;try{if(!this.dateRange.start||!this.dateRange.end){this.showSnackbar("Debe seleccionar un rango de fechas de entrega","error");return}const m=(n=this.shipmentStatuses.find(z=>z.id===this.selectedShipmentStatus))==null?void 0:n.code;if(!m){this.showSnackbar("Debe seleccionar el estado de envio Pendiente para generar el reporte","error");return}if(m!=this.$shipmentStatus.PENDING){this.showSnackbar("Debe seleccionar el estado de envio Pendiente para generar el reporte","error");return}this.loading=!0;const l=t==1?`${this.$routes.ordersDelivery}`:`${this.$routes.ordersCustomersDelivery}`,i={start_date:this.dateRange.start,end_date:this.dateRange.end,shipment_status_id:this.selectedShipmentStatus,customers:this.selectedCustomer,sellers:this.selectedSeller},C=await this.$axios.get(l,{params:i,responseType:"blob"});var a=new Blob([C.data],{type:"application/pdf"});const g=window.URL.createObjectURL(a,{oneTimeOnly:!0}),D=document.createElement("a");D.target="_blank",D.href=g,document.body.appendChild(D),D.click()}catch(m){console.error("Error generando reporte:",m),this.showSnackbar("Error al generar la reporte","error")}finally{this.loading=!1}},async editOrder(t){try{this.loading=!0,this.$router.push({path:"/order-create",query:{edit:!0,orderId:t.id}})}catch(a){console.error("Error al obtener datos de la orden:",a),this.showSnackbar("Error al cargar la orden para edición","error")}finally{this.loading=!1}},async showRemito(t){try{this.loading=!0;const n=await this.$axios.get(`${this.$routes.orders}/remito/${t.id}`,{responseType:"blob"});var a=new Blob([n.data],{type:"application/pdf"});const m=window.URL.createObjectURL(a,{oneTimeOnly:!0}),l=document.createElement("a");l.target="_blank",l.href=m,document.body.appendChild(l),l.click()}catch(n){console.error("Error generando factura:",n),this.showSnackbar("Error al generar la factura","error")}finally{this.loading=!1}},async showRemitoComanda(t){try{this.loading=!0;const n=await this.$axios.get(`${this.$routes.orders}/remito-comanda/${t.id}`,{responseType:"blob"});var a=new Blob([n.data],{type:"application/pdf"});const m=window.URL.createObjectURL(a,{oneTimeOnly:!0}),l=document.createElement("a");l.target="_blank",l.href=m,document.body.appendChild(l),l.click()}catch(n){console.error("Error generando factura:",n),this.showSnackbar("Error al generar la factura","error")}finally{this.loading=!1}}}},y=t=>(te("data-v-e99cc504"),t=t(),se(),t),ge={class:"d-flex flex-column",style:{"min-width":"250px","flex-grow":"1"}},ye=y(()=>o("h2",{class:"text-h5 mb-1"},"Órdenes",-1)),xe={class:"text-caption text-medium-emphasis d-flex align-center"},ve=y(()=>o("span",{style:{"white-space":"normal"}}," Inicialmente se muestran las órdenes de los últimos 60 días ",-1)),Ce={class:"d-flex align-center mx-0 px-0",style:{width:"100px"}},be={class:"d-flex flex-column text-start"},we={class:"d-block font-weight-medium text-high-emphasis text-truncate"},ke={key:0},Se={class:"d-flex flex-column"},De={class:"font-weight-medium",style:{width:"80px"}},Pe={class:"text-disabled",style:{width:"80px"}},Ve={key:0},Oe={class:"text-right text-error"},Re={class:"text-right text-success"},Ee={class:"d-flex flex-column text-start"},Te={class:"d-block font-weight-medium text-high-emphasis text-truncate"},Fe={class:"d-flex flex-column align-center gap-0"},Ie={class:"d-flex justify-center align-center gap-0 px-0 mx-0"},Ae={class:"bg-grey-lighten-4 font-weight-bold",style:{background:"#ccc"}},ze=y(()=>o("td",{class:"text-left"},null,-1)),Ue=["colspan"],Le={class:"d-flex align-center mx-0 px-0",style:{width:"100px"}},Me={class:"d-flex flex-column text-start"},Ne={class:"d-block font-weight-medium text-high-emphasis text-truncate"},Be={key:0,class:"text-right"},je={class:"text-right"},He={key:1,class:"text-right"},qe={key:2,class:"text-right"},Ge={class:"text-right"},Ye={key:3,class:"text-right"},Je=y(()=>o("td",{class:"text-right"},null,-1)),Ke=y(()=>o("td",{class:"text-right"},null,-1)),Qe=y(()=>o("span",null,"Detalles de la Orden",-1)),Ze={class:"d-flex flex-wrap gap-2 ml-3"},We={class:"d-flex flex-column"},Xe={class:"text-caption text-medium-emphasis"},$e={class:"font-weight-medium"},et={class:"d-flex flex-column"},tt={class:"text-caption text-medium-emphasis"},st={class:"font-weight-medium"},at={class:"d-flex flex-column"},lt={class:"text-caption text-medium-emphasis"},rt={class:"font-weight-medium"},ot=y(()=>o("small",{class:"text-caption"},"items",-1)),it={class:"d-flex flex-column"},nt={class:"text-caption text-medium-emphasis"},dt={class:"font-weight-medium text-success"},ct=y(()=>o("span",null,"Información del Cliente",-1)),mt={class:"d-flex flex-column"},ut={class:"text-caption text-medium-emphasis"},ht={class:"font-weight-medium"},pt={class:"d-flex flex-column"},ft={class:"text-caption text-medium-emphasis"},_t={class:"font-weight-medium"},gt={class:"d-flex flex-column"},yt={class:"text-caption text-medium-emphasis"},xt={class:"font-weight-medium"},vt={key:0,class:"text-primary text-caption"},Ct={class:"d-flex flex-column gap-2"},bt={class:"d-flex justify-space-between"},wt=y(()=>o("span",{class:"text-caption text-medium-emphasis"},"Total Orden:",-1)),kt={class:"font-weight-medium"},St={class:"d-flex justify-space-between"},Dt=y(()=>o("span",{class:"text-caption text-medium-emphasis"},"Total Pagado:",-1)),Pt={class:"font-weight-medium text-primary"},Vt={class:"d-flex justify-space-between"},Ot=y(()=>o("span",{class:"text-caption text-medium-emphasis"},"Saldo Pendiente:",-1)),Rt={class:"d-flex justify-space-between"},Et=y(()=>o("span",{class:"text-caption text-medium-emphasis"},"Vuelto:",-1)),Tt={class:"font-weight-medium text-success"},Ft={class:"mt-4"};function It(t,a,n,m,l,i){const C=Q,g=j("IconBtn"),D=W,z=j("DialogConfirmar");return p(),b(k,null,{default:s(()=>[e(E,{class:"d-flex flex-wrap align-center justify-space-between ga-2"},{default:s(()=>[o("div",ge,[ye,o("div",xe,[e(u,{icon:"ri-information-line",size:"16",class:"mr-1"}),ve])])]),_:1}),e(w,{class:"d-flex px-2"},{default:s(()=>[e(le,{headers:i.showHeaders,items:l.orders.data||[],class:"text-no-wrap striped-table border-0",loading:l.loading,"items-per-page":l.pagination.itemsPerPage,page:l.pagination.page,"items-length":l.orders.total||0,"onUpdate:options":i.handlePaginationChange},{top:s(()=>[e(k,{flat:"",color:"white"},{default:s(()=>[e(w,{class:"mx-0 px-0"},{default:s(()=>[e(P,{dense:"",class:"mx-0 px-0"},{default:s(()=>[e(f,{cols:"12",md:"4",sm:"12",class:"pl-0 pt-0"},{default:s(()=>[e(re,{modelValue:l.search,"onUpdate:modelValue":a[0]||(a[0]=r=>l.search=r),label:"N° Orden",class:"mt-0",density:"compact"},null,8,["modelValue"]),e(V,{modelValue:l.selectedCustomer,"onUpdate:modelValue":[a[1]||(a[1]=r=>l.selectedCustomer=r),i.handleSelection],items:l.customers,"item-title":l.customers.firstname?"firstname":"address","item-value":"id",label:"Clientes",multiple:"",clearable:"",class:"mt-1",density:"compact",ref:"autocompleteRef"},null,8,["modelValue","items","item-title","onUpdate:modelValue"])]),_:1}),e(f,{cols:"12",md:"4",sm:"12",class:"pl-0 pt-0"},{default:s(()=>[e(P,{dense:"",class:"mx-0 px-0"},{default:s(()=>[e(f,{cols:"12",md:"6",sm:"12",class:"mx-0 px-0 pr-1"},{default:s(()=>[e(V,{modelValue:l.selectedPaymentStatus,"onUpdate:modelValue":a[2]||(a[2]=r=>l.selectedPaymentStatus=r),items:l.paymentStatuses,"item-title":"name","item-value":"id",label:"Estado del pago",clearable:"",class:"mt-0",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"12",md:"6",sm:"12",class:"mr-0 pr-0"},{default:s(()=>[e(V,{modelValue:l.selectedSeller,"onUpdate:modelValue":a[3]||(a[3]=r=>l.selectedSeller=r),items:l.sellers,"item-title":l.sellers.name?"name":"email","item-value":"id",label:"Vendedores",clearable:"",class:"mt-0",density:"compact"},null,8,["modelValue","items","item-title"])]),_:1})]),_:1}),e(C,{class:"mt-0",ref:"dateOrderRange",modelValue:l.dateOrderRange,"onUpdate:modelValue":a[4]||(a[4]=r=>l.dateOrderRange=r),modelLabel:"Fecha Orden"},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"4",sm:"12",class:"pl-0 pt-0 py-0"},{default:s(()=>[e(V,{modelValue:l.selectedShipmentStatus,"onUpdate:modelValue":a[5]||(a[5]=r=>l.selectedShipmentStatus=r),items:l.shipmentStatuses,"item-title":"name","item-value":"id",label:"Estado entrega",clearable:"",class:"mt-0",density:"compact"},null,8,["modelValue","items"]),e(C,{class:"mt-0 py-0",ref:"dateDeliveryRange",modelValue:l.dateRange,"onUpdate:modelValue":a[6]||(a[6]=r=>l.dateRange=r),modelLabel:"Fecha entrega"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(A,{class:"justify-end"},{default:s(()=>[e(_,{variant:"outlined",color:"primary",onClick:i.reset},{default:s(()=>[c(" Reset ")]),_:1},8,["onClick"]),e(_,{variant:"outlined",color:"white",onClick:a[7]||(a[7]=r=>{i.unsetInitialLoad(),i.fetchData()}),loading:l.loading,class:"bg-primary"},{default:s(()=>[c(" Buscar ")]),_:1},8,["loading"])]),_:1})]),_:1})]),"item.order_number":s(({item:r})=>[o("div",Ce,[o("div",be,[o("span",we,d(r.order_number),1),o("small",null,"Productos: "+d(r.quantity_products),1)])])]),"item.customer.firstname":s(({item:r})=>[r.customer.firstname?(p(),v("span",ke,d(r.customer.firstname+" "+r.customer.lastname),1)):x("",!0)]),"item.order_date":s(({item:r})=>[o("div",Se,[o("span",De,d(i.formatDateGrid(r.order_date.split(" ")[0])),1),o("small",Pe,d(r.order_date.split(" ")[1]||""),1)])]),"item.delivery_date":s(({item:r})=>[r.shipping&&r.delivery_date?(p(),v("div",Ve,d(i.getDate(r.delivery_date)),1)):x("",!0)]),"item.total_cost":s(({item:r})=>[o("div",Oe,[o("strong",null,d(i.formatCurrency(r.total_cost)),1)])]),"item.total_profit":s(({item:r})=>[o("div",Re,[o("strong",null,d(i.formatCurrency(r.total_profit)),1)])]),"item.total_paid":s(({item:r})=>[o("div",{class:T(r.total_paid>0?r.total_paid<r.total_amount?"text-right text-warning":"text-right text-success":"text-right text-error")},[o("strong",null,d(i.formatCurrency(r.total_paid)),1)],2)]),"item.customer":s(({item:r})=>[o("div",Ee,[o("span",Te,d(r.customer.address),1),o("small",null,d(i.getCustomer(r.customer))+", "+d(r.customer.telephone),1)])]),"item.total_amount":s(({item:r})=>[o("div",{class:T(r.total_profit>0?"text-right text-success":"text-right text-error")},[o("strong",null,d(i.formatCurrency(r.total_amount)),1)],2)]),"item.payment_status_id":s(({item:r})=>[o("div",Fe,[e(R,F(t.props,{color:i.getStatusCodeColor(r.payment_status.code),"prepend-icon":"ri-money-dollar-circle-line",density:"comfortable",class:"my-1 status-chip",style:{width:"150px"}}),{default:s(()=>[c(d(r.payment_status.name),1)]),_:2},1040,["color"]),e(H,{"offset-y":""},{activator:s(({props:h})=>[e(R,F(h,{color:i.getStatusCodeColorShipping(r.shipment_status.code),"prepend-icon":"ri-truck-line",density:"comfortable",class:"my-1 status-chip",style:{width:"150px"}}),{default:s(()=>[c(d(r.shipment_status.name)+" ",1),e(u,{icon:"ri-arrow-down-s-line",class:"ml-1"})]),_:2},1040,["color"])]),default:s(()=>[e(q,{density:"compact",class:"py-0"},{default:s(()=>[(p(!0),v(U,null,ee(l.shipmentStatuses,h=>(p(),b(S,{key:h.id,onClick:At=>i.updateShippingStatus(r,h),class:"pa-0"},{default:s(()=>[e(R,{color:i.getStatusCodeColorShipping(h.code),"prepend-icon":"ri-truck-line",density:"comfortable",class:T(["ma-1 status-option",`selected-status ${h.id===r.shipment_status.id?"selected-status":""}`]),style:{width:"150px"}},{default:s(()=>[c(d(h.name)+" ",1),h.id===r.shipment_status.id?(p(),b(u,{key:0,icon:"ri-check-line",class:"ml-1"})):x("",!0)]),_:2},1032,["color","class"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)])]),"item.actions":s(({item:r})=>[o("div",Ie,[e(H,{"offset-y":"",transition:"scale-transition"},{activator:s(({props:h})=>[e(g,F({size:"small"},h),{default:s(()=>[e(u,{icon:"ri-more-2-fill"})]),_:2},1040)]),default:s(()=>[e(q,null,{default:s(()=>[e(S,{onClick:h=>i.editOrder(r)},{default:s(()=>[e(O,null,{default:s(()=>[e(g,{size:"small",class:"my-1",title:"Editar"},{default:s(()=>[e(u,{icon:"ri-pencil-line"})]),_:1}),c("Editar ")]),_:1})]),_:2},1032,["onClick"]),e(S,{onClick:h=>i.showRemito(r)},{default:s(()=>[e(O,null,{default:s(()=>[e(g,{size:"small",class:"my-1",title:"Remito"},{default:s(()=>[e(u,{icon:"ri-file-pdf-2-line"})]),_:1}),c("Remito ")]),_:1})]),_:2},1032,["onClick"]),e(S,{onClick:h=>i.showRemitoComanda(r)},{default:s(()=>[e(O,null,{default:s(()=>[e(g,{size:"small",class:"my-1",title:"Comanda"},{default:s(()=>[e(u,{icon:"ri-file-pdf-2-line"})]),_:1}),c("Comanda ")]),_:1})]),_:2},1032,["onClick"]),t.$is("bebidas-user")==!1?(p(),b(S,{key:0,onClick:h=>i.openMovementDialog(r)},{default:s(()=>[e(O,null,{default:s(()=>[e(g,{size:"small",class:"my-1",title:"Cambiar el estado de la orden",onClick:h=>i.openMovementDialog(r)},{default:s(()=>[e(u,{icon:"ri-swap-box-line"})]),_:2},1032,["onClick"]),c("Cambiar estado ")]),_:2},1024)]),_:2},1032,["onClick"])):x("",!0),i.isPaid(r)?x("",!0):(p(),b(S,{key:1,onClick:h=>i.openPaymentForm(r)},{default:s(()=>[e(O,null,{default:s(()=>[e(g,{size:"small",class:"my-1",title:"Registrar Pago",onClick:h=>i.openPaymentForm(r)},{default:s(()=>[e(u,{icon:"ri-money-dollar-circle-line"})]),_:2},1032,["onClick"]),c("Registrar Pago ")]),_:2},1024)]),_:2},1032,["onClick"])),e(S,{onClick:h=>i.dialogCancelOrden(r)},{default:s(()=>[e(O,null,{default:s(()=>[e(g,{size:"small",class:"my-1",title:"Cancelar Orden",onClick:h=>i.dialogCancelOrden(r)},{default:s(()=>[e(u,{icon:"ri-file-close-line"})]),_:2},1032,["onClick"]),c("Cancelar Orden ")]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)])]),tfoot:s(()=>[o("tfoot",null,[o("tr",Ae,[ze,o("td",{colspan:i.showHeaders.length-(this.isAdmin?8:6),class:"text-right"},[o("div",Le,[o("div",Me,[o("span",Ne,"Facturas Totales: "+d(l.orders.data.length),1),o("small",null,"Productos Totales: "+d(i.calculateTotalProducts()),1)])])],8,Ue),this.isAdmin?x("",!0):(p(),v("td",Be)),o("td",je,d(i.formatCurrency(i.calculateTotalAmount())),1),this.isAdmin?(p(),v("td",He,d(i.formatCurrency(i.calculateTotalCost())),1)):x("",!0),this.isAdmin?(p(),v("td",qe,d(i.formatCurrency(i.calculateTotalProfit())),1)):x("",!0),o("td",Ge,d(i.formatCurrency(i.calculateTotalPaid())),1),this.isAdmin?(p(),v("td",Ye)):x("",!0),Je,Ke])])]),_:1},8,["headers","items","loading","items-per-page","page","items-length","onUpdate:options"]),e(N,{modelValue:l.movementDialog,"onUpdate:modelValue":a[11]||(a[11]=r=>l.movementDialog=r),"max-width":"800px",persistent:""},{default:s(()=>[e(k,{class:"rounded-lg"},{default:s(()=>[e(G,{color:"primary",density:"compact"},{default:s(()=>[e(Y,{class:"text-white font-weight-medium"},{default:s(()=>[e(_,{icon:"",variant:"text",color:"white",onClick:i.closeMovementDialog},{default:s(()=>[e(u,null,{default:s(()=>[c("ri-close-line")]),_:1})]),_:1},8,["onClick"]),c(" "+d(i.movementFormTitle),1)]),_:1})]),_:1}),e(J,{ref:"movementForm",modelValue:l.validMovement,"onUpdate:modelValue":a[10]||(a[10]=r=>l.validMovement=r)},{default:s(()=>[e(w,{class:"px-4 pt-4 pb-2"},{default:s(()=>[e(k,{flat:"",border:"",class:"mb-4",color:"primary-lighten-5"},{default:s(()=>[e(L,{class:"py-0 mt-2"},{default:s(()=>[e(E,{class:"d-flex align-center"},{default:s(()=>[e(M,{icon:"ri-inbox-unarchive-line",class:"text-info mr-2",variant:"tonal"}),Qe,o("div",Ze,[e(R,{color:i.getStatusCodeColor(l.selectedOrder.payment_status.code),size:"small",class:"font-weight-medium"},{default:s(()=>[e(u,{icon:"ri-money-dollar-circle-line",class:"mr-1"}),c(" "+d(l.selectedOrder.payment_status.name),1)]),_:1},8,["color"]),e(R,{color:i.getStatusCodeColorShipping(l.selectedOrder.shipment_status.code),size:"small",class:"font-weight-medium"},{default:s(()=>[e(u,{icon:"ri-truck-line",class:"mr-1"}),c(" "+d(l.selectedOrder.shipment_status.name),1)]),_:1},8,["color"])])]),_:1})]),_:1}),e(I,{class:"my-1"}),e(w,null,{default:s(()=>[e(P,{dense:""},{default:s(()=>[e(f,{cols:"6",sm:"3"},{default:s(()=>[o("div",We,[o("span",Xe,[e(u,{icon:"ri-hashtag",size:"14",class:"mr-1"}),c(" Número ")]),o("span",$e,d(l.selectedOrder.order_number),1)])]),_:1}),e(f,{cols:"6",sm:"3"},{default:s(()=>[o("div",et,[o("span",tt,[e(u,{icon:"ri-calendar-line",size:"14",class:"mr-1"}),c(" Fecha ")]),o("span",st,d(l.selectedOrder.order_date),1)])]),_:1}),e(f,{cols:"6",sm:"3"},{default:s(()=>[o("div",at,[o("span",lt,[e(u,{icon:"ri-archive-line",size:"14",class:"mr-1"}),c(" Productos ")]),o("span",rt,[c(d(l.selectedOrder.quantity_products)+" ",1),ot])])]),_:1}),e(f,{cols:"6",sm:"3"},{default:s(()=>[o("div",it,[o("span",nt,[e(u,{icon:"ri-money-dollar-circle-line",size:"14",class:"mr-1"}),c(" Total ")]),o("span",dt,d(i.formatCurrency(l.selectedOrder.total_amount)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(k,{flat:"",border:"",class:"mb-4",color:"grey-lighten-4"},{default:s(()=>[e(L,{class:"py-0 mt-2"},{default:s(()=>[e(E,{class:"d-flex align-center"},{default:s(()=>[e(M,{icon:"ri-user-line",class:"text-info mr-2",variant:"tonal"}),ct]),_:1})]),_:1}),e(I,{class:"my-1"}),e(w,null,{default:s(()=>[e(P,{dense:""},{default:s(()=>[e(f,{cols:"12",md:"4"},{default:s(()=>[o("div",mt,[o("span",ut,[e(u,{icon:"ri-user-3-line",size:"14",class:"mr-1"}),c(" Nombre ")]),o("span",ht,d(l.selectedOrder.customer.firstname)+" "+d(l.selectedOrder.customer.lastname),1)])]),_:1}),e(f,{cols:"12",md:"4"},{default:s(()=>[o("div",pt,[o("span",ft,[e(u,{icon:"ri-map-pin-line",size:"14",class:"mr-1"}),c(" Dirección ")]),o("span",_t,d(l.selectedOrder.customer.address||"No especificada"),1)])]),_:1}),e(f,{cols:"12",md:"4"},{default:s(()=>[o("div",gt,[o("span",yt,[e(u,{icon:"ri-phone-line",size:"14",class:"mr-1"}),c(" Contacto ")]),o("span",xt,d(l.selectedOrder.customer.telephone||"Sin teléfono"),1),l.selectedOrder.customer.email?(p(),v("span",vt,[e(u,{icon:"ri-mail-line",size:"12",class:"mr-1"}),c(" "+d(l.selectedOrder.customer.email),1)])):x("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),e(P,null,{default:s(()=>[e(f,{cols:"12",md:"6",sm:"6"},{default:s(()=>[e(V,{modelValue:l.movement.payment_status_id,"onUpdate:modelValue":a[8]||(a[8]=r=>l.movement.payment_status_id=r),items:l.paymentStatuses,"item-title":"name","item-value":"id",label:"Estado del pago",rules:[i.validateStatusChange(l.movement.payment_status_id,1)],variant:"outlined",class:"mt-2",clearable:""},null,8,["modelValue","items","rules"])]),_:1}),e(f,{cols:"12",md:"6",sm:"6"},{default:s(()=>[e(V,{modelValue:l.movement.shipment_status_id,"onUpdate:modelValue":a[9]||(a[9]=r=>l.movement.shipment_status_id=r),items:l.shipmentStatuses,"item-title":"name","item-value":"id",label:"Estado de la entrega",rules:[i.validateStatusChange(l.movement.shipment_status_id,2)],variant:"outlined",class:"mt-2",clearable:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1}),e(A,null,{default:s(()=>[e(K),e(_,{variant:"outlined",color:"primary",onClick:i.closeMovementDialog},{default:s(()=>[c(" Cancelar ")]),_:1},8,["onClick"]),e(_,{color:"white",class:"bg-primary",onClick:i.saveMovement,loading:l.savingMovement,disabled:!l.validMovement},{default:s(()=>[c(" Actualizar Estado ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(N,{modelValue:l.paymentFormDialog,"onUpdate:modelValue":a[13]||(a[13]=r=>l.paymentFormDialog=r),"max-width":"600px",persistent:""},{default:s(()=>[e(k,{class:"rounded-lg"},{default:s(()=>[e(G,{color:"primary",density:"compact",class:"ml-0 pl-0"},{default:s(()=>[e(Y,{class:"text-h6 font-weight-medium text-white"},{default:s(()=>[e(_,{icon:"ri-close-line",color:"white",onClick:i.closePaymentForm},null,8,["onClick"]),c(" Registrar Pago ")]),_:1}),e(K),e(_,{icon:"",variant:"text",color:"white",onClick:i.closePaymentForm},{default:s(()=>[e(u,null,{default:s(()=>[c("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),e(J,{ref:"paymentForm",modelValue:l.validPayment,"onUpdate:modelValue":a[12]||(a[12]=r=>l.validPayment=r)},{default:s(()=>[e(w,{class:"px-4 pt-4 pb-2"},{default:s(()=>[e(k,{flat:"",class:"border",color:"surface"},{default:s(()=>[e(L,{class:"py-2"},{default:s(()=>[e(E,{class:"text-subtitle-1 font-weight-medium d-flex align-center"},{default:s(()=>[e(M,{icon:"ri-money-dollar-circle-line",class:"text-primary mr-2",variant:"tonal"}),c(" Resumen de Pagos ")]),_:1})]),_:1}),e(I),e(w,{class:"px-2 py-3"},{default:s(()=>{var r,h;return[o("div",Ct,[o("div",bt,[wt,o("span",kt,d(i.formatCurrency((h=(r=l.createdOrder)==null?void 0:r.order)==null?void 0:h.total_amount)),1)]),o("div",St,[Dt,o("span",Pt,d(i.formatCurrency(l.totalPaid)),1)]),o("div",Vt,[Ot,o("span",{class:T(["font-weight-medium",i.pendingAmount>0?"text-error":"text-success"])},d(i.formatCurrency(i.pendingAmount)),3)]),e(I,{class:"my-1"}),o("div",Rt,[Et,o("span",Tt,d(i.formatCurrency(l.change)),1)])])]}),_:1})]),_:1}),o("div",Ft,[(p(),b(D,{ref:"paymentsRow",key:l.keyPayments,records:l.createdOrder.order.payment,modulo:"pagos",onUpdateTotal:i.updateTotal},null,8,["records","onUpdateTotal"]))])]),_:1}),e(A,{class:"px-4 pb-4 pt-2"},{default:s(()=>[e(P,null,{default:s(()=>[e(f,{cols:"12",md:"12",sm:"12",class:"pt-4 pb-0 my-0"},{default:s(()=>[e(_,{variant:"outlined",color:"primary",onClick:i.closePaymentForm,class:"text-capitalize",block:""},{default:s(()=>[c(" Cancelar ")]),_:1},8,["onClick"])]),_:1}),e(f,{cols:"12",md:"12",sm:"12",class:"pt-1 my-0 pb-2"},{default:s(()=>[e(_,{onClick:i.savePayment,loading:l.savingPayment,disabled:!l.validPayment,color:"white",class:"bg-primary text-capitalize",block:""},{default:s(()=>[l.savingPayment?(p(),v(U,{key:1},[c(" Procesando... ")],64)):(p(),v(U,{key:0},[e(u,{icon:"mdi-check-circle-outline",class:"mr-1"}),c(" Confirmar Pago ")],64))]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),l.dialogs.cancelOrden?(p(),b(z,{key:0,modelValue:l.dialogs.cancelOrden,"onUpdate:modelValue":a[14]||(a[14]=r=>l.dialogs.cancelOrden=r),onInput:a[15]||(a[15]=r=>t.dialog=r),title:"Cancelar Orden",info:"¿Estás seguro cancelar la orden <b>"+l.selectedOrder.order_number+"</b>? Esta acción no se puede deshacer.",icon:"ri-file-close-line",color:"#F44336",onConfirm:a[16]||(a[16]=r=>i.confirmCancelOrden()),onClose:a[17]||(a[17]=r=>i.closeDialog("cancelOrden"))},null,8,["modelValue","info"])):x("",!0),e(oe,{modelValue:l.snackbar,"onUpdate:modelValue":a[19]||(a[19]=r=>l.snackbar=r),color:l.snackbarColor,timeout:3e3},{action:s(({attrs:r})=>[e(_,F({text:""},r,{onClick:a[18]||(a[18]=h=>l.snackbar=!1)}),{default:s(()=>[c(" Cerrar ")]),_:2},1040)]),default:s(()=>[c(d(l.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})]),_:1})}const ns=Z(_e,[["render",It],["__scopeId","data-v-e99cc504"]]);export{ns as default};
